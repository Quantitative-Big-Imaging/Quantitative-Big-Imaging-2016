<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta http-equiv="Content-Style-Type" content="text/css" />
  <meta name="generator" content="pandoc" />
  <title></title>
  <style type="text/css">code{white-space: pre;}</style>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <!-- jQuery -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.10.3/jquery-ui.min.js"></script>
  
  <!-- bootstrap -->
  <!--<link href="https://netdna.bootstrapcdn.com/bootstrap/3.0.0/css/bootstrap.min.css" rel="stylesheet"  id="style">-->
  <script src="https://netdna.bootstrapcdn.com/bootstrap/3.0.0/js/bootstrap.min.js"></script>
  
  <!-- highlight.js -->
  <!--<link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/7.3/styles/default.min.css" rel="stylesheet" id="code-style">-->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/7.3/highlight.min.js"></script>
  <script>
  hljs.LANGUAGES.r=function(a){var b="([a-zA-Z]|\\.[a-zA-Z.])[a-zA-Z0-9._]*";return{c:[a.HCM,{b:b,l:b,k:{keyword:"function if in break next repeat else for return switch while try tryCatch|10 stop warning require library attach detach source setMethod setGeneric setGroupGeneric setClass ...|10",literal:"NULL NA TRUE FALSE T F Inf NaN NA_integer_|10 NA_real_|10 NA_character_|10 NA_complex_|10"},r:0},{cN:"number",b:"0[xX][0-9a-fA-F]+[Li]?\\b",r:0},{cN:"number",b:"\\d+(?:[eE][+\\-]?\\d*)?L\\b",r:0},{cN:"number",b:"\\d+\\.(?!\\d)(?:i\\b)?",r:0},{cN:"number",b:"\\d+(?:\\.\\d*)?(?:[eE][+\\-]?\\d*)?i?\\b",r:0},{cN:"number",b:"\\.\\d+(?:[eE][+\\-]?\\d*)?i?\\b",r:0},{b:"`",e:"`",r:0},{cN:"string",b:'"',e:'"',c:[a.BE],r:0},{cN:"string",b:"'",e:"'",c:[a.BE],r:0}]}}(hljs); </script>
  <!--<script type="text/javascript", src="https://yandex.st/highlightjs/7.3/languages/r.min.js"></script>-->
  
  <!-- Manific Popup -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/magnific-popup.js/0.8.9/jquery.magnific-popup.min.js"></script>
  
  <script type="text/javascript"
    src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
  </script>
  <script defer="defer">
  // Function to generate the dynamic table of contents
  jQuery.fn.generate_TOC = function () {
    var base = $(this[0]);
  
    var selectors = ['h1', 'h2', 'h3', 'h4'];
  
    var last_ptr = [{}, {}, {}, {}];
  
    var anchors = {};
  
    generate_anchor = function (text) {
      var test = text.replace(/\W/g, '_');
  
      while(test in anchors){
        //if no suffix, add one
        if(test.match(/_\d+$/) === null){
          test = test + "_2";
        }
        //else generate unique id for duplicates by adding one to the suffix
        else {
          test = test.replace(/_(\d+)$/, function(match, number){ var num=+number+1; return("_" + num) });
        }
      }
      anchors[test]=1;
      return(test);
    }
  
    $(selectors.join(',')).filter(function(index) { return $(this).parent().attr("id") != 'header'; }).each(function () {
  
      var heading = $(this);
      var idx = selectors.indexOf(heading.prop('tagName').toLowerCase());
      var itr = 0;
  
      while (itr <= idx) {
        if (jQuery.isEmptyObject(last_ptr[itr])) {
          last_ptr[itr] = $('<ul>').addClass('nav');
          if (itr === 0) {
            base.append(last_ptr[itr])
          } else {
            if(last_ptr[itr-1].children('li').length === 0){
              last_ptr[itr-1].append(last_ptr[itr]);
            }
            else {
              last_ptr[itr - 1].children('li').last().append(last_ptr[itr]);
            }
          }
        }
        itr++;
      }
      var anchor = generate_anchor(heading.text());
      heading.attr('id', anchor);
      var a = $('<a>')
      .text(heading.text())
      .attr('href', '#' + anchor);
  
    var li = $('<li>')
      .append(a);
  
    last_ptr[idx].append(li);
    for (i = idx + 1; i < last_ptr.length; i++) {
      last_ptr[i] = {};
    }
    });
  }
  /* run scripts when document is ready */
  $(function() {
    "use strict";
  
    var $window = $(window);
    var $body = $(document.body);
  
    /* size of thumbnails */
  
    var hidden_types = ['source']
    var output_types = ['output', 'message', 'warning', 'error']
  
    /* style tables */
    $('table').addClass('table table-striped table-bordered table-hover table-condensed');
  
    $('pre code').each(function(i, e) {
      hljs.highlightBlock(e);
    });
  
    /* Magnific Popup */
    $(".thumbnail").each(function(){
      $(this).magnificPopup({
        disableOn: 768,
        closeOnContentClick: true,
  
        type: 'image',
        items: {
          src: $(this).find('img').attr('src'),
        }
      });
    });
  
    function toggle_block(obj, show) {
      var span = obj.find('span');
      if(show === true){
        span.removeClass('glyphicon-chevron-up').addClass('glyphicon-chevron-down');
        obj.next('pre').slideDown();
      }
      else {
        span.removeClass('glyphicon-chevron-down').addClass('glyphicon-chevron-up');
        obj.next('pre').slideUp();
      }
    }
  
    function toggle_thumbnails(imgs, show){
      if(show === true){
        imgs.parents().show()
        imgs.slideDown();
      }
      else {
        imgs.slideUp(400, function(){ $(this).parent().hide(); });
      }
    }
  
    function global_toggle(obj){
      var type = obj.attr('type');
      var show = !obj.parent('li').hasClass('active');
      if(show === true){
        obj.parent('li').addClass('active');
      }
      else{
        obj.parent('li').removeClass('active');
      }
      if(type == 'figure'){
        toggle_thumbnails($('.thumbnail img'), show);
      }
      else {
        $('.toggle.' + type).each(function() { toggle_block($(this), show); });
      }
    }
  
    /* onclick toggle next code block */
    $('.toggle').click(function() {
      var span = $(this).find('span');
      toggle_block($(this), !span.hasClass('glyphicon-chevron-down'));
      return false
    })
  
    // global toggles
    $('.toggle-global').click(function(){
      var type = $(this).attr('type');
      if(type === 'all-source'){
          $('li a.source').each(function() {
            global_toggle($(this));
          });
        }
      else if(type === 'all-output'){
        $.each(output_types, function(i, val){
          console.log(val);
          global_toggle($('li a.' + val));
        });
      }
      else {
        console.log($(this));
        global_toggle($(this));
      }
      return false;
    });
    /* table of contents */
    if($(['h1', 'h2', 'h3', 'h4'].join(',')).length > 0){
      $('body > #wrap > .container > .row').append('<div class="col-md-2"><div id="toc" class="well sidebar sidenav affix hidden-print"/></div>');
      $('#toc').generate_TOC();
    }
  
    $.each(hidden_types, function(i, type) {
      $('li[type=' + type + ']').each(function(){ global_toggle($(this)); });
    });
  
    /* remove paragraphs with no content */
    $('p:empty').remove();
  
    $body.scrollspy({
      target: '.sidebar',
    });
  
    /* theme switch */
    $('.theme-switch').click(function(){
      var css = $('link[title=' + $(this).attr('title') + ']');
      $('#theme[rel=stylesheet]').attr('href', css.attr('href'));
      $('.theme-switch').closest('li').removeClass('active');
      $(this).closest('li').addClass('active');
      return false;
    });
    /* code style switch */ //TODO use same function for both of these?
    $('.highlight-switch').click(function(){
      var css = $('link[title="' + $(this).attr('title') + '"]');
      $('#highlight[rel=stylesheet]').attr('href', css.attr('href'));
      $('.highlight-switch').closest('li').removeClass('active');
      $(this).closest('li').addClass('active');
      return false;
    });
  
    //TODO refresh on show/hide
    $window.on('load', function () {
      $body.scrollspy('refresh');
    })
  
  });
  
  </script>
  <style>
  /* Knitr_bootstrap styles */
  #header {
    display: none !important;
    visibility: hidden !important;
  }
  #wrap .container-fluid {
    padding: 0;
    overflow: hidden;
  }
  .toggle{
    text-transform: capitalize;
  }
  
  .toggle-global{
    text-transform: capitalize;
  }
  
  /* Sticky footer styles */
  * {
    margin:0;
  }
  html,
  body {
      height: 100%;
      padding:0 !important;
      /* The html and body elements cannot have any padding or margin. */
      /*overflow-x: hidden;*/
  }
  
  /* Wrapper for page content to push down footer */
  #wrap {
      min-height: 100%;
      height: auto !important;
      height: 100%;
      /* Negative indent footer by it's height */
      margin: 0 auto -120px;
  }
  
  /* Set the fixed height of the footer here */
  #push,
  #footer {
      height: 120px;
  }
  
  #footer {
    text-align: center;
  }
  
  /* Top level subheader elements.  These are the first nested items underneath a header element. */
  .header li {
    font-size: 20px;
  }
  
  /* Makes the font smaller for all subheader elements. */
  .sub-header li {
      font-size: 12px;
  }
  
  button.thumbnails {
    margin-left:0px;
  }
  
  /*
   * Side navigation
   *
   * Scrollspy and affixed enhanced navigation to highlight sections and secondary
   * sections of docs content.
   */
  
  /* By default it's not affixed in mobile views, so undo that */
  .sidebar.affix {
    position: static;
  }
  
  /* First level of nav */
  .sidenav {
    margin-top: 30px;
    margin-bottom: 30px;
    padding-top:    10px;
    padding-bottom: 10px;
    border-radius: 5px;
  }
  
  /* All levels of nav */
  .sidebar .nav > li > a {
    display: block;
    padding: 5px 20px;
  }
  .sidebar .nav > li > a:hover,
  .sidebar .nav > li > a:focus {
    text-decoration: none;
    border-right: 1px solid;
  }
  .sidebar .nav > .active > a,
  .sidebar .nav > .active:hover > a,
  .sidebar .nav > .active:focus > a {
    font-weight: bold;
    background-color: transparent;
    border-right: 1px solid;
  }
  
  /* Nav: second level (shown on .active) */
  .sidebar .nav .nav {
    display: none; /* Hide by default, but at >768px, show it */
    margin-bottom: 8px;
  }
  .sidebar .nav .nav > li > a {
    padding-top:    3px;
    padding-bottom: 3px;
    padding-left: 30px;
    font-size: 90%;
  }
  
  .sidebar .nav .nav .nav > li > a {
    padding-left: 40px;
  }
  .sidebar .nav .nav .nav .nav > li > a {
    padding-left: 50px;
  }
  
  /* Show and affix the side nav when space allows it */
  @media screen and (min-width: 992px) {
    .sidebar .nav > .active > ul {
      display: block;
    }
    /* Widen the fixed sidebar */
    .sidebar.affix,
    .sidebar.affix-bottom {
      width: 213px;
    }
    .sidebar.affix-top,
    .sidebar.affix {
      position: fixed; /* Undo the static from mobile first approach */
      top: 30px;
    }
    .sidebar.affix-bottom {
      position: absolute; /* Undo the static from mobile first approach */
    }
    .sidebar.affix-bottom .sidenav,
    .sidebar.affix .sidenav {
      margin-top: 0;
      margin-bottom: 0;
    }
  }
  @media screen and (min-width: 1200px) {
    /* Widen the fixed sidebar again */
    .sidebar.affix-bottom,
    .sidebar.affix {
      width: 263px;
    }
  }
  
  #toc {
    padding: 10px 0px;
    margin:0;
    border:0;
  }
  
  
  .panel pre {
    margin: 0;
    padding: 0;
    border: 0;
  }
  button + pre {
    margin: 0;
    padding: 0;
  }
  pre code {
    border-radius: 0;
  }
  /* Magnific Popup CSS */
  .mfp-bg {
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: 1042;
    overflow: hidden;
    position: fixed;
    background: #0b0b0b;
    opacity: 0.8;
    filter: alpha(opacity=80); }
  
  .mfp-wrap {
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: 1043;
    position: fixed;
    outline: none !important;
    -webkit-backface-visibility: hidden; }
  
  .mfp-container {
    text-align: center;
    position: absolute;
    width: 100%;
    height: 100%;
    left: 0;
    top: 0;
    padding: 0 8px;
    -webkit-box-sizing: border-box;
    -moz-box-sizing: border-box;
    box-sizing: border-box; }
  
  .mfp-container:before {
    content: '';
    display: inline-block;
    height: 100%;
    vertical-align: middle; }
  
  .mfp-align-top .mfp-container:before {
    display: none; }
  
  .mfp-content {
    position: relative;
    display: inline-block;
    vertical-align: middle;
    margin: 0 auto;
    text-align: left;
    z-index: 1045; }
  
  .mfp-inline-holder .mfp-content,
  .mfp-ajax-holder .mfp-content {
    width: 100%;
    cursor: auto; }
  
  .mfp-ajax-cur {
    cursor: progress; }
  
  .mfp-zoom-out-cur,
  .mfp-zoom-out-cur .mfp-image-holder .mfp-close {
    cursor: -moz-zoom-out;
    cursor: -webkit-zoom-out;
    cursor: zoom-out; }
  
  .mfp-zoom {
    cursor: pointer;
    cursor: -webkit-zoom-in;
    cursor: -moz-zoom-in;
    cursor: zoom-in; }
  
  .mfp-auto-cursor .mfp-content {
    cursor: auto; }
  
  .mfp-close,
  .mfp-arrow,
  .mfp-preloader,
  .mfp-counter {
    -webkit-user-select: none;
    -moz-user-select: none;
    user-select: none; }
  
  .mfp-loading.mfp-figure {
    display: none; }
  
  .mfp-hide {
    display: none !important; }
  
  .mfp-preloader {
    color: #cccccc;
    position: absolute;
    top: 50%;
    width: auto;
    text-align: center;
    margin-top: -0.8em;
    left: 8px;
    right: 8px;
    z-index: 1044; }
  
  .mfp-preloader a {
    color: #cccccc; }
  
  .mfp-preloader a:hover {
    color: white; }
  
  .mfp-s-ready .mfp-preloader {
    display: none; }
  
  .mfp-s-error .mfp-content {
    display: none; }
  
  button.mfp-close,
  button.mfp-arrow {
    overflow: visible;
    cursor: pointer;
    background: transparent;
    border: 0;
    -webkit-appearance: none;
    display: block;
    padding: 0;
    z-index: 1046;
    -webkit-box-shadow: none;
    box-shadow: none; }
  
  button::-moz-focus-inner {
    padding: 0;
    border: 0; }
  
  .mfp-close {
    width: 44px;
    height: 44px;
    line-height: 44px;
    position: absolute;
    right: 0;
    top: 0;
    text-decoration: none;
    text-align: center;
    opacity: 0.65;
    padding: 0 0 18px 10px;
    color: white;
    font-style: normal;
    font-size: 28px;
    font-family: Arial, Baskerville, monospace; }
    .mfp-close:hover, .mfp-close:focus {
      opacity: 1; }
    .mfp-close:active {
      top: 1px; }
  
  .mfp-close-btn-in .mfp-close {
    color: #333333; }
  
  .mfp-image-holder .mfp-close,
  .mfp-iframe-holder .mfp-close {
    color: white;
    right: -6px;
    text-align: right;
    padding-right: 6px;
    width: 100%; }
  
  .mfp-counter {
    position: absolute;
    top: 0;
    right: 0;
    color: #cccccc;
    font-size: 12px;
    line-height: 18px; }
  
  .mfp-arrow {
    position: absolute;
    opacity: 0.65;
    margin: 0;
    top: 50%;
    margin-top: -55px;
    padding: 0;
    width: 90px;
    height: 110px;
    -webkit-tap-highlight-color: rgba(0, 0, 0, 0); }
  
  .mfp-arrow:active {
    margin-top: -54px; }
  
  .mfp-arrow:hover,
  .mfp-arrow:focus {
    opacity: 1; }
  
  .mfp-arrow:before, .mfp-arrow:after,
  .mfp-arrow .mfp-b,
  .mfp-arrow .mfp-a {
    content: '';
    display: block;
    width: 0;
    height: 0;
    position: absolute;
    left: 0;
    top: 0;
    margin-top: 35px;
    margin-left: 35px;
    border: medium inset transparent; }
  .mfp-arrow:after,
  .mfp-arrow .mfp-a {
    border-top-width: 13px;
    border-bottom-width: 13px;
    top: 8px; }
  .mfp-arrow:before,
  .mfp-arrow .mfp-b {
    border-top-width: 21px;
    border-bottom-width: 21px; }
  
  .mfp-arrow-left {
    left: 0; }
    .mfp-arrow-left:after,
    .mfp-arrow-left .mfp-a {
      border-right: 17px solid white;
      margin-left: 31px; }
    .mfp-arrow-left:before,
    .mfp-arrow-left .mfp-b {
      margin-left: 25px;
      border-right: 27px solid #3f3f3f; }
  
  .mfp-arrow-right {
    right: 0; }
    .mfp-arrow-right:after,
    .mfp-arrow-right .mfp-a {
      border-left: 17px solid white;
      margin-left: 39px; }
    .mfp-arrow-right:before,
    .mfp-arrow-right .mfp-b {
      border-left: 27px solid #3f3f3f; }
  
  .mfp-iframe-holder {
    padding-top: 40px;
    padding-bottom: 40px; }
  
  .mfp-iframe-holder .mfp-content {
    line-height: 0;
    width: 100%;
    max-width: 900px; }
  
  .mfp-iframe-scaler {
    width: 100%;
    height: 0;
    overflow: hidden;
    padding-top: 56.25%; }
  
  .mfp-iframe-scaler iframe {
    position: absolute;
    display: block;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    box-shadow: 0 0 8px rgba(0, 0, 0, 0.6);
    background: black; }
  
  .mfp-iframe-holder .mfp-close {
    top: -40px; }
  
  /* Main image in popup */
  img.mfp-img {
    width: auto;
    max-width: 100%;
    height: auto;
    display: block;
    line-height: 0;
    -webkit-box-sizing: border-box;
    -moz-box-sizing: border-box;
    box-sizing: border-box;
    padding: 40px 0 40px;
    margin: 0 auto; }
  
  /* The shadow behind the image */
  .mfp-figure:after {
    content: '';
    position: absolute;
    left: 0;
    top: 40px;
    bottom: 40px;
    display: block;
    right: 0;
    width: auto;
    height: auto;
    z-index: -1;
    box-shadow: 0 0 8px rgba(0, 0, 0, 0.6);
    background: #444444; }
  
  .mfp-figure {
    line-height: 0; }
  
  .mfp-bottom-bar {
    margin-top: -36px;
    position: absolute;
    top: 100%;
    left: 0;
    width: 100%;
    cursor: auto; }
  
  .mfp-title {
    text-align: left;
    line-height: 18px;
    color: #f3f3f3;
    word-wrap: break-word;
    padding-right: 36px; }
  
  .mfp-figure small {
    color: #bdbdbd;
    display: block;
    font-size: 12px;
    line-height: 14px; }
  
  .mfp-image-holder .mfp-content {
    max-width: 100%; }
  
  .mfp-gallery .mfp-image-holder .mfp-figure {
    cursor: pointer; }
  
  @media screen and (max-width: 800px) and (orientation: landscape), screen and (max-height: 300px) {
    /**
     * Remove all paddings around the image on small screen
     */
    .mfp-img-mobile .mfp-image-holder {
      padding-left: 0;
      padding-right: 0; }
  
    .mfp-img-mobile img.mfp-img {
      padding: 0; }
  
    /* The shadow behind the image */
    .mfp-img-mobile .mfp-figure:after {
      top: 0;
      bottom: 0; }
  
    .mfp-img-mobile .mfp-bottom-bar {
      background: rgba(0, 0, 0, 0.6);
      bottom: 0;
      margin: 0;
      top: auto;
      padding: 3px 5px;
      position: fixed;
      -webkit-box-sizing: border-box;
      -moz-box-sizing: border-box;
      box-sizing: border-box; }
  
    .mfp-img-mobile .mfp-bottom-bar:empty {
      padding: 0; }
  
    .mfp-img-mobile .mfp-counter {
      right: 5px;
      top: 3px; }
  
    .mfp-img-mobile .mfp-close {
      top: 0;
      right: 0;
      width: 35px;
      height: 35px;
      line-height: 35px;
      background: rgba(0, 0, 0, 0.6);
      position: fixed;
      text-align: center;
      padding: 0; }
  
    .mfp-img-mobile .mfp-figure small {
      display: inline;
      margin-left: 5px; } }
  @media all and (max-width: 900px) {
    .mfp-arrow {
      -webkit-transform: scale(0.75);
      transform: scale(0.75); }
  
    .mfp-arrow-left {
      -webkit-transform-origin: 0;
      transform-origin: 0; }
  
    .mfp-arrow-right {
      -webkit-transform-origin: 100%;
      transform-origin: 100%; }
  
    .mfp-container {
      padding-left: 6px;
      padding-right: 6px; } }
  .mfp-ie7 .mfp-img {
    padding: 0; }
  .mfp-ie7 .mfp-bottom-bar {
    width: 600px;
    left: 50%;
    margin-left: -300px;
    margin-top: 5px;
    padding-bottom: 5px; }
  .mfp-ie7 .mfp-container {
    padding: 0; }
  .mfp-ie7 .mfp-content {
    padding-top: 44px; }
  .mfp-ie7 .mfp-close {
    top: 0;
    right: 0;
    padding-top: 0; }
  
  //Magnific overrides
  .mfp-image img{
    background: white;
  }
  .mfp-figure:after {
    background: white;
  }
  
  /*
   * Off Canvas navbar toggle right
   * --------------------------------------------------
   */
  
  @media screen and (max-width: 768px) {
    .row-offcanvas .collapsing {
    -webkit-transition: none 0;
      -moz-transition: none 0;
      transition: none 0;
    }
   .row-offcanvas .navbar {
    position: absolute;
    z-index: 2;
      right:0;
      height:100%;
      width:55px;
      border:0;
      background-color:transparent;
    }
    .row-offcanvas .navbar-toggle {
      margin-right: 5px;
      margin-left: 5px;
    }
    .row-offcanvas {
      position: relative;
    }
    .row-offcanvas-right.active .navbar {
    position: absolute;
    z-index: 2;
      right: -28.4%;
      width:40%;
      background-color:#eee;
      border:0 solid #ddd;
      border-left-width:1px;
    }
    .row-offcanvas-right.active {
      left: -30%;
    }
    .row-offcanvas-right.active .navbar-collapse {
      position: relative;
      width: 100%;
    }
    .row-offcanvas .content {
    /*width:calc(100% - 60px);*/
    }
  }
  </style>
</head>
<body>
<div id="wrap">
<div class="container">
<div class="row row-offcanvas row-offcanvas-right">
<div class="contents col-xs-12 col-md-10">
<div class="row">
<button class="message R toggle btn btn-xs btn-info">
<span class="glyphicon glyphicon-chevron-down"></span> R message
</button>
<pre style=""><code class="message r">## Loading required package: knitr
</code></pre>
</div>
<div class="row">
<button class="source R toggle btn btn-xs btn-primary">
<span class="glyphicon glyphicon-chevron-down"></span> R source
</button>
<pre style=""><code class="source r">## The basic files and libraries needed for most presentations
# creates the libraries and common-functions sections
read_chunk("../common/utility_functions.R")</code></pre>
</div>
<div class="row">
<button class="source R toggle btn btn-xs btn-primary">
<span class="glyphicon glyphicon-chevron-down"></span> R source
</button>
<pre style=""><code class="source r">require(ggplot2) #for plots
require(lattice) # nicer scatter plots
require(plyr) # for processing data.frames
library(dplyr)
require(grid) # contains the arrow function
require(jpeg)
require(doMC) # for parallel code
require(png) # for reading png images
require(gridExtra)

require(reshape2) # for the melt function
#if (!require("biOps")) {
#  # for basic image processing
#  devtools::install_github("cran/biOps")
#  library("biOps")
#}
## To install EBImage
if (!require("EBImage")) { # for more image processing
  source("http://bioconductor.org/biocLite.R")
  biocLite("EBImage")
}

used.libraries<-c("ggplot2","lattice","plyr","reshape2","grid","gridExtra","biOps","png","EBImage")</code></pre>
</div>
<div class="row">
<button class="source R toggle btn btn-xs btn-primary">
<span class="glyphicon glyphicon-chevron-down"></span> R source
</button>
<pre style=""><code class="source r"># start parallel environment
registerDoMC()
# functions for converting images back and forth
im.to.df<-function(in.img,out.col="val") {
  out.im<-expand.grid(x=1:nrow(in.img),y=1:ncol(in.img))
  out.im[,out.col]<-as.vector(in.img)
  out.im
}
df.to.im<-function(in.df,val.col="val",inv=F) {
  in.vals<-in.df[[val.col]]
  if(class(in.vals[1])=="logical") in.vals<-as.integer(in.vals*255)
  if(inv) in.vals<-255-in.vals
  out.mat<-matrix(in.vals,nrow=length(unique(in.df$x)),byrow=F)
  attr(out.mat,"type")<-"grey"
  out.mat
}
ddply.cutcols<-function(...,cols=1) {
  # run standard ddply command 
  cur.table<-ddply(...)
  cutlabel.fixer<-function(oVal) {
    sapply(oVal,function(x) {
      cnv<-as.character(x)
      mean(as.numeric(strsplit(substr(cnv,2,nchar(cnv)-1),",")[[1]]))
    })
  }
  cutname.fixer<-function(c.str) {
    s.str<-strsplit(c.str,"(",fixed=T)[[1]]
    t.str<-strsplit(paste(s.str[c(2:length(s.str))],collapse="("),",")[[1]]
    paste(t.str[c(1:length(t.str)-1)],collapse=",")
  }
  for(i in c(1:cols)) {
    cur.table[,i]<-cutlabel.fixer(cur.table[,i])
    names(cur.table)[i]<-cutname.fixer(names(cur.table)[i])
  }
  cur.table
}

# since biOps isn't available use a EBImage based version
imgSobel<-function(img) {
  kern<-makeBrush(3)*(-1)
  kern[2,2]<-8
  filter2(img,kern)
}


show.pngs.as.grid<-function(file.list,title.fun,zoom=1) {
  preparePng<-function(x) rasterGrob(readPNG(x,native=T,info=T),width=unit(zoom,"npc"),interp=F)
  labelPng<-function(x,title="junk") (qplot(1:300, 1:300, geom="blank",xlab=NULL,ylab=NULL,asp=1)+
                                        annotation_custom(preparePng(x))+
                                        labs(title=title)+theme_bw(24)+
                                        theme(axis.text.x = element_blank(),
                                              axis.text.y = element_blank()))
  imgList<-llply(file.list,function(x) labelPng(x,title.fun(x)) )
  do.call(grid.arrange,imgList)
}
## Standard image processing tools which I use for visualizing the examples in the script
commean.fun<-function(in.df) {
  ddply(in.df,.(val), function(c.cell) {
    weight.sum<-sum(c.cell$weight)
    data.frame(xv=mean(c.cell$x),
               yv=mean(c.cell$y),
               xm=with(c.cell,sum(x*weight)/weight.sum),
               ym=with(c.cell,sum(y*weight)/weight.sum)
    )
  })
}

colMeans.df<-function(x,...) as.data.frame(t(colMeans(x,...)))

pca.fun<-function(in.df) {
  ddply(in.df,.(val), function(c.cell) {
    c.cell.cov<-cov(c.cell[,c("x","y")])
    c.cell.eigen<-eigen(c.cell.cov)
    
    c.cell.mean<-colMeans.df(c.cell[,c("x","y")])
    out.df<-cbind(c.cell.mean,
                  data.frame(vx=c.cell.eigen$vectors[1,],
                             vy=c.cell.eigen$vectors[2,],
                             vw=sqrt(c.cell.eigen$values),
                             th.off=atan2(c.cell.eigen$vectors[2,],c.cell.eigen$vectors[1,]))
    )
  })
}
vec.to.ellipse<-function(pca.df) {
  ddply(pca.df,.(val),function(cur.pca) {
    # assume there are two vectors now
    create.ellipse.points(x.off=cur.pca[1,"x"],y.off=cur.pca[1,"y"],
                          b=sqrt(5)*cur.pca[1,"vw"],a=sqrt(5)*cur.pca[2,"vw"],
                          th.off=pi/2-atan2(cur.pca[1,"vy"],cur.pca[1,"vx"]),
                          x.cent=cur.pca[1,"x"],y.cent=cur.pca[1,"y"])
  })
}

# test function for ellipse generation
# ggplot(ldply(seq(-pi,pi,length.out=100),function(th) create.ellipse.points(a=1,b=2,th.off=th,th.val=th)),aes(x=x,y=y))+geom_path()+facet_wrap(~th.val)+coord_equal()
create.ellipse.points<-function(x.off=0,y.off=0,a=1,b=NULL,th.off=0,th.max=2*pi,pts=36,...) {
  if (is.null(b)) b<-a
  th<-seq(0,th.max,length.out=pts)
  data.frame(x=a*cos(th.off)*cos(th)+b*sin(th.off)*sin(th)+x.off,
             y=-1*a*sin(th.off)*cos(th)+b*cos(th.off)*sin(th)+y.off,
             id=as.factor(paste(x.off,y.off,a,b,th.off,pts,sep=":")),...)
}
deform.ellipse.draw<-function(c.box) {
  create.ellipse.points(x.off=c.box$x[1],
                        y.off=c.box$y[1],
                        a=c.box$a[1],
                        b=c.box$b[1],
                        th.off=c.box$th[1],
                        col=c.box$col[1])                    
}
bbox.fun<-function(in.df) {
  ddply(in.df,.(val), function(c.cell) {
    c.cell.mean<-colMeans.df(c.cell[,c("x","y")])
    xmn<-emin(c.cell$x)
    xmx<-emax(c.cell$x)
    ymn<-emin(c.cell$y)
    ymx<-emax(c.cell$y)
    out.df<-cbind(c.cell.mean,
                  data.frame(xi=c(xmn,xmn,xmx,xmx,xmn),
                             yi=c(ymn,ymx,ymx,ymn,ymn),
                             xw=xmx-xmn,
                             yw=ymx-ymn
                  ))
  })
}

# since the edge of the pixel is 0.5 away from the middle of the pixel
emin<-function(...) min(...)-0.5
emax<-function(...) max(...)+0.5
extents.fun<-function(in.df) {
  ddply(in.df,.(val), function(c.cell) {
    c.cell.mean<-colMeans.df(c.cell[,c("x","y")])
    out.df<-cbind(c.cell.mean,data.frame(xmin=c(c.cell.mean$x,emin(c.cell$x)),
                                         xmax=c(c.cell.mean$x,emax(c.cell$x)),
                                         ymin=c(emin(c.cell$y),c.cell.mean$y),
                                         ymax=c(emax(c.cell$y),c.cell.mean$y)))
  })
}

common.image.path<-"../common"
qbi.file<-function(file.name) file.path(common.image.path,"figures",file.name)
qbi.data<-function(file.name) file.path(common.image.path,"data",file.name)

th_fillmap.fn<-function(max.val) scale_fill_gradientn(colours=rainbow(10),limits=c(0,max.val))</code></pre>
</div>
<h1 id="quantitative-big-imaging">Quantitative Big Imaging</h1>
<p>author: Kevin Mader date: 10 March 2016 width: 1440 height: 900 css: ../common/template.css transition: rotate</p>
<h2 id="basic-segmentation-and-discrete-binary-structures">Basic Segmentation and Discrete Binary Structures</h2>
<h1 id="course-outline">Course Outline</h1>
<div class="row">
<button class="source R toggle btn btn-xs btn-primary">
<span class="glyphicon glyphicon-chevron-down"></span> R source
</button>
<pre style=""><code class="source r">source('../common/schedule.R')</code></pre>
<ul>
<li>25th February - Introduction and Workflows</li>
<li>3rd March - Image Enhancement (A. Kaestner)</li>
<li>10th March - Basic Segmentation, Discrete Binary Structures</li>
<li>17th March - Advanced Segmentation</li>
<li>24th March - Analyzing Single Objects</li>
<li>7th April - Analyzing Complex Objects</li>
<li>14th April - Spatial Distribution</li>
<li>21st April - Statistics and Reproducibility</li>
<li>28th April - Dynamic Experiments</li>
<li>12th May - Scaling Up / Big Data</li>
<li>19th May - Guest Lecture - High Content Screening</li>
<li>26th May - Guest Lecture - Machine Learning / Deep Learning and More Advanced Approaches</li>
<li>2nd June - Project Presentations
</div></li>
</ul>
<h1 id="lesson-outline">Lesson Outline</h1>
<ul>
<li>Motivation</li>
<li>Qualitative Approaches</li>
<li>Thresholding</li>
<li>Other types of images</li>
<li>Selecting a good threshold</li>
<li>Implementation</li>
<li>Morphology</li>
<li>Contouring / Mask Creation</li>
</ul>
<hr />
<h3 id="applications">Applications</h3>
<ul>
<li>Simple two-phase materials (bone, cells, etc)</li>
<li>Beyond 1 channel of depth</li>
<li>Multiple phase materials</li>
<li>Filling holes in materials</li>
<li>Segmenting Fossils</li>
<li>Attempting to segment the cortex in brain imaging <img src="ext-figures/cortex.png" alt="Cortex Image" /></li>
</ul>
<h1 id="literature-useful-references">Literature / Useful References</h1>
<ul>
<li>Jean Claude, Morphometry with R</li>
<li><a href="http://link.springer.com/book/10.1007%2F978-0-387-77789-4">Online</a> through ETHZ</li>
<li><a href="http://www.amazon.com/Morphometrics-R-Use-Julien-Claude/dp/038777789X">Buy it</a></li>
<li>John C. Russ, “The Image Processing Handbook”,(Boca Raton, CRC Press)</li>
<li>Available <a href="http://dx.doi.org/10.1201/9780203881095">online</a> within domain ethz.ch (or proxy.ethz.ch / public VPN)</li>
</ul>
<hr />
<h3 id="models-roc-curves">Models / ROC Curves</h3>
<ul>
<li><a href="https://www.youtube.com/watch?v=ryZL4XNUmwo">Julia Evans - Recalling with Precision</a></li>
<li><a href="https://github.com/stripe/topmodel">Stripe’s Next Top Model</a></li>
</ul>
<h1 id="motivation-why-do-we-do-imaging-experiments">Motivation: Why do we do imaging experiments?</h1>
<h1 id="incremental-true">incremental: true</h1>
<ul>
<li>Exploratory</li>
<li>To visually, qualitatively examine samples and differences between them</li>
<li>No prior knowledge or expectations</li>
<li>To test a hypothesis</li>
<li>Quantitative assessment coupled with statistical analysis</li>
<li>Does temperature affect bubble size?</li>
<li>Is this gene important for cell shape and thus mechanosensation in bone?</li>
<li>Does higher canal volume make bones weaker?</li>
<li>Does the granule shape affect battery life expectancy?</li>
</ul>
<hr />
<ul>
<li>What we are looking at <img src="ext-figures/Average_prokaryote_cell.svg" alt="Standard Cell, http://en.wikipedia.org/wiki/File:Average_prokaryote_cell-_en.svg" /></li>
<li>What we get from the imaging modality
<div class="row">
<button class="source R toggle btn btn-xs btn-primary">
<span class="glyphicon glyphicon-chevron-down"></span> R source
</button>
<pre style=""><code class="source r">dkimg<-jpeg::readJPEG("../common/figures/Average_prokaryote_cell.jpg")
material.img<-1-(dkimg[,,1]+dkimg[,,2]+dkimg[,,3])/3
# assume the sample is constant 0.1m thick and color indicates alpha
gray.img<-1.0*exp(-material.img*0.1)
cellImage<-im.to.df(gray.img)
ggplot(cellImage,aes(x=y,y=-x,fill=val))+
  geom_tile()+guides(fill=F)+theme_bw(20)</code></pre>
<div class="row">
<div class="col-md-offset-3 col-md-6">
<a href="#" class="thumbnail"><img src="print_figures/unnamed-chunk-2-1.png" title="Single Cell" alt="Single Cell" style="display: block; margin: auto;" /></a>
</div>
</div>
</div></li>
</ul>
<h1 id="to-test-a-hypothesis">To test a hypothesis</h1>
<ul>
<li>We perform an experiment bone to see how big the cells are inside the tissue <br /><span class="math display">↓</span><br /> <img src="ext-figures/tomoimage.png" alt="Bone Measurement" /></li>
</ul>
<h3 id="x-2560-x-2160-x-32-bit-56gb-sample">2560 x 2560 x 2160 x 32 bit = 56GB / sample</h3>
<ul>
<li>Filtering and Preprocessing!<br />
<br /><span class="math display">↓</span><br /></li>
<li>20h of computer time later …</li>
<li>56GB of less noisy data</li>
<li>Way too much data, we need to reduce</li>
</ul>
<h1 id="what-did-we-want-in-the-first-place">What did we want in the first place</h1>
<h1 id="incremental-true-1">incremental: true</h1>
<h3 id="single-number"><em>Single number</em>:</h3>
<ul>
<li>volume fraction,</li>
<li>cell count,</li>
<li>average cell stretch,</li>
<li>cell volume variability</li>
</ul>
<h1 id="why-do-we-perform-segmentation">Why do we perform segmentation?</h1>
<ul>
<li>In model-based analysis every step we peform, simple or complicated is related to an underlying model of the system we are dealing with</li>
<li><a href="http://en.wikipedia.org/wiki/Occams_Razor"><em>Occam’s Razor</em></a> is very important here : The simplest solution is usually the right one</li>
<li>Bayesian, neural networks optimized using genetic algorithms with Fuzzy logic has a much larger parameter space to explore, establish sensitivity in, and must perform much better and be tested much more thoroughly than thresholding to be justified.</li>
<li>We will cover some of these techniques in the next 2 lectures since they can be very powerful particularly with unknown data</li>
</ul>
<h1 id="review-filtering-and-image-enhancement">Review: Filtering and Image Enhancement</h1>
<p>incremental: true</p>
<ul>
<li>This was a noise process which was added to otherwise clean imaging data</li>
<li><br /><span class="math display"><em>I</em><sub><em>m</em><em>e</em><em>a</em><em>s</em><em>u</em><em>r</em><em>e</em><em>d</em></sub>(<em>x</em>, <em>y</em>)=<em>I</em><sub><em>s</em><em>a</em><em>m</em><em>p</em><em>l</em><em>e</em></sub>(<em>x</em>, <em>y</em>)+Noise(<em>x</em>, <em>y</em>)</span><br /></li>
<li>What would the perfect filter be</li>
<li><br /><span class="math display"><em>Filter</em> * <em>I</em><sub><em>s</em><em>a</em><em>m</em><em>p</em><em>l</em><em>e</em></sub>(<em>x</em>, <em>y</em>)=<em>I</em><sub><em>s</em><em>a</em><em>m</em><em>p</em><em>l</em><em>e</em></sub>(<em>x</em>, <em>y</em>)</span><br /></li>
<li><br /><span class="math display"><em>Filter</em> * Noise(<em>x</em>, <em>y</em>)=0</span><br /></li>
<li><br /><span class="math display">$$ \textit{Filter} \ast I_{measured}(x,y) = \textit{Filter} \ast I_{real}(x,y) + \textit{Filter}\ast \text{Noise}(x,y) \rightarrow \bf I_{sample}(x,y) $$</span><br /></li>
<li>What most filters end up doing <br /><span class="math display"><em>Filter</em> * <em>I</em><sub><em>m</em><em>e</em><em>a</em><em>s</em><em>u</em><em>r</em><em>e</em><em>d</em></sub>(<em>x</em>, <em>y</em>)=90%<em>I</em><sub><em>r</em><em>e</em><em>a</em><em>l</em></sub>(<em>x</em>, <em>y</em>)+10%Noise(<em>x</em>, <em>y</em>)</span><br /></li>
<li>What bad filters do <br /><span class="math display"><em>Filter</em> * <em>I</em><sub><em>m</em><em>e</em><em>a</em><em>s</em><em>u</em><em>r</em><em>e</em><em>d</em></sub>(<em>x</em>, <em>y</em>)=10%<em>I</em><sub><em>r</em><em>e</em><em>a</em><em>l</em></sub>(<em>x</em>, <em>y</em>)+90%Noise(<em>x</em>, <em>y</em>)</span><br /></li>
</ul>
<h1 id="qualitative-metrics-what-did-people-used-to-do">Qualitative Metrics: What did people used to do?</h1>
<ul>
<li>What comes out of our detector / enhancement process
<div class="row">
<button class="source R toggle btn btn-xs btn-primary">
<span class="glyphicon glyphicon-chevron-down"></span> R source
</button>
<pre style=""><code class="source r">ggplot(cellImage,aes(x=y,y=400-x,fill=val))+
  geom_tile()+guides(fill=F)+theme_bw(20)+labs(x="x",y="y")</code></pre>
<div class="row">
<div class="col-md-offset-3 col-md-6">
<a href="#" class="thumbnail"><img src="print_figures/unnamed-chunk-3-1.png" title="Single Cell" alt="Single Cell" style="display: block; margin: auto;" /></a>
</div>
</div>
</div></li>
</ul>
<hr />
<ul>
<li>Identify objects by eye</li>
<li>Count, describe qualitatively: “many little cilia on surface”, “long curly flaggelum”, “elongated nuclear structure”</li>
<li>Morphometrics</li>
<li>Trace the outline of the object (or sub-structures)</li>
<li>Can calculate the area by using equal-weight-paper</li>
<li>Employing the “<a href="http://ion.chem.usu.edu/~sbialkow/Classes/361/GC/GC.html">cut-and-weigh</a>” method</li>
</ul>
<h1 id="segmentation-approaches">Segmentation Approaches</h1>
<p>They match up well to the world view / perspective</p>
<p><img src="../common/figures/approaches.png" alt="Approaches" /></p>
<hr />
<h3 id="model-based">Model-Based</h3>
<ul>
<li><span class="math inline">→</span> Experimentalist</li>
</ul>
<p>-Problem-driven</p>
<ul>
<li>Top-down</li>
<li><em>Reality</em> Model-based</li>
</ul>
<h3 id="machine-learning-approach">Machine Learning Approach</h3>
<ul>
<li><p><span class="math inline">→</span> Computer Vision / Deep Learning</p></li>
<li><p>Results-driven</p></li>
</ul>
<h1 id="model-based-analysis">Model-based Analysis</h1>
<p><img src="../common/figures/image-formation.png" alt="Traditional Imaging" /></p>
<ul>
<li>Many different imaging modalities ( <span class="math inline"><em>μ</em>CT</span> to MRI to Confocal to Light-field to AFM).</li>
<li>Similarities in underlying equations</li>
<li>different coefficients, units, and mechanism</li>
</ul>
<p><br /><span class="math display">$$ I_{measured}(\vec{x}) = F_{system}(I_{stimulus}(\vec{x}),S_{sample}(\vec{x})) $$</span><br /></p>
<h1 id="direct-imaging-simple">Direct Imaging (simple)</h1>
<ul>
<li><span class="math inline"><em>F</em><sub><em>s</em><em>y</em><em>s</em><em>t</em><em>e</em><em>m</em></sub>(<em>a</em>, <em>b</em>)=<em>a</em> * <em>b</em></span></li>
<li><span class="math inline"><em>I</em><sub><em>s</em><em>t</em><em>i</em><em>m</em><em>u</em><em>l</em><em>u</em><em>s</em></sub> = Beam<sub><em>p</em><em>r</em><em>o</em><em>f</em><em>i</em><em>l</em><em>e</em></sub></span></li>
<li><span class="math inline">$S_{system} = \alpha(\vec{x})$</span></li>
</ul>
<p><span class="math inline">$\longrightarrow \alpha(\vec{x})=\frac{I_{measured}(\vec{x})}{\textrm{Beam}_{profile}(\vec{x})}$</span></p>
<hr />
<div class="row">
<button class="source R toggle btn btn-xs btn-primary">
<span class="glyphicon glyphicon-chevron-down"></span> R source
</button>
<pre style=""><code class="source r">grad.beam.profile<-matrix(rep(0.9+0.00*c(1:nrow(gray.img)),ncol(gray.img)),dim(gray.img))
sample.img<-1.0*exp(-material.img*0.1)
ccd.img<-sample.img * grad.beam.profile
model.image<-subset(
  rbind(
  cbind(im.to.df(grad.beam.profile),type="Beam"),
  cbind(im.to.df(sample.img),type="Sample"),
  cbind(im.to.df(ccd.img),type="Detector")
  ),
  x%%3==0 & y%%3==0 # downsample by 9
  )
ggplot(model.image,aes(x=y,y=x,fill=val))+
  geom_tile()+
  guides(fill=F)+
  facet_grid(type~.)+
  coord_equal()+
  theme_bw(20)</code></pre>
<div class="row">
<div class="col-md-offset-3 col-md-6">
<a href="#" class="thumbnail"><img src="print_figures/unnamed-chunk-4-1.png" title="Single Cell" alt="Single Cell" style="display: block; margin: auto;" /></a>
</div>
</div>
</div>
<h1 id="nonuniform-beam-profiles">Nonuniform Beam-Profiles</h1>
<p>In many setups there is un-even illumination caused by incorrectly adjusted equipment and fluctations in power and setups</p>
<div class="row">
<button class="source R toggle btn btn-xs btn-primary">
<span class="glyphicon glyphicon-chevron-down"></span> R source
</button>
<pre style=""><code class="source r">grad.beam.profile<-matrix(rep(0.9+0.001*c(1:nrow(gray.img)),ncol(gray.img)),dim(gray.img))
sample.img<-1.0*exp(-material.img*0.1)
ccd.img<-sample.img * grad.beam.profile
model.image<-subset(
  rbind(
  cbind(im.to.df(grad.beam.profile),type="Beam"),
  cbind(im.to.df(sample.img),type="Sample"),
  cbind(im.to.df(ccd.img),type="Detector")
  ),
  x%%3==0 & y%%3==0 # downsample by 9
  )
ggplot(model.image,aes(x=y,y=x,fill=val))+
  geom_tile()+
  facet_grid(type~.)+
  coord_equal()+
  labs(fill="")+
  scale_fill_gradientn(colours=rainbow(6))+
  theme_bw(20)</code></pre>
<div class="row">
<div class="col-md-offset-3 col-md-6">
<a href="#" class="thumbnail"><img src="print_figures/unnamed-chunk-5-1.png" title="Gradient Profile" alt="Gradient Profile" style="display: block; margin: auto;" /></a>
</div>
</div>
</div>
<hr />
<p>Frequently there is a fall-off of the beam away from the center (as is the case of a Gaussian beam which frequently shows up for laser systems). This can make extracting detail away from the center challenging</p>
<div class="row">
<button class="source R toggle btn btn-xs btn-primary">
<span class="glyphicon glyphicon-chevron-down"></span> R source
</button>
<pre style=""><code class="source r">beam.profile<-mutate(
  expand.grid(x=1:nrow(material.img),y=1:ncol(material.img)),
  val=exp(-((x-mean(x))^2+(y-mean(y))^2)/350^2) # just a simple gaussian profile
  )
beam.profile<-df.to.im(beam.profile)
sample.img<-1.0*exp(-material.img*0.1)
ccd.img<-sample.img * beam.profile
model.image<-subset(
  rbind(
  cbind(im.to.df(beam.profile),type="Beam"),
  cbind(im.to.df(sample.img),type="Sample"),
  cbind(im.to.df(ccd.img),type="Detector")
  ),
  x%%3==0 & y%%3==0 # downsample by 9
  )
ggplot(model.image,aes(x=y,y=x,fill=val))+
  geom_tile()+
  facet_grid(type~.)+
  coord_equal()+
  scale_fill_gradientn(colours=rainbow(6))+
  labs(fill="")+
  theme_bw(20)</code></pre>
<div class="row">
<div class="col-md-offset-3 col-md-6">
<a href="#" class="thumbnail"><img src="print_figures/unnamed-chunk-6-1.png" title="Gaussian Beam" alt="Gaussian Beam" style="display: block; margin: auto;" /></a>
</div>
</div>
</div>
<h1 id="absorption-imaging-x-ray-ultrasound-optical">Absorption Imaging (X-ray, Ultrasound, Optical)</h1>
<ul>
<li>For absorption/attenuation imaging <span class="math inline">→</span> <a href="http://en.wikipedia.org/wiki/Attenuation_coefficient">Beer-Lambert Law</a> <br /><span class="math display">$$ I_{detector} = \underbrace{I_{source}}_{I_{stimulus}}\underbrace{\exp(-\alpha d)}_{S_{sample}} $$</span><br /></li>
<li><p>Different components have a different <span class="math inline"><em>α</em></span> based on the strength of the interaction between the light and the chemical / nuclear structure of the material <br /><span class="math display"><em>I</em><sub><em>s</em><em>a</em><em>m</em><em>p</em><em>l</em><em>e</em></sub>(<em>x</em>, <em>y</em>)=<em>I</em><sub><em>s</em><em>o</em><em>u</em><em>r</em><em>c</em><em>e</em></sub>exp(−<em>α</em>(<em>x</em>, <em>y</em>)<em>d</em>)</span><br /> <br /><span class="math display"><em>α</em> = <em>f</em>(<em>N</em>, <em>Z</em>, <em>σ</em>, ⋯)</span><br /></p></li>
<li>For segmentation this model is:</li>
<li>there are 2 (or more) distinct components that make up the image</li>
<li><p>these components are distinguishable by their values (or vectors, colors, tensors, …)</p></li>
</ul>
<hr />
<div class="row">
<button class="source R toggle btn btn-xs btn-primary">
<span class="glyphicon glyphicon-chevron-down"></span> R source
</button>
<pre style=""><code class="source r">nx<-4
ny<-4
grad.im<-expand.grid(x=c(-nx:nx)/nx*2*pi,y=c(-ny:ny)/ny*2*pi)
phase.im<-runif(nrow(grad.im))
grad.im<-cbind(grad.im,
               col=1*(phase.im>0.66)+
                 2*(phase.im<0.33)+
                 0.4*runif(nrow(grad.im),min=-1,max=1))
bn.wid<-diff(range(grad.im$col))/10

bl.fun<-function(x) 1*exp(-x*0.5)

ggplot(grad.im,aes(x=col,y=bl.fun(col)))+
  geom_point(aes(color=cut_interval(col,3)))+
  geom_segment(data=data.frame(
    x=c(0.5,1.5),y=c(0.25),
    xend=c(0.5,1.5),yend=c(1.25)
    ),aes(x=x,y=y,xend=xend,yend=yend),size=3,alpha=0.5)+
  labs(x=expression(alpha(x,y)),y=expression(paste("I"[sample],"(x,y)")),title="Probability Density Function",fill="Groups")+theme_bw(20)</code></pre>
<div class="row">
<div class="col-md-offset-3 col-md-6">
<a href="#" class="thumbnail"><img src="print_figures/unnamed-chunk-7-1.png" title="Attenuation to Intensity" alt="Attenuation to Intensity" style="display: block; margin: auto;" /></a>
</div>
</div>
</div>
<div class="row">
<button class="source R toggle btn btn-xs btn-primary">
<span class="glyphicon glyphicon-chevron-down"></span> R source
</button>
<pre style=""><code class="source r">ggplot(grad.im,aes(x=col))+
  geom_density(aes(fill=cut_interval(col,3)))+
  geom_segment(data=data.frame(
    x=c(0.5,1.5),y=c(0),
    xend=c(0.5,1.5),yend=c(6)
    ),aes(x=x,y=y,xend=xend,yend=yend),
    size=3,alpha=0.5)+
  labs(x=expression(alpha(x,y)),y="Frequency",title="Probability Density Function",fill="Groups")+theme_bw(20)</code></pre>
<div class="row">
<div class="col-md-offset-3 col-md-6">
<a href="#" class="thumbnail"><img src="print_figures/unnamed-chunk-8-1.png" title="Image Histogram" alt="Image Histogram" style="display: block; margin: auto;" /></a>
</div>
</div>
</div>
<h1 id="where-does-segmentation-get-us">Where does segmentation get us?</h1>
<p>incremental: true</p>
<ul>
<li>We convert a decimal value (or something even more complicated like 3 values for RGB images, a spectrum for hyperspectral imaging, or a vector / tensor in a mechanical stress field)</li>
<li><p>to a single, discrete value (usually true or false, but for images with phases it would be each phase, e.g. bone, air, cellular tissue)</p></li>
<li><strong>2560 x 2560 x 2160 x 32 bit = 56GB / sample</strong> <br /><span class="math display">↓</span><br /></li>
<li><p>2560 x 2560 x 2160 x <strong>1 bit</strong> = 1.75GB / sample</p></li>
</ul>
<h1 id="applying-a-threshold-to-an-image">Applying a threshold to an image</h1>
Start out with a simple image of a cross with added noise <br /><span class="math display"><em>I</em>(<em>x</em>, <em>y</em>)=<em>f</em>(<em>x</em>, <em>y</em>)</span><br />
<div class="row">
<button class="source R toggle btn btn-xs btn-primary">
<span class="glyphicon glyphicon-chevron-down"></span> R source
</button>
<pre style=""><code class="source r">nx<-5
ny<-5
cross.im<-expand.grid(x=c(-nx:nx)/nx*2*pi,y=c(-ny:ny)/ny*2*pi)
cross.im<-cbind(cross.im,
               col=1.5*with(cross.im,abs(cos(x*y))/(abs(x*y)+(3*pi/nx)))+
                 0.5*runif(nrow(cross.im)))
bn.wid<-diff(range(cross.im$col))/10
ggplot(cross.im,aes(x=x,y=y,fill=col))+
  geom_tile()+
  scale_fill_gradient(low="black",high="white")+
  labs(fill="Intensity")+
  theme_bw(20)</code></pre>
<div class="row">
<div class="col-md-offset-3 col-md-6">
<a href="#" class="thumbnail"><img src="print_figures/unnamed-chunk-9-1.png" title="" alt="" style="display: block; margin: auto;" /></a>
</div>
</div>
</div>
<hr />
The intensity can be described with a probability density function <br /><span class="math display"><em>P</em><sub><em>f</em></sub>(<em>x</em>, <em>y</em>)</span><br />
<div class="row">
<button class="source R toggle btn btn-xs btn-primary">
<span class="glyphicon glyphicon-chevron-down"></span> R source
</button>
<pre style=""><code class="source r">ggplot(cross.im,aes(x=col))+geom_histogram(binwidth=bn.wid)+
  labs(x="Intensity",title="Probability Density Function")+
  theme_bw(20)</code></pre>
<div class="row">
<div class="col-md-offset-3 col-md-6">
<a href="#" class="thumbnail"><img src="print_figures/unnamed-chunk-10-1.png" title="Probability density function" alt="Probability density function" style="display: block; margin: auto;" /></a>
</div>
</div>
</div>
<h1 id="applying-a-threshold-to-an-image-1">Applying a threshold to an image</h1>
<p>By examining the image and probability distribution function, we can <em>deduce</em> that the underyling model is a whitish phase that makes up the cross and the darkish background</p>
<div class="row">
<button class="source R toggle btn btn-xs btn-primary">
<span class="glyphicon glyphicon-chevron-down"></span> R source
</button>
<pre style=""><code class="source r">thresh.val<-0.75
cross.im$val<-(cross.im$col>=thresh.val)
ggplot(cross.im,aes(x=x,y=y))+
  geom_tile(aes(fill=col))+
  geom_tile(data=subset(cross.im,val),fill="red",color="black",alpha=0.3)+
  geom_tile(data=subset(cross.im,!val),fill="blue",color="black",alpha=0.3)+
  scale_fill_gradient(low="black",high="white")+
  labs(fill="Intensity")+
  theme_bw(20)</code></pre>
<div class="row">
<div class="col-md-offset-3 col-md-6">
<a href="#" class="thumbnail"><img src="print_figures/unnamed-chunk-11-1.png" title="With Threshold Overlay" alt="With Threshold Overlay" style="display: block; margin: auto;" /></a>
</div>
</div>
</div>
<hr />
<p>Applying the threshold is a deceptively simple operation</p>
<p><br /><span class="math display">$$ I(x,y) = 
\begin{cases}
1, &amp; f(x,y)\geq0.5 \\
0, &amp; f(x,y)&lt;0.5
\end{cases}$$</span><br /></p>
<div class="row">
<button class="source R toggle btn btn-xs btn-primary">
<span class="glyphicon glyphicon-chevron-down"></span> R source
</button>
<pre style=""><code class="source r">ggplot(cbind(cross.im,in.thresh=cross.im$col>=thresh.val),aes(x=col))+
  geom_histogram(binwidth=bn.wid,aes(fill=in.thresh))+
  labs(x="Intensity",color="In Threshold")+scale_fill_manual(values=c("blue","red"))+
  theme_bw(20)</code></pre>
<div class="row">
<div class="col-md-offset-3 col-md-6">
<a href="#" class="thumbnail"><img src="print_figures/unnamed-chunk-12-1.png" title="With Threshold Overlay" alt="With Threshold Overlay" style="display: block; margin: auto;" /></a>
</div>
</div>
</div>
<h1 id="various-thresholds">Various Thresholds</h1>
<div class="row">
<button class="source R toggle btn btn-xs btn-primary">
<span class="glyphicon glyphicon-chevron-down"></span> R source
</button>
<pre style=""><code class="source r">thresh.vals<-c(2:10)/10
grad.im.th<-ldply(thresh.vals,function(thresh.val) 
  cbind(cross.im,thresh=thresh.val,in.thresh=(cross.im$col>=thresh.val)))
ggplot(grad.im.th,aes(x=col))+
  geom_histogram(binwidth=bn.wid,aes(fill=in.thresh))+
  labs(x="Intensity",fill="Above Threshold")+facet_wrap(~thresh)+
  theme_bw(15)</code></pre>
<div class="row">
<div class="col-md-offset-3 col-md-6">
<a href="#" class="thumbnail"><img src="print_figures/unnamed-chunk-13-1.png" title="Threshold Histograms" alt="Threshold Histograms" style="display: block; margin: auto;" /></a>
</div>
</div>
</div>
<hr />
<div class="row">
<button class="source R toggle btn btn-xs btn-primary">
<span class="glyphicon glyphicon-chevron-down"></span> R source
</button>
<pre style=""><code class="source r">ggplot(grad.im.th,aes(x=x,y=y))+
  geom_tile(aes(fill=in.thresh),color="black",alpha=0.75)+
  labs(fill="Above Threshold")+facet_wrap(~thresh)+
  theme_bw(20)</code></pre>
<div class="row">
<div class="col-md-offset-3 col-md-6">
<a href="#" class="thumbnail"><img src="print_figures/unnamed-chunk-14-1.png" title="Threshold Images" alt="Threshold Images" style="display: block; margin: auto;" /></a>
</div>
</div>
</div>
<h1 id="segmenting-cells">Segmenting Cells</h1>
<div class="row">
<button class="source R toggle btn btn-xs btn-primary">
<span class="glyphicon glyphicon-chevron-down"></span> R source
</button>
<pre style=""><code class="source r">cellImage<-im.to.df(jpeg::readJPEG("ext-figures/Cell_Colony.jpg"))
ggplot(cellImage,aes(x=x,y=y,fill=val))+
  geom_tile()+
  labs(fill="Intensity")+coord_equal()+
  theme_bw(20)</code></pre>
<div class="row">
<div class="col-md-offset-3 col-md-6">
<a href="#" class="thumbnail"><img src="print_figures/unnamed-chunk-15-1.png" title="Cell Colony" alt="Cell Colony" style="display: block; margin: auto;" /></a>
</div>
</div>
</div>
<div class="row">
<div class="row">
<div class="col-md-offset-3 col-md-6">
<a href="#" class="thumbnail"><img src="print_figures/unnamed-chunk-16-1.png" title="plot of chunk unnamed-chunk-16" alt="plot of chunk unnamed-chunk-16" style="display: block; margin: auto;" /></a>
</div>
</div>
</div>
<hr />
<ul>
<li>We can peform the same sort of analysis with this image of cells</li>
<li>This time we can derive the model from the basic physics of the system</li>
<li>The field is illuminated by white light of nearly uniform brightness</li>
<li>Cells absorb light causing darker regions to appear in the image</li>
<li><em>Lighter</em> regions have no cells</li>
<li><strong>Darker</strong> regions have cells</li>
</ul>
<h1 id="different-threshold-values">Different Threshold Values</h1>
<div class="row">
<button class="source R toggle btn btn-xs btn-primary">
<span class="glyphicon glyphicon-chevron-down"></span> R source
</button>
<pre style=""><code class="source r">th.vals<-seq(0.4,0.85,length.out=3)
thlabel<-function(x,...) switch(x,"Too low","Good","Too high")
im.vals<-ldply(1:length(th.vals),function(th.val)
  cbind(cellImage,
        in.thresh=ifelse(cellImage$val<th.vals[th.val],"Cell","Background"),
        th.val=th.vals[th.val],
        th.label=thlabel(th.val)))
ggplot(im.vals,aes(x=x,y=y,fill=in.thresh))+
  geom_raster()+facet_grid(th.label~.)+
  labs(fill="Phase")+
  theme_bw(20)+coord_equal()</code></pre>
<div class="row">
<div class="col-md-offset-3 col-md-6">
<a href="#" class="thumbnail"><img src="print_figures/unnamed-chunk-17-1.png" title="Cell Colony" alt="Cell Colony" style="display: block; margin: auto;" /></a>
</div>
</div>
</div>
<hr />
<div class="row">
<div class="row">
<div class="col-md-offset-3 col-md-6">
<a href="#" class="thumbnail"><img src="print_figures/unnamed-chunk-18-1.png" title="plot of chunk unnamed-chunk-18" alt="plot of chunk unnamed-chunk-18" style="display: block; margin: auto;" /></a>
</div>
</div>
</div>
<h1 id="other-image-types">Other Image Types</h1>
While scalar images are easiest, it is possible for any type of image <br /><span class="math display">$$ I(x,y) = \vec{f}(x,y) $$</span><br />
<div class="row">
<button class="source R toggle btn btn-xs btn-primary">
<span class="glyphicon glyphicon-chevron-down"></span> R source
</button>
<pre style=""><code class="source r">nx<-7
ny<-7
n.pi<-4
grad.im<-expand.grid(x=c(-nx:nx)/nx*n.pi*pi,y=c(-ny:ny)/ny*n.pi*pi)

grad.im<-cbind(grad.im,
               col=1.5*with(grad.im,abs(cos(x*y))/(abs(x*y)+(3*pi/nx)))+
                 0.5*runif(nrow(grad.im)),
               x.vec=with(grad.im,y),
               y.vec=with(grad.im,x))
# normalize vector
grad.im[,c("x.vec","y.vec")]<-with(grad.im,cbind(x.vec/(sqrt(x.vec^2+y.vec^2)),
                                         y.vec/(sqrt(x.vec^2+y.vec^2))))
bn.wid<-c(diff(range(grad.im$x.vec))/10,diff(range(grad.im$y.vec))/10)
ggplot(grad.im,aes(x=x,y=y,fill=col))+
  geom_segment(aes(xend=x+x.vec,yend=y+y.vec),arrow=arrow(length = unit(0.15,"cm")),size=2)+
  scale_fill_gradient(low="black",high="white")+
  guides(fill=F)+labs(title="Orientation Map")+
  theme_bw(20)</code></pre>
<div class="row">
<div class="col-md-offset-3 col-md-6">
<a href="#" class="thumbnail"><img src="print_figures/unnamed-chunk-19-1.png" title="" alt="" style="display: block; margin: auto;" /></a>
</div>
</div>
</div>
<hr />
The intensity can be described with two seperate or a single joint probability density function <br /><span class="math display">$$ P_{\vec{f}\cdot \vec{i}}(x,y), P_{\vec{f}\cdot \vec{j}}(x,y) $$</span><br />
<div class="row">
<button class="source R toggle btn btn-xs btn-primary">
<span class="glyphicon glyphicon-chevron-down"></span> R source
</button>
<pre style=""><code class="source r">ggplot(grad.im,aes(x=x.vec,y=y.vec))+
  stat_bin2d(binwidth=c(0.25,.25),drop=F)+
  labs(x="Pfx",y="Pfy",fill="Frequency",title="Orientation Histogram")+
  xlim(-1,1)+ylim(-1,1)+
  theme_bw(20)</code></pre>
<div class="row">
<div class="col-md-offset-3 col-md-6">
<a href="#" class="thumbnail"><img src="print_figures/unnamed-chunk-20-1.png" title="With Threshold Overlay" alt="With Threshold Overlay" style="display: block; margin: auto;" /></a>
</div>
</div>
</div>
<h1 id="applying-a-threshold">Applying a threshold</h1>
A threshold is now more difficult to apply since there are now two distinct variables to deal with. The standard approach can be applied to both <br /><span class="math display">$$ I(x,y) = 
\begin{cases}
1, &amp; \vec{f}_x(x,y) \geq0.25 \text{ and}\\
&amp; \vec{f}_y(x,y) \geq0.25 \\
0, &amp; \text{otherwise}
\end{cases}$$</span><br />
<div class="row">
<button class="source R toggle btn btn-xs btn-primary">
<span class="glyphicon glyphicon-chevron-down"></span> R source
</button>
<pre style=""><code class="source r">g.with.thresh<-cbind(grad.im,in.thresh=with(grad.im,x.vec>0.25 & y.vec>0.25))
ggplot(g.with.thresh,
       aes(x=x,y=y,fill=in.thresh,color=in.thresh))+
  geom_tile(alpha=0.5,aes(fill=in.thresh))+
  geom_segment(aes(xend=x+x.vec,yend=y+y.vec),arrow=arrow(length = unit(0.2,"cm")),size=3)+
  labs(color="In Threshold")+guides(fill=FALSE)+
  theme_bw(20)</code></pre>
<div class="row">
<div class="col-md-offset-3 col-md-6">
<a href="#" class="thumbnail"><img src="print_figures/unnamed-chunk-21-1.png" title="" alt="" style="display: block; margin: auto;" /></a>
</div>
</div>
</div>
<hr />
This can also be shown on the joint probability distribution as
<div class="row">
<button class="source R toggle btn btn-xs btn-primary">
<span class="glyphicon glyphicon-chevron-down"></span> R source
</button>
<pre style=""><code class="source r">bn.wid<-c(0.25,.25)
keep.bins<-expand.grid(x.vec=seq(-1,1,bn.wid[1]/10),y.vec=seq(-1,1,bn.wid[2]/10))
keep.bins<-cbind(keep.bins,in.thresh=with(keep.bins,x.vec>0.25 & y.vec>0.25))
ggplot(g.with.thresh,aes(x=x.vec,y=y.vec))+
  stat_bin2d(binwidth=bn.wid,drop=F)+
  geom_tile(data=subset(g.with.thresh,in.thresh),fill="red",alpha=0.4)+
  labs(x="Pfx",y="Pfy",fill="Threshold")+xlim(-1,1)+ylim(-1,1)+
  theme_bw(20)</code></pre>
<div class="row">
<div class="col-md-offset-3 col-md-6">
<a href="#" class="thumbnail"><img src="print_figures/unnamed-chunk-22-1.png" title="With Threshold Overlay" alt="With Threshold Overlay" style="display: block; margin: auto;" /></a>
</div>
</div>
</div>
<h1 id="applying-a-threshold-1">Applying a threshold</h1>
Given the presence of two variables; however, more advanced approaches can also be investigated. For example we can keep only components parallel to the x axis by using the dot product. <br /><span class="math display">$$ I(x,y) = 
\begin{cases}
1, &amp; |\vec{f}(x,y)\cdot \vec{i}| = 1 \\
0, &amp; \text{otherwise}
\end{cases}$$</span><br />
<div class="row">
<button class="source R toggle btn btn-xs btn-primary">
<span class="glyphicon glyphicon-chevron-down"></span> R source
</button>
<pre style=""><code class="source r">i.vec<-c(1,0)
j.vec<-c(0,1)
g.cmp.thresh<-cbind(grad.im,in.thresh=with(grad.im,
                                            abs(x.vec*i.vec[1]+y.vec*i.vec[2])==1
                                            ))
ggplot(g.cmp.thresh,
       aes(x=x,y=y,fill=in.thresh,color=in.thresh))+
  geom_tile(alpha=0.5,aes(fill=in.thresh))+
  geom_segment(aes(xend=x+x.vec,yend=y+y.vec),arrow=arrow(length = unit(0.2,"cm")),size=3)+
  labs(color="In Threshold")+guides(fill=FALSE)+
  theme_bw(20)</code></pre>
<div class="row">
<div class="col-md-offset-3 col-md-6">
<a href="#" class="thumbnail"><img src="print_figures/unnamed-chunk-23-1.png" title="" alt="" style="display: block; margin: auto;" /></a>
</div>
</div>
</div>
<h1 id="looking-at-orientations">Looking at Orientations</h1>
We can tune the angular acceptance by using the fact <br /><span class="math display">$$\vec{x}\cdot\vec{y}=|\vec{x}| |\vec{y}| \cos(\theta_{x\rightarrow y}) $$</span><br /> <br /><span class="math display">$$ I(x,y) = 
\begin{cases}
1, &amp; \cos^{-1}(\vec{f}(x,y)\cdot \vec{i}) \leq \theta^{\circ} \\
0, &amp; \text{otherwise}
\end{cases}$$</span><br /> ***
<div class="row">
<button class="source R toggle btn btn-xs btn-primary">
<span class="glyphicon glyphicon-chevron-down"></span> R source
</button>
<pre style=""><code class="source r">i.vec<-c(1,0)
j.vec<-c(0,1)
ang.accept<-function(c.ang) g.cmp.thresh<-cbind(grad.im,
                                                ang.val=c.ang,
                                                in.thresh=with(grad.im,
                                            acos(x.vec*i.vec[1]+y.vec*i.vec[2])<=c.ang/180*pi
                                            ))
ang.vals<-seq(5,180,length.out=9)
ggplot(ldply(ang.vals,ang.accept),
       aes(x=x,y=y,fill=in.thresh,color=in.thresh))+
  geom_tile(alpha=0.5,aes(fill=in.thresh))+
  geom_segment(aes(xend=x+x.vec,yend=y+y.vec),arrow=arrow(length = unit(0.2,"cm")),size=3)+
  facet_wrap(~ang.val)+
  labs(color="In Threshold")+guides(fill=FALSE)</code></pre>
<div class="row">
<div class="col-md-offset-3 col-md-6">
<a href="#" class="thumbnail"><img src="print_figures/unnamed-chunk-24-1.png" title="" alt="" style="display: block; margin: auto;" /></a>
</div>
</div>
<button class="source R toggle btn btn-xs btn-primary">
<span class="glyphicon glyphicon-chevron-down"></span> R source
</button>
<pre style=""><code class="source r">  theme_bw(20)</code></pre>
</div>
<h1 id="a-machine-learning-approach-to-image-processing">A Machine Learning Approach to Image Processing</h1>
<p>Segmentation and all the steps leading up to it are really a specialized type of learning problem.</p>
<div class="row">
<button class="source R toggle btn btn-xs btn-primary">
<span class="glyphicon glyphicon-chevron-down"></span> R source
</button>
<pre style=""><code class="source r">lout<-21
b.grid<-expand.grid(x=seq(-10,10,length.out=lout),y=seq(-10,10,length.out=lout))
ring.image<-mutate(
  b.grid,
  Intensity = abs(cos(sqrt(x^2+y^2)/15*6.28))
  )

ring.image.dist<-ddply(ring.image,.(x,y),function(in.pts) {
  in.pts$Distance<-with(in.pts,sqrt(
      min(
        x^2+y^2
      )
    ))
  in.pts
})

ring.image.seg<-mutate(ring.image.dist,
                       Segmented = ifelse(
                         Intensity>0.5 & Distance>5 & Distance<10,
                         "Foreground","Background")
                       )
ring.image.seg<-mutate(ring.image.seg,
                       x=round(x+11),
                       y=round(y+11))
ring.im<-df.to.im(mutate(
  b.grid,
  val = 127*(abs(cos(sqrt(x^2+y^2)/15*6.28))+runif(nrow(b.grid)))
  ))

ring.img<-im.to.df(ring.im,out.col="Intensity")
blur.img<-im.to.df(gblur(ring.im,0.5),out.col="Intensity")
med.img<-im.to.df(medianFilter(ring.im/255,3)*255.0,out.col="Intensity")</code></pre>
</div>
<p>Returning to the ring image we had before, we start with our knowledge or ground-truth of the ring</p>
<div class="row">
<button class="source R toggle btn btn-xs btn-primary">
<span class="glyphicon glyphicon-chevron-down"></span> R source
</button>
<pre style=""><code class="source r">ggplot(ring.image.seg,aes(x,y,fill=Segmented))+
  geom_raster()+
  coord_equal()+
  theme_bw(15)</code></pre>
<div class="row">
<div class="col-md-offset-3 col-md-6">
<a href="#" class="thumbnail"><img src="print_figures/unnamed-chunk-25-1.png" title="plot of chunk unnamed-chunk-25" alt="plot of chunk unnamed-chunk-25" style="display: block; margin: auto;" /></a>
</div>
</div>
</div>
<hr />
<p>Which we want to identify the from the following image by using image processing tools</p>
<div class="row">
<button class="source R toggle btn btn-xs btn-primary">
<span class="glyphicon glyphicon-chevron-down"></span> R source
</button>
<pre style=""><code class="source r">simple.image<-ggplot(ring.img,aes(x,y,fill=Intensity))+
  geom_tile()+
  coord_equal()+
  theme_bw(15)
simple.image</code></pre>
<div class="row">
<div class="col-md-offset-3 col-md-6">
<a href="#" class="thumbnail"><img src="print_figures/unnamed-chunk-26-1.png" title="plot of chunk unnamed-chunk-26" alt="plot of chunk unnamed-chunk-26" style="display: block; margin: auto;" /></a>
</div>
</div>
</div>
<p>What does identify mean?</p>
<ul>
<li>Classify the pixels in the ring as <em>Foreground</em></li>
<li>Classify the pixels outside of the ring as <em>Background</em></li>
</ul>
<h1 id="how-do-we-quantify-this">How do we quantify this?</h1>
<ul>
<li><strong>True Positive</strong> values in the ring that are classified as <em>Foreground</em></li>
<li><strong>True Negative</strong> values outside the ring that are classified as <em>Background</em></li>
<li><strong>False Positive</strong> values outside the ring that are classified as <em>Foreground</em></li>
<li><strong>False Negative</strong> values in the ring that are classified as <em>Background</em></li>
</ul>
<div class="row">
<button class="source R toggle btn btn-xs btn-primary">
<span class="glyphicon glyphicon-chevron-down"></span> R source
</button>
<pre style=""><code class="source r">tr.seg.img<-
  mutate(ring.img,Segmented=ifelse(Intensity>170,"Foreground","Background"))[,
   c("x","y","Segmented")]
gr.truth.img<-ring.image.seg[,c("x","y","Segmented")]
ggplot(tr.seg.img,
       aes(x,y,fill=Segmented))+
  geom_tile(color="black")+
  coord_equal()+
  labs(fill="Threshold\nSegmentation")+
  theme_bw(15)</code></pre>
<div class="row">
<div class="col-md-offset-3 col-md-6">
<a href="#" class="thumbnail"><img src="print_figures/unnamed-chunk-27-1.png" title="plot of chunk unnamed-chunk-27" alt="plot of chunk unnamed-chunk-27" style="display: block; margin: auto;" /></a>
</div>
</div>
</div>
<hr />
<p>We can then apply a threshold to the image to determine the number of points in each category</p>
<div class="row">
<button class="source R toggle btn btn-xs btn-primary">
<span class="glyphicon glyphicon-chevron-down"></span> R source
</button>
<pre style=""><code class="source r">score.img<-mutate(
    merge(tr.seg.img,gr.truth.img,by=c("x","y"),suffixes=c("C","GT")),
  Match=(SegmentedC==SegmentedGT),
  Category=
    ifelse(Match,
           ifelse(SegmentedC=="Foreground","True Positive","True Negative"),
           ifelse(SegmentedC=="Foreground","False Positive","False Negative")
      )
  )

ggplot(score.img,
       aes(x,y,fill=SegmentedC,color=SegmentedGT))+
  geom_tile(size=1)+
  facet_wrap(~Category)+
  coord_equal()+
  scale_colour_manual(values=c("green","black"))+
  scale_fill_manual(values=c("red","blue"))+
  labs(fill="Threshold\nSegmentation",color="Ground\nTruth")+
  theme_bw(20)</code></pre>
<div class="row">
<div class="col-md-offset-3 col-md-6">
<a href="#" class="thumbnail"><img src="print_figures/unnamed-chunk-28-1.png" title="plot of chunk unnamed-chunk-28" alt="plot of chunk unnamed-chunk-28" style="display: block; margin: auto;" /></a>
</div>
</div>
</div>
<h1 id="ring-threshold-example">Ring Threshold Example</h1>
<p>Try a number of different threshold values on the image and compare them to the original classification</p>
<div class="row">
<button class="source R toggle btn btn-xs btn-primary">
<span class="glyphicon glyphicon-chevron-down"></span> R source
</button>
<pre style=""><code class="source r">mk.th.img<-function(in.img,steps,smin=0.3,smax=0.7) ldply(seq(smin,smax,length.out=steps),function(c.thresh) {
  mutate(in.img,
         Segmented = ifelse(
                         Intensity>c.thresh*255,
                         "Foreground","Background"),
         Thresh = c.thresh
        )
})</code></pre>
</div>
<div class="row">
<button class="source R toggle btn btn-xs btn-primary">
<span class="glyphicon glyphicon-chevron-down"></span> R source
</button>
<pre style=""><code class="source r">ggplot(mk.th.img(ring.img,9),aes(x,y,fill=Segmented))+
  geom_tile(color="black")+
  coord_equal()+
  facet_wrap(~Thresh)+
  theme_bw(15)</code></pre>
<div class="row">
<div class="col-md-offset-3 col-md-6">
<a href="#" class="thumbnail"><img src="print_figures/unnamed-chunk-30-1.png" title="plot of chunk unnamed-chunk-30" alt="plot of chunk unnamed-chunk-30" style="display: block; margin: auto;" /></a>
</div>
</div>
</div>
<hr />
<div class="row">
<button class="source R toggle btn btn-xs btn-primary">
<span class="glyphicon glyphicon-chevron-down"></span> R source
</button>
<pre style=""><code class="source r">mk.stat.table<-function(in.img,steps,smin=0.3,smax=0.7) 
  ddply(mk.th.img(in.img,steps,smin,smax),.(Thresh),function(c.img) {
  in.df<-merge(c.img[,c("x","y","Segmented")],
               ring.image.seg[,c("x","y","Segmented")],
               by=c("x","y"),suffixes=c("C","GT"))
  in.df<-mutate(in.df,Match=(SegmentedC==SegmentedGT))
  data.frame(TP=nrow(subset(in.df,SegmentedGT=="Foreground" & Match)),
             TN=nrow(subset(in.df,SegmentedGT=="Background" & Match)),
             FP=nrow(subset(in.df,SegmentedC=="Foreground" & !Match)),
             FN=nrow(subset(in.df,SegmentedC=="Background" & !Match))
             )
})
tp.table<-mk.stat.table(ring.img,6,smin=0,smax=1)
kable(tp.table)</code></pre>
<table>
<thead>
<tr class="header">
<th align="right">Thresh</th>
<th align="right">TP</th>
<th align="right">TN</th>
<th align="right">FP</th>
<th align="right">FN</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">0.0</td>
<td align="right">224</td>
<td align="right">0</td>
<td align="right">217</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="right">0.2</td>
<td align="right">224</td>
<td align="right">25</td>
<td align="right">192</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="right">0.4</td>
<td align="right">215</td>
<td align="right">83</td>
<td align="right">134</td>
<td align="right">9</td>
</tr>
<tr class="even">
<td align="right">0.6</td>
<td align="right">138</td>
<td align="right">170</td>
<td align="right">47</td>
<td align="right">86</td>
</tr>
<tr class="odd">
<td align="right">0.8</td>
<td align="right">55</td>
<td align="right">212</td>
<td align="right">5</td>
<td align="right">169</td>
</tr>
<tr class="even">
<td align="right">1.0</td>
<td align="right">0</td>
<td align="right">217</td>
<td align="right">0</td>
<td align="right">224</td>
</tr>
</tbody>
</table>
</div>
<div class="row">
<button class="source R toggle btn btn-xs btn-primary">
<span class="glyphicon glyphicon-chevron-down"></span> R source
</button>
<pre style=""><code class="source r">ggplot(melt(tp.table,id.vars=c("Thresh")),
       aes(x=Thresh*100,y=100*value/200,color=variable))+
  geom_point()+
  geom_path()+
  labs(color="",y="Percent (%)",x="Threshold Value (%)")+
  theme_bw(20)</code></pre>
<div class="row">
<div class="col-md-offset-3 col-md-6">
<a href="#" class="thumbnail"><img src="print_figures/unnamed-chunk-32-1.png" title="plot of chunk unnamed-chunk-32" alt="plot of chunk unnamed-chunk-32" style="display: block; margin: auto;" /></a>
</div>
</div>
</div>
<h1 id="apply-precision-and-recall">Apply Precision and Recall</h1>
<ul>
<li><strong>Recall</strong> (sensitivity)= <span class="math inline"><em>T</em><em>P</em>/(<em>T</em><em>P</em> + <em>F</em><em>N</em>)</span></li>
<li><strong>Precision</strong> = <span class="math inline"><em>T</em><em>P</em>/(<em>T</em><em>P</em> + <em>F</em><em>P</em>)</span></li>
</ul>
<div class="row">
<button class="source R toggle btn btn-xs btn-primary">
<span class="glyphicon glyphicon-chevron-down"></span> R source
</button>
<pre style=""><code class="source r">prec.table<-mutate(mk.stat.table(ring.img,6),
                  Recall=round(100*TP/(TP+FN)),
                  Precision=round(100*TP/(TP+FP))
                   )
kable(prec.table)</code></pre>
<table>
<thead>
<tr class="header">
<th align="right">Thresh</th>
<th align="right">TP</th>
<th align="right">TN</th>
<th align="right">FP</th>
<th align="right">FN</th>
<th align="right">Recall</th>
<th align="right">Precision</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">0.30</td>
<td align="right">221</td>
<td align="right">51</td>
<td align="right">166</td>
<td align="right">3</td>
<td align="right">99</td>
<td align="right">57</td>
</tr>
<tr class="even">
<td align="right">0.38</td>
<td align="right">218</td>
<td align="right">76</td>
<td align="right">141</td>
<td align="right">6</td>
<td align="right">97</td>
<td align="right">61</td>
</tr>
<tr class="odd">
<td align="right">0.46</td>
<td align="right">204</td>
<td align="right">106</td>
<td align="right">111</td>
<td align="right">20</td>
<td align="right">91</td>
<td align="right">65</td>
</tr>
<tr class="even">
<td align="right">0.54</td>
<td align="right">164</td>
<td align="right">146</td>
<td align="right">71</td>
<td align="right">60</td>
<td align="right">73</td>
<td align="right">70</td>
</tr>
<tr class="odd">
<td align="right">0.62</td>
<td align="right">128</td>
<td align="right">178</td>
<td align="right">39</td>
<td align="right">96</td>
<td align="right">57</td>
<td align="right">77</td>
</tr>
<tr class="even">
<td align="right">0.70</td>
<td align="right">100</td>
<td align="right">200</td>
<td align="right">17</td>
<td align="right">124</td>
<td align="right">45</td>
<td align="right">85</td>
</tr>
</tbody>
</table>
</div>
<hr />
<h3 id="roc-curve">ROC Curve</h3>
<p>Reciever Operating Characteristic (first developed for WW2 soldiers detecting objects in battlefields using radar). The ideal is the top-right (identify everything and miss nothing)</p>
<div class="row">
<button class="source R toggle btn btn-xs btn-primary">
<span class="glyphicon glyphicon-chevron-down"></span> R source
</button>
<pre style=""><code class="source r">prec.table<-mutate(mk.stat.table(ring.img,100),
                   Recall=TP/(TP+FN),
                   Precision=TP/(TP+FP)
                   )

ggplot(prec.table,aes(x=Recall,y=Precision))+
  geom_point(aes(color=Thresh,shape="Image"),size=5)+
  geom_point(data=data.frame(Recall=1,Precision=1),
             aes(shape="Ideal"),size=5,color="red")+
  geom_path()+
  #coord_equal()+
  scale_color_gradientn(colours=rainbow(6))+
  labs(shape="")+
  theme_bw(20)</code></pre>
<div class="row">
<div class="col-md-offset-3 col-md-6">
<a href="#" class="thumbnail"><img src="print_figures/unnamed-chunk-34-1.png" title="plot of chunk unnamed-chunk-34" alt="plot of chunk unnamed-chunk-34" style="display: block; margin: auto;" /></a>
</div>
</div>
</div>
<h1 id="comparing-different-filters">Comparing Different Filters</h1>
<p>We can then use this ROC curve to compare different filters (or even entire workflows), if the area is higher the approach is better.</p>
<div class="row">
<button class="source R toggle btn btn-xs btn-primary">
<span class="glyphicon glyphicon-chevron-down"></span> R source
</button>
<pre style=""><code class="source r">all.img<-rbind(
  cbind(mk.th.img(ring.img,3), name="Normal"),
  cbind(mk.th.img(blur.img,3), name="Gaussian"),
  cbind(mk.th.img(med.img,3), name="Median")
  )

simple.image<-ggplot(all.img,aes(x,y,fill=Segmented))+
  geom_tile(color="black")+
  coord_equal()+
  facet_grid(name~Thresh)+
  theme_bw(15)

simple.image</code></pre>
<div class="row">
<div class="col-md-offset-3 col-md-6">
<a href="#" class="thumbnail"><img src="print_figures/unnamed-chunk-35-1.png" title="plot of chunk unnamed-chunk-35" alt="plot of chunk unnamed-chunk-35" style="display: block; margin: auto;" /></a>
</div>
</div>
</div>
<hr />
<p>Different approaches can be compared by area under the curve</p>
<div class="row">
<button class="source R toggle btn btn-xs btn-primary">
<span class="glyphicon glyphicon-chevron-down"></span> R source
</button>
<pre style=""><code class="source r">stab<-function(img) mk.stat.table(img,100,smin=0.05,smax=0.95)
all.table<-rbind(
  cbind(stab(ring.img), name="Normal"),
  cbind(stab(blur.img), name="Gaussian"),
  cbind(stab(med.img), name="Median")
  )

prec.table<-mutate(all.table,
                   Recall=TP/(TP+FN),
                  Precision=TP/(TP+FP)
                   )
ggplot(prec.table,aes(x=Recall,y=Precision,color=name))+
  geom_point(aes(shape="Image"),size=5)+
  geom_point(data=data.frame(Recall=1,Precision=1),
             aes(shape="Ideal"),size=5,color="red")+
  geom_path()+
  #coord_equal()+
  labs(shape="",color="Filter")+
  xlim(0.5,1)+ylim(0.5,1)+
  theme_bw(20)</code></pre>
<div class="row">
<div class="col-md-offset-3 col-md-6">
<a href="#" class="thumbnail"><img src="print_figures/unnamed-chunk-36-1.png" title="plot of chunk unnamed-chunk-36" alt="plot of chunk unnamed-chunk-36" style="display: block; margin: auto;" /></a>
</div>
</div>
</div>
<h1 id="true-positive-rate-and-false-positive-rate">True Positive Rate and False Positive Rate</h1>
<p>Another way of showing the ROC curve (more common for machine learning rather than medical diagnosis) is using the True positive rate and False positive rate</p>
<ul>
<li><strong>True Positive Rate</strong> (recall)= <span class="math inline"><em>T</em><em>P</em>/(<em>T</em><em>P</em> + <em>F</em><em>N</em>)</span></li>
<li><strong>False Positive Rate</strong> = <span class="math inline"><em>F</em><em>P</em>/(<em>F</em><em>P</em> + <em>T</em><em>N</em>)</span></li>
</ul>
<hr />
These show very similar information with the major difference being the goal is to be in the upper left-hand corner. Additionally random guesses can be shown as the slope 1 line. Therefore for a system to be useful it must lie above the random line.
<div class="row">
<button class="source R toggle btn btn-xs btn-primary">
<span class="glyphicon glyphicon-chevron-down"></span> R source
</button>
<pre style=""><code class="source r">tp.table<-mutate(all.table,
                   TPRate=TP/(TP+FN),
                   FPRate=FP/(FP+TN)
                   )
ggplot(tp.table,aes(x=FPRate,y=TPRate,color=name))+
  geom_point(aes(shape="Image"),size=2)+
  geom_point(data=data.frame(TPRate=1,FPRate=0),
             aes(shape="Ideal"),size=5,color="red")+
  geom_path()+
  geom_segment(x=0,xend=1,y=0,yend=1,aes(color="Random Guess"))+
  xlim(0,1)+ylim(0,1)+coord_equal()+
  labs(shape="",x="False Positive Rate",y="True Positive Rate",linetype="")+
  theme_bw(20)</code></pre>
<div class="row">
<div class="col-md-offset-3 col-md-6">
<a href="#" class="thumbnail"><img src="print_figures/unnamed-chunk-37-1.png" title="plot of chunk unnamed-chunk-37" alt="plot of chunk unnamed-chunk-37" style="display: block; margin: auto;" /></a>
</div>
</div>
</div>
<h1 id="evaluating-models">Evaluating Models</h1>
<ul>
<li><a href="https://github.com/jvns/talks/blob/master/pydatanyc2014/slides.md" class="uri">https://github.com/jvns/talks/blob/master/pydatanyc2014/slides.md</a></li>
<li><a href="http://mathbabe.org/2012/03/06/the-value-added-teacher-model-sucks/" class="uri">http://mathbabe.org/2012/03/06/the-value-added-teacher-model-sucks/</a></li>
</ul>
<h1 id="practical-example-self-driving-cars-finding-road-stripes">Practical Example: Self-Driving Cars, Finding Road Stripes</h1>
<p>A more complicated example is finding stripes on the road.</p>
<div class="row">
<button class="source R toggle btn btn-xs btn-primary">
<span class="glyphicon glyphicon-chevron-down"></span> R source
</button>
<pre style=""><code class="source r"># image data
road.arr<- readJPEG(qbi.data("road_image.jpg"))[,,1] %>% t %>% flip</code></pre>
<button class="error R toggle btn btn-xs btn-danger">
<span class="glyphicon glyphicon-chevron-down"></span> R error
</button>
<pre style=""><code class="error r">## Error in asub.default(x, seq.int(dim(x)[2], 1), 2): could not find function "Quote"
</code></pre>
<button class="source R toggle btn btn-xs btn-primary">
<span class="glyphicon glyphicon-chevron-down"></span> R source
</button>
<pre style=""><code class="source r">road.image<- road.arr %>% im.to.df</code></pre>
<button class="error R toggle btn btn-xs btn-danger">
<span class="glyphicon glyphicon-chevron-down"></span> R error
</button>
<pre style=""><code class="error r">## Error in eval(expr, envir, enclos): object 'road.arr' not found
</code></pre>
<button class="source R toggle btn btn-xs btn-primary">
<span class="glyphicon glyphicon-chevron-down"></span> R source
</button>
<pre style=""><code class="source r"># ground truth
cal.image<-readJPEG(qbi.data("road_image_seg_bw.jpg"))[,,1]  %>% t %>% flip %>% im.to.df %>% 
  mutate(Segmented = ifelse(val,"Stripe","Background"))</code></pre>
<button class="error R toggle btn btn-xs btn-danger">
<span class="glyphicon glyphicon-chevron-down"></span> R error
</button>
<pre style=""><code class="error r">## Error in asub.default(x, seq.int(dim(x)[2], 1), 2): could not find function "Quote"
</code></pre>
</div>
<p><img src="../common/data/road_image.jpg" alt="Tuk Tuk" /></p>
<div class="row">
<button class="source R toggle btn btn-xs btn-primary">
<span class="glyphicon glyphicon-chevron-down"></span> R source
</button>
<pre style=""><code class="source r">ggplot(road.image,
       aes(x,y,fill=val))+
  geom_raster()+
  coord_equal()+
  scale_fill_gradientn(colours=c("black","white"))+
  guides(fill=F)+
  theme_bw(20)</code></pre>
</div>
<hr />
<p>From these images, an expert labeled the calcifications by hand, so we have ground truth data on where they are:</p>
<div class="row">
<button class="source R toggle btn btn-xs btn-primary">
<span class="glyphicon glyphicon-chevron-down"></span> R source
</button>
<pre style=""><code class="source r">ggplot(cal.image,aes(x,y,fill=Segmented,alpha=Segmented))+
  geom_raster()+
  coord_equal()+
  guides(alpha=F)+
  theme_bw(20)</code></pre>
<button class="error R toggle btn btn-xs btn-danger">
<span class="glyphicon glyphicon-chevron-down"></span> R error
</button>
<pre style=""><code class="error r">## Error in ggplot(cal.image, aes(x, y, fill = Segmented, alpha = Segmented)): object 'cal.image' not found
</code></pre>
</div>
<h1 id="applying-a-threshold-2">Applying a threshold</h1>
<p>We can perform the same analysis on an image like this one, again using a simple threshold to evalulate how accurately we identify the calcifications</p>
<div class="row">
<button class="source R toggle btn btn-xs btn-primary">
<span class="glyphicon glyphicon-chevron-down"></span> R source
</button>
<pre style=""><code class="source r">tr.road<-mutate(road.image,
                 Segmented=ifelse(val>0.75,"Stripe","Background")
                 )</code></pre>
<button class="error R toggle btn btn-xs btn-danger">
<span class="glyphicon glyphicon-chevron-down"></span> R error
</button>
<pre style=""><code class="error r">## Error in mutate_(.data, .dots = lazyeval::lazy_dots(...)): object 'road.image' not found
</code></pre>
<button class="source R toggle btn btn-xs btn-primary">
<span class="glyphicon glyphicon-chevron-down"></span> R source
</button>
<pre style=""><code class="source r">ggplot(tr.road,aes(x,y,fill=Segmented,alpha=val))+
  geom_raster()+
  coord_equal()+
  guides(alpha=F)+
  theme_bw(20)</code></pre>
<button class="error R toggle btn btn-xs btn-danger">
<span class="glyphicon glyphicon-chevron-down"></span> R error
</button>
<pre style=""><code class="error r">## Error in ggplot(tr.road, aes(x, y, fill = Segmented, alpha = val)): object 'tr.road' not found
</code></pre>
</div>
<hr />
<div class="row">
<button class="source R toggle btn btn-xs btn-primary">
<span class="glyphicon glyphicon-chevron-down"></span> R source
</button>
<pre style=""><code class="source r">score.img<-mutate(
    merge(tr.road[,c("x","y","Segmented")],
          cal.image[,c("x","y","Segmented")],
          by=c("x","y"),suffixes=c("C","GT")),
  Match=(SegmentedC==SegmentedGT),
  Category=
    ifelse(Match,
           ifelse(SegmentedC=="Stripe","True Positive","True Negative"),
           ifelse(SegmentedC=="Stripe","False Positive","False Negative")
      )
  )</code></pre>
<button class="error R toggle btn btn-xs btn-danger">
<span class="glyphicon glyphicon-chevron-down"></span> R error
</button>
<pre style=""><code class="error r">## Error in merge(tr.road[, c("x", "y", "Segmented")], cal.image[, c("x", : object 'tr.road' not found
</code></pre>
<button class="source R toggle btn btn-xs btn-primary">
<span class="glyphicon glyphicon-chevron-down"></span> R source
</button>
<pre style=""><code class="source r">ggplot(score.img,
       aes(x,y,fill=SegmentedGT))+
  geom_tile()+
  facet_wrap(~Category)+
  coord_equal()+
  scale_colour_manual(values=c("green","black"))+
  scale_fill_manual(values=c("red","blue"))+
  labs(fill="Ground\nTruth")+
  theme_bw(20)</code></pre>
<div class="row">
<div class="col-md-offset-3 col-md-6">
<a href="#" class="thumbnail"><img src="print_figures/unnamed-chunk-41-1.png" title="plot of chunk unnamed-chunk-41" alt="plot of chunk unnamed-chunk-41" style="display: block; margin: auto;" /></a>
</div>
</div>
</div>
<h1 id="examining-the-roc-curve">Examining the ROC Curve</h1>
<div class="row">
<button class="source R toggle btn btn-xs btn-primary">
<span class="glyphicon glyphicon-chevron-down"></span> R source
</button>
<pre style=""><code class="source r">mk.th.img<-function(in.img,stepseq) ldply(stepseq,function(c.thresh) {
  mutate(in.img,
         Segmented = ifelse(
                         val>c.thresh,
                         "Stripe","Background"),
         Thresh = c.thresh
        )
})

mk.stat.table<-function(in.img,stepseq) 
  ddply(mk.th.img(in.img,stepseq),.(Thresh),function(c.img) {
  in.df<-merge(c.img[,c("x","y","Segmented")],
               cal.image[,c("x","y","Segmented")],
               by=c("x","y"),suffixes=c("C","GT"))
  in.df<-mutate(in.df,Match=(SegmentedC==SegmentedGT))
  data.frame(TP=nrow(subset(in.df,SegmentedGT=="Stripe" & Match)),
             TN=nrow(subset(in.df,SegmentedGT=="Background" & Match)),
             FP=nrow(subset(in.df,SegmentedC=="Stripe" & !Match)),
             FN=nrow(subset(in.df,SegmentedC=="Background" & !Match))
             )
})

step.fcn<-function(vals,n) quantile(vals,seq(0,1,length.out=n+2)[-c(1,n+2)])
abs.steps<-step.fcn(road.image$val,6)</code></pre>
<button class="error R toggle btn btn-xs btn-danger">
<span class="glyphicon glyphicon-chevron-down"></span> R error
</button>
<pre style=""><code class="error r">## Error in quantile(vals, seq(0, 1, length.out = n + 2)[-c(1, n + 2)]): object 'road.image' not found
</code></pre>
<button class="source R toggle btn btn-xs btn-primary">
<span class="glyphicon glyphicon-chevron-down"></span> R source
</button>
<pre style=""><code class="source r">tp.table<-mk.stat.table(road.image,abs.steps)</code></pre>
<button class="error R toggle btn btn-xs btn-danger">
<span class="glyphicon glyphicon-chevron-down"></span> R error
</button>
<pre style=""><code class="error r">## Error in inherits(.data, "split"): object 'abs.steps' not found
</code></pre>
</div>
<div class="row">
<button class="source R toggle btn btn-xs btn-primary">
<span class="glyphicon glyphicon-chevron-down"></span> R source
</button>
<pre style=""><code class="source r">prec.table<-mutate(tp.table,
                   Thresh=round(100*Thresh),
                   Recall=round(100*TP/(TP+FN)),
                   Precision=round(100*TP/(TP+FP))
                   )</code></pre>
<button class="error R toggle btn btn-xs btn-danger">
<span class="glyphicon glyphicon-chevron-down"></span> R error
</button>
<pre style=""><code class="error r">## Error in mutate_(.data, .dots = lazyeval::lazy_dots(...)): cannot open file '/Users/mader/Dropbox/TeachingRelated/QuantBig/Lectures/03 - Segmentation/print_cache/unnamed-chunk-36_7b938447ad2cd5ae6096426d9158a1f0.rdb': No such file or directory
</code></pre>
<button class="source R toggle btn btn-xs btn-primary">
<span class="glyphicon glyphicon-chevron-down"></span> R source
</button>
<pre style=""><code class="source r">kable(prec.table)</code></pre>
<table>
<thead>
<tr class="header">
<th align="right">Thresh</th>
<th align="right">TP</th>
<th align="right">TN</th>
<th align="right">FP</th>
<th align="right">FN</th>
<th align="left">name</th>
<th align="right">Recall</th>
<th align="right">Precision</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">0.0500000</td>
<td align="right">224</td>
<td align="right">0</td>
<td align="right">217</td>
<td align="right">0</td>
<td align="left">Normal</td>
<td align="right">1.0000000</td>
<td align="right">0.5079365</td>
</tr>
<tr class="even">
<td align="right">0.0590909</td>
<td align="right">224</td>
<td align="right">0</td>
<td align="right">217</td>
<td align="right">0</td>
<td align="left">Normal</td>
<td align="right">1.0000000</td>
<td align="right">0.5079365</td>
</tr>
<tr class="odd">
<td align="right">0.0681818</td>
<td align="right">224</td>
<td align="right">1</td>
<td align="right">216</td>
<td align="right">0</td>
<td align="left">Normal</td>
<td align="right">1.0000000</td>
<td align="right">0.5090909</td>
</tr>
<tr class="even">
<td align="right">0.0772727</td>
<td align="right">224</td>
<td align="right">1</td>
<td align="right">216</td>
<td align="right">0</td>
<td align="left">Normal</td>
<td align="right">1.0000000</td>
<td align="right">0.5090909</td>
</tr>
<tr class="odd">
<td align="right">0.0863636</td>
<td align="right">224</td>
<td align="right">1</td>
<td align="right">216</td>
<td align="right">0</td>
<td align="left">Normal</td>
<td align="right">1.0000000</td>
<td align="right">0.5090909</td>
</tr>
<tr class="even">
<td align="right">0.0954545</td>
<td align="right">224</td>
<td align="right">2</td>
<td align="right">215</td>
<td align="right">0</td>
<td align="left">Normal</td>
<td align="right">1.0000000</td>
<td align="right">0.5102506</td>
</tr>
<tr class="odd">
<td align="right">0.1045455</td>
<td align="right">224</td>
<td align="right">3</td>
<td align="right">214</td>
<td align="right">0</td>
<td align="left">Normal</td>
<td align="right">1.0000000</td>
<td align="right">0.5114155</td>
</tr>
<tr class="even">
<td align="right">0.1136364</td>
<td align="right">224</td>
<td align="right">7</td>
<td align="right">210</td>
<td align="right">0</td>
<td align="left">Normal</td>
<td align="right">1.0000000</td>
<td align="right">0.5161290</td>
</tr>
<tr class="odd">
<td align="right">0.1227273</td>
<td align="right">224</td>
<td align="right">8</td>
<td align="right">209</td>
<td align="right">0</td>
<td align="left">Normal</td>
<td align="right">1.0000000</td>
<td align="right">0.5173210</td>
</tr>
<tr class="even">
<td align="right">0.1318182</td>
<td align="right">224</td>
<td align="right">8</td>
<td align="right">209</td>
<td align="right">0</td>
<td align="left">Normal</td>
<td align="right">1.0000000</td>
<td align="right">0.5173210</td>
</tr>
<tr class="odd">
<td align="right">0.1409091</td>
<td align="right">224</td>
<td align="right">8</td>
<td align="right">209</td>
<td align="right">0</td>
<td align="left">Normal</td>
<td align="right">1.0000000</td>
<td align="right">0.5173210</td>
</tr>
<tr class="even">
<td align="right">0.1500000</td>
<td align="right">224</td>
<td align="right">11</td>
<td align="right">206</td>
<td align="right">0</td>
<td align="left">Normal</td>
<td align="right">1.0000000</td>
<td align="right">0.5209302</td>
</tr>
<tr class="odd">
<td align="right">0.1590909</td>
<td align="right">224</td>
<td align="right">16</td>
<td align="right">201</td>
<td align="right">0</td>
<td align="left">Normal</td>
<td align="right">1.0000000</td>
<td align="right">0.5270588</td>
</tr>
<tr class="even">
<td align="right">0.1681818</td>
<td align="right">224</td>
<td align="right">17</td>
<td align="right">200</td>
<td align="right">0</td>
<td align="left">Normal</td>
<td align="right">1.0000000</td>
<td align="right">0.5283019</td>
</tr>
<tr class="odd">
<td align="right">0.1772727</td>
<td align="right">224</td>
<td align="right">20</td>
<td align="right">197</td>
<td align="right">0</td>
<td align="left">Normal</td>
<td align="right">1.0000000</td>
<td align="right">0.5320665</td>
</tr>
<tr class="even">
<td align="right">0.1863636</td>
<td align="right">224</td>
<td align="right">21</td>
<td align="right">196</td>
<td align="right">0</td>
<td align="left">Normal</td>
<td align="right">1.0000000</td>
<td align="right">0.5333333</td>
</tr>
<tr class="odd">
<td align="right">0.1954545</td>
<td align="right">224</td>
<td align="right">24</td>
<td align="right">193</td>
<td align="right">0</td>
<td align="left">Normal</td>
<td align="right">1.0000000</td>
<td align="right">0.5371703</td>
</tr>
<tr class="even">
<td align="right">0.2045455</td>
<td align="right">224</td>
<td align="right">26</td>
<td align="right">191</td>
<td align="right">0</td>
<td align="left">Normal</td>
<td align="right">1.0000000</td>
<td align="right">0.5397590</td>
</tr>
<tr class="odd">
<td align="right">0.2136364</td>
<td align="right">224</td>
<td align="right">28</td>
<td align="right">189</td>
<td align="right">0</td>
<td align="left">Normal</td>
<td align="right">1.0000000</td>
<td align="right">0.5423729</td>
</tr>
<tr class="even">
<td align="right">0.2227273</td>
<td align="right">224</td>
<td align="right">32</td>
<td align="right">185</td>
<td align="right">0</td>
<td align="left">Normal</td>
<td align="right">1.0000000</td>
<td align="right">0.5476773</td>
</tr>
<tr class="odd">
<td align="right">0.2318182</td>
<td align="right">224</td>
<td align="right">34</td>
<td align="right">183</td>
<td align="right">0</td>
<td align="left">Normal</td>
<td align="right">1.0000000</td>
<td align="right">0.5503686</td>
</tr>
<tr class="even">
<td align="right">0.2409091</td>
<td align="right">224</td>
<td align="right">34</td>
<td align="right">183</td>
<td align="right">0</td>
<td align="left">Normal</td>
<td align="right">1.0000000</td>
<td align="right">0.5503686</td>
</tr>
<tr class="odd">
<td align="right">0.2500000</td>
<td align="right">224</td>
<td align="right">35</td>
<td align="right">182</td>
<td align="right">0</td>
<td align="left">Normal</td>
<td align="right">1.0000000</td>
<td align="right">0.5517241</td>
</tr>
<tr class="even">
<td align="right">0.2590909</td>
<td align="right">224</td>
<td align="right">38</td>
<td align="right">179</td>
<td align="right">0</td>
<td align="left">Normal</td>
<td align="right">1.0000000</td>
<td align="right">0.5558313</td>
</tr>
<tr class="odd">
<td align="right">0.2681818</td>
<td align="right">224</td>
<td align="right">41</td>
<td align="right">176</td>
<td align="right">0</td>
<td align="left">Normal</td>
<td align="right">1.0000000</td>
<td align="right">0.5600000</td>
</tr>
<tr class="even">
<td align="right">0.2772727</td>
<td align="right">224</td>
<td align="right">44</td>
<td align="right">173</td>
<td align="right">0</td>
<td align="left">Normal</td>
<td align="right">1.0000000</td>
<td align="right">0.5642317</td>
</tr>
<tr class="odd">
<td align="right">0.2863636</td>
<td align="right">223</td>
<td align="right">48</td>
<td align="right">169</td>
<td align="right">1</td>
<td align="left">Normal</td>
<td align="right">0.9955357</td>
<td align="right">0.5688776</td>
</tr>
<tr class="even">
<td align="right">0.2954545</td>
<td align="right">221</td>
<td align="right">50</td>
<td align="right">167</td>
<td align="right">3</td>
<td align="left">Normal</td>
<td align="right">0.9866071</td>
<td align="right">0.5695876</td>
</tr>
<tr class="odd">
<td align="right">0.3045455</td>
<td align="right">221</td>
<td align="right">51</td>
<td align="right">166</td>
<td align="right">3</td>
<td align="left">Normal</td>
<td align="right">0.9866071</td>
<td align="right">0.5710594</td>
</tr>
<tr class="even">
<td align="right">0.3136364</td>
<td align="right">221</td>
<td align="right">55</td>
<td align="right">162</td>
<td align="right">3</td>
<td align="left">Normal</td>
<td align="right">0.9866071</td>
<td align="right">0.5770235</td>
</tr>
<tr class="odd">
<td align="right">0.3227273</td>
<td align="right">221</td>
<td align="right">59</td>
<td align="right">158</td>
<td align="right">3</td>
<td align="left">Normal</td>
<td align="right">0.9866071</td>
<td align="right">0.5831135</td>
</tr>
<tr class="even">
<td align="right">0.3318182</td>
<td align="right">221</td>
<td align="right">66</td>
<td align="right">151</td>
<td align="right">3</td>
<td align="left">Normal</td>
<td align="right">0.9866071</td>
<td align="right">0.5940860</td>
</tr>
<tr class="odd">
<td align="right">0.3409091</td>
<td align="right">221</td>
<td align="right">68</td>
<td align="right">149</td>
<td align="right">3</td>
<td align="left">Normal</td>
<td align="right">0.9866071</td>
<td align="right">0.5972973</td>
</tr>
<tr class="even">
<td align="right">0.3500000</td>
<td align="right">220</td>
<td align="right">70</td>
<td align="right">147</td>
<td align="right">4</td>
<td align="left">Normal</td>
<td align="right">0.9821429</td>
<td align="right">0.5994550</td>
</tr>
<tr class="odd">
<td align="right">0.3590909</td>
<td align="right">220</td>
<td align="right">72</td>
<td align="right">145</td>
<td align="right">4</td>
<td align="left">Normal</td>
<td align="right">0.9821429</td>
<td align="right">0.6027397</td>
</tr>
<tr class="even">
<td align="right">0.3681818</td>
<td align="right">220</td>
<td align="right">73</td>
<td align="right">144</td>
<td align="right">4</td>
<td align="left">Normal</td>
<td align="right">0.9821429</td>
<td align="right">0.6043956</td>
</tr>
<tr class="odd">
<td align="right">0.3772727</td>
<td align="right">219</td>
<td align="right">76</td>
<td align="right">141</td>
<td align="right">5</td>
<td align="left">Normal</td>
<td align="right">0.9776786</td>
<td align="right">0.6083333</td>
</tr>
<tr class="even">
<td align="right">0.3863636</td>
<td align="right">217</td>
<td align="right">77</td>
<td align="right">140</td>
<td align="right">7</td>
<td align="left">Normal</td>
<td align="right">0.9687500</td>
<td align="right">0.6078431</td>
</tr>
<tr class="odd">
<td align="right">0.3954545</td>
<td align="right">216</td>
<td align="right">81</td>
<td align="right">136</td>
<td align="right">8</td>
<td align="left">Normal</td>
<td align="right">0.9642857</td>
<td align="right">0.6136364</td>
</tr>
<tr class="even">
<td align="right">0.4045455</td>
<td align="right">214</td>
<td align="right">85</td>
<td align="right">132</td>
<td align="right">10</td>
<td align="left">Normal</td>
<td align="right">0.9553571</td>
<td align="right">0.6184971</td>
</tr>
<tr class="odd">
<td align="right">0.4136364</td>
<td align="right">213</td>
<td align="right">87</td>
<td align="right">130</td>
<td align="right">11</td>
<td align="left">Normal</td>
<td align="right">0.9508929</td>
<td align="right">0.6209913</td>
</tr>
<tr class="even">
<td align="right">0.4227273</td>
<td align="right">212</td>
<td align="right">89</td>
<td align="right">128</td>
<td align="right">12</td>
<td align="left">Normal</td>
<td align="right">0.9464286</td>
<td align="right">0.6235294</td>
</tr>
<tr class="odd">
<td align="right">0.4318182</td>
<td align="right">208</td>
<td align="right">95</td>
<td align="right">122</td>
<td align="right">16</td>
<td align="left">Normal</td>
<td align="right">0.9285714</td>
<td align="right">0.6303030</td>
</tr>
<tr class="even">
<td align="right">0.4409091</td>
<td align="right">207</td>
<td align="right">100</td>
<td align="right">117</td>
<td align="right">17</td>
<td align="left">Normal</td>
<td align="right">0.9241071</td>
<td align="right">0.6388889</td>
</tr>
<tr class="odd">
<td align="right">0.4500000</td>
<td align="right">205</td>
<td align="right">103</td>
<td align="right">114</td>
<td align="right">19</td>
<td align="left">Normal</td>
<td align="right">0.9151786</td>
<td align="right">0.6426332</td>
</tr>
<tr class="even">
<td align="right">0.4590909</td>
<td align="right">204</td>
<td align="right">106</td>
<td align="right">111</td>
<td align="right">20</td>
<td align="left">Normal</td>
<td align="right">0.9107143</td>
<td align="right">0.6476190</td>
</tr>
<tr class="odd">
<td align="right">0.4681818</td>
<td align="right">201</td>
<td align="right">112</td>
<td align="right">105</td>
<td align="right">23</td>
<td align="left">Normal</td>
<td align="right">0.8973214</td>
<td align="right">0.6568627</td>
</tr>
<tr class="even">
<td align="right">0.4772727</td>
<td align="right">200</td>
<td align="right">115</td>
<td align="right">102</td>
<td align="right">24</td>
<td align="left">Normal</td>
<td align="right">0.8928571</td>
<td align="right">0.6622517</td>
</tr>
<tr class="odd">
<td align="right">0.4863636</td>
<td align="right">198</td>
<td align="right">118</td>
<td align="right">99</td>
<td align="right">26</td>
<td align="left">Normal</td>
<td align="right">0.8839286</td>
<td align="right">0.6666667</td>
</tr>
<tr class="even">
<td align="right">0.4954545</td>
<td align="right">192</td>
<td align="right">124</td>
<td align="right">93</td>
<td align="right">32</td>
<td align="left">Normal</td>
<td align="right">0.8571429</td>
<td align="right">0.6736842</td>
</tr>
<tr class="odd">
<td align="right">0.5045455</td>
<td align="right">188</td>
<td align="right">130</td>
<td align="right">87</td>
<td align="right">36</td>
<td align="left">Normal</td>
<td align="right">0.8392857</td>
<td align="right">0.6836364</td>
</tr>
<tr class="even">
<td align="right">0.5136364</td>
<td align="right">180</td>
<td align="right">131</td>
<td align="right">86</td>
<td align="right">44</td>
<td align="left">Normal</td>
<td align="right">0.8035714</td>
<td align="right">0.6766917</td>
</tr>
<tr class="odd">
<td align="right">0.5227273</td>
<td align="right">172</td>
<td align="right">134</td>
<td align="right">83</td>
<td align="right">52</td>
<td align="left">Normal</td>
<td align="right">0.7678571</td>
<td align="right">0.6745098</td>
</tr>
<tr class="even">
<td align="right">0.5318182</td>
<td align="right">168</td>
<td align="right">141</td>
<td align="right">76</td>
<td align="right">56</td>
<td align="left">Normal</td>
<td align="right">0.7500000</td>
<td align="right">0.6885246</td>
</tr>
<tr class="odd">
<td align="right">0.5409091</td>
<td align="right">164</td>
<td align="right">146</td>
<td align="right">71</td>
<td align="right">60</td>
<td align="left">Normal</td>
<td align="right">0.7321429</td>
<td align="right">0.6978723</td>
</tr>
<tr class="even">
<td align="right">0.5500000</td>
<td align="right">160</td>
<td align="right">149</td>
<td align="right">68</td>
<td align="right">64</td>
<td align="left">Normal</td>
<td align="right">0.7142857</td>
<td align="right">0.7017544</td>
</tr>
<tr class="odd">
<td align="right">0.5590909</td>
<td align="right">157</td>
<td align="right">149</td>
<td align="right">68</td>
<td align="right">67</td>
<td align="left">Normal</td>
<td align="right">0.7008929</td>
<td align="right">0.6977778</td>
</tr>
<tr class="even">
<td align="right">0.5681818</td>
<td align="right">152</td>
<td align="right">157</td>
<td align="right">60</td>
<td align="right">72</td>
<td align="left">Normal</td>
<td align="right">0.6785714</td>
<td align="right">0.7169811</td>
</tr>
<tr class="odd">
<td align="right">0.5772727</td>
<td align="right">150</td>
<td align="right">161</td>
<td align="right">56</td>
<td align="right">74</td>
<td align="left">Normal</td>
<td align="right">0.6696429</td>
<td align="right">0.7281553</td>
</tr>
<tr class="even">
<td align="right">0.5863636</td>
<td align="right">144</td>
<td align="right">165</td>
<td align="right">52</td>
<td align="right">80</td>
<td align="left">Normal</td>
<td align="right">0.6428571</td>
<td align="right">0.7346939</td>
</tr>
<tr class="odd">
<td align="right">0.5954545</td>
<td align="right">138</td>
<td align="right">170</td>
<td align="right">47</td>
<td align="right">86</td>
<td align="left">Normal</td>
<td align="right">0.6160714</td>
<td align="right">0.7459459</td>
</tr>
<tr class="even">
<td align="right">0.6045455</td>
<td align="right">135</td>
<td align="right">175</td>
<td align="right">42</td>
<td align="right">89</td>
<td align="left">Normal</td>
<td align="right">0.6026786</td>
<td align="right">0.7627119</td>
</tr>
<tr class="odd">
<td align="right">0.6136364</td>
<td align="right">129</td>
<td align="right">176</td>
<td align="right">41</td>
<td align="right">95</td>
<td align="left">Normal</td>
<td align="right">0.5758929</td>
<td align="right">0.7588235</td>
</tr>
<tr class="even">
<td align="right">0.6227273</td>
<td align="right">128</td>
<td align="right">178</td>
<td align="right">39</td>
<td align="right">96</td>
<td align="left">Normal</td>
<td align="right">0.5714286</td>
<td align="right">0.7664671</td>
</tr>
<tr class="odd">
<td align="right">0.6318182</td>
<td align="right">127</td>
<td align="right">180</td>
<td align="right">37</td>
<td align="right">97</td>
<td align="left">Normal</td>
<td align="right">0.5669643</td>
<td align="right">0.7743902</td>
</tr>
<tr class="even">
<td align="right">0.6409091</td>
<td align="right">124</td>
<td align="right">182</td>
<td align="right">35</td>
<td align="right">100</td>
<td align="left">Normal</td>
<td align="right">0.5535714</td>
<td align="right">0.7798742</td>
</tr>
<tr class="odd">
<td align="right">0.6500000</td>
<td align="right">120</td>
<td align="right">185</td>
<td align="right">32</td>
<td align="right">104</td>
<td align="left">Normal</td>
<td align="right">0.5357143</td>
<td align="right">0.7894737</td>
</tr>
<tr class="even">
<td align="right">0.6590909</td>
<td align="right">119</td>
<td align="right">189</td>
<td align="right">28</td>
<td align="right">105</td>
<td align="left">Normal</td>
<td align="right">0.5312500</td>
<td align="right">0.8095238</td>
</tr>
<tr class="odd">
<td align="right">0.6681818</td>
<td align="right">114</td>
<td align="right">194</td>
<td align="right">23</td>
<td align="right">110</td>
<td align="left">Normal</td>
<td align="right">0.5089286</td>
<td align="right">0.8321168</td>
</tr>
<tr class="even">
<td align="right">0.6772727</td>
<td align="right">108</td>
<td align="right">196</td>
<td align="right">21</td>
<td align="right">116</td>
<td align="left">Normal</td>
<td align="right">0.4821429</td>
<td align="right">0.8372093</td>
</tr>
<tr class="odd">
<td align="right">0.6863636</td>
<td align="right">106</td>
<td align="right">198</td>
<td align="right">19</td>
<td align="right">118</td>
<td align="left">Normal</td>
<td align="right">0.4732143</td>
<td align="right">0.8480000</td>
</tr>
<tr class="even">
<td align="right">0.6954545</td>
<td align="right">101</td>
<td align="right">200</td>
<td align="right">17</td>
<td align="right">123</td>
<td align="left">Normal</td>
<td align="right">0.4508929</td>
<td align="right">0.8559322</td>
</tr>
<tr class="odd">
<td align="right">0.7045455</td>
<td align="right">96</td>
<td align="right">200</td>
<td align="right">17</td>
<td align="right">128</td>
<td align="left">Normal</td>
<td align="right">0.4285714</td>
<td align="right">0.8495575</td>
</tr>
<tr class="even">
<td align="right">0.7136364</td>
<td align="right">85</td>
<td align="right">202</td>
<td align="right">15</td>
<td align="right">139</td>
<td align="left">Normal</td>
<td align="right">0.3794643</td>
<td align="right">0.8500000</td>
</tr>
<tr class="odd">
<td align="right">0.7227273</td>
<td align="right">82</td>
<td align="right">204</td>
<td align="right">13</td>
<td align="right">142</td>
<td align="left">Normal</td>
<td align="right">0.3660714</td>
<td align="right">0.8631579</td>
</tr>
<tr class="even">
<td align="right">0.7318182</td>
<td align="right">80</td>
<td align="right">207</td>
<td align="right">10</td>
<td align="right">144</td>
<td align="left">Normal</td>
<td align="right">0.3571429</td>
<td align="right">0.8888889</td>
</tr>
<tr class="odd">
<td align="right">0.7409091</td>
<td align="right">80</td>
<td align="right">208</td>
<td align="right">9</td>
<td align="right">144</td>
<td align="left">Normal</td>
<td align="right">0.3571429</td>
<td align="right">0.8988764</td>
</tr>
<tr class="even">
<td align="right">0.7500000</td>
<td align="right">78</td>
<td align="right">211</td>
<td align="right">6</td>
<td align="right">146</td>
<td align="left">Normal</td>
<td align="right">0.3482143</td>
<td align="right">0.9285714</td>
</tr>
<tr class="odd">
<td align="right">0.7590909</td>
<td align="right">76</td>
<td align="right">212</td>
<td align="right">5</td>
<td align="right">148</td>
<td align="left">Normal</td>
<td align="right">0.3392857</td>
<td align="right">0.9382716</td>
</tr>
<tr class="even">
<td align="right">0.7681818</td>
<td align="right">71</td>
<td align="right">212</td>
<td align="right">5</td>
<td align="right">153</td>
<td align="left">Normal</td>
<td align="right">0.3169643</td>
<td align="right">0.9342105</td>
</tr>
<tr class="odd">
<td align="right">0.7772727</td>
<td align="right">70</td>
<td align="right">212</td>
<td align="right">5</td>
<td align="right">154</td>
<td align="left">Normal</td>
<td align="right">0.3125000</td>
<td align="right">0.9333333</td>
</tr>
<tr class="even">
<td align="right">0.7863636</td>
<td align="right">65</td>
<td align="right">212</td>
<td align="right">5</td>
<td align="right">159</td>
<td align="left">Normal</td>
<td align="right">0.2901786</td>
<td align="right">0.9285714</td>
</tr>
<tr class="odd">
<td align="right">0.7954545</td>
<td align="right">59</td>
<td align="right">212</td>
<td align="right">5</td>
<td align="right">165</td>
<td align="left">Normal</td>
<td align="right">0.2633929</td>
<td align="right">0.9218750</td>
</tr>
<tr class="even">
<td align="right">0.8045455</td>
<td align="right">55</td>
<td align="right">212</td>
<td align="right">5</td>
<td align="right">169</td>
<td align="left">Normal</td>
<td align="right">0.2455357</td>
<td align="right">0.9166667</td>
</tr>
<tr class="odd">
<td align="right">0.8136364</td>
<td align="right">50</td>
<td align="right">212</td>
<td align="right">5</td>
<td align="right">174</td>
<td align="left">Normal</td>
<td align="right">0.2232143</td>
<td align="right">0.9090909</td>
</tr>
<tr class="even">
<td align="right">0.8227273</td>
<td align="right">44</td>
<td align="right">214</td>
<td align="right">3</td>
<td align="right">180</td>
<td align="left">Normal</td>
<td align="right">0.1964286</td>
<td align="right">0.9361702</td>
</tr>
<tr class="odd">
<td align="right">0.8318182</td>
<td align="right">42</td>
<td align="right">215</td>
<td align="right">2</td>
<td align="right">182</td>
<td align="left">Normal</td>
<td align="right">0.1875000</td>
<td align="right">0.9545455</td>
</tr>
<tr class="even">
<td align="right">0.8409091</td>
<td align="right">41</td>
<td align="right">215</td>
<td align="right">2</td>
<td align="right">183</td>
<td align="left">Normal</td>
<td align="right">0.1830357</td>
<td align="right">0.9534884</td>
</tr>
<tr class="odd">
<td align="right">0.8500000</td>
<td align="right">39</td>
<td align="right">215</td>
<td align="right">2</td>
<td align="right">185</td>
<td align="left">Normal</td>
<td align="right">0.1741071</td>
<td align="right">0.9512195</td>
</tr>
<tr class="even">
<td align="right">0.8590909</td>
<td align="right">32</td>
<td align="right">217</td>
<td align="right">0</td>
<td align="right">192</td>
<td align="left">Normal</td>
<td align="right">0.1428571</td>
<td align="right">1.0000000</td>
</tr>
<tr class="odd">
<td align="right">0.8681818</td>
<td align="right">28</td>
<td align="right">217</td>
<td align="right">0</td>
<td align="right">196</td>
<td align="left">Normal</td>
<td align="right">0.1250000</td>
<td align="right">1.0000000</td>
</tr>
<tr class="even">
<td align="right">0.8772727</td>
<td align="right">27</td>
<td align="right">217</td>
<td align="right">0</td>
<td align="right">197</td>
<td align="left">Normal</td>
<td align="right">0.1205357</td>
<td align="right">1.0000000</td>
</tr>
<tr class="odd">
<td align="right">0.8863636</td>
<td align="right">25</td>
<td align="right">217</td>
<td align="right">0</td>
<td align="right">199</td>
<td align="left">Normal</td>
<td align="right">0.1116071</td>
<td align="right">1.0000000</td>
</tr>
<tr class="even">
<td align="right">0.8954545</td>
<td align="right">23</td>
<td align="right">217</td>
<td align="right">0</td>
<td align="right">201</td>
<td align="left">Normal</td>
<td align="right">0.1026786</td>
<td align="right">1.0000000</td>
</tr>
<tr class="odd">
<td align="right">0.9045455</td>
<td align="right">22</td>
<td align="right">217</td>
<td align="right">0</td>
<td align="right">202</td>
<td align="left">Normal</td>
<td align="right">0.0982143</td>
<td align="right">1.0000000</td>
</tr>
<tr class="even">
<td align="right">0.9136364</td>
<td align="right">20</td>
<td align="right">217</td>
<td align="right">0</td>
<td align="right">204</td>
<td align="left">Normal</td>
<td align="right">0.0892857</td>
<td align="right">1.0000000</td>
</tr>
<tr class="odd">
<td align="right">0.9227273</td>
<td align="right">17</td>
<td align="right">217</td>
<td align="right">0</td>
<td align="right">207</td>
<td align="left">Normal</td>
<td align="right">0.0758929</td>
<td align="right">1.0000000</td>
</tr>
<tr class="even">
<td align="right">0.9318182</td>
<td align="right">16</td>
<td align="right">217</td>
<td align="right">0</td>
<td align="right">208</td>
<td align="left">Normal</td>
<td align="right">0.0714286</td>
<td align="right">1.0000000</td>
</tr>
<tr class="odd">
<td align="right">0.9409091</td>
<td align="right">10</td>
<td align="right">217</td>
<td align="right">0</td>
<td align="right">214</td>
<td align="left">Normal</td>
<td align="right">0.0446429</td>
<td align="right">1.0000000</td>
</tr>
<tr class="even">
<td align="right">0.9500000</td>
<td align="right">7</td>
<td align="right">217</td>
<td align="right">0</td>
<td align="right">217</td>
<td align="left">Normal</td>
<td align="right">0.0312500</td>
<td align="right">1.0000000</td>
</tr>
<tr class="odd">
<td align="right">0.0500000</td>
<td align="right">224</td>
<td align="right">0</td>
<td align="right">217</td>
<td align="right">0</td>
<td align="left">Gaussian</td>
<td align="right">1.0000000</td>
<td align="right">0.5079365</td>
</tr>
<tr class="even">
<td align="right">0.0590909</td>
<td align="right">224</td>
<td align="right">0</td>
<td align="right">217</td>
<td align="right">0</td>
<td align="left">Gaussian</td>
<td align="right">1.0000000</td>
<td align="right">0.5079365</td>
</tr>
<tr class="odd">
<td align="right">0.0681818</td>
<td align="right">224</td>
<td align="right">0</td>
<td align="right">217</td>
<td align="right">0</td>
<td align="left">Gaussian</td>
<td align="right">1.0000000</td>
<td align="right">0.5079365</td>
</tr>
<tr class="even">
<td align="right">0.0772727</td>
<td align="right">224</td>
<td align="right">0</td>
<td align="right">217</td>
<td align="right">0</td>
<td align="left">Gaussian</td>
<td align="right">1.0000000</td>
<td align="right">0.5079365</td>
</tr>
<tr class="odd">
<td align="right">0.0863636</td>
<td align="right">224</td>
<td align="right">0</td>
<td align="right">217</td>
<td align="right">0</td>
<td align="left">Gaussian</td>
<td align="right">1.0000000</td>
<td align="right">0.5079365</td>
</tr>
<tr class="even">
<td align="right">0.0954545</td>
<td align="right">224</td>
<td align="right">0</td>
<td align="right">217</td>
<td align="right">0</td>
<td align="left">Gaussian</td>
<td align="right">1.0000000</td>
<td align="right">0.5079365</td>
</tr>
<tr class="odd">
<td align="right">0.1045455</td>
<td align="right">224</td>
<td align="right">0</td>
<td align="right">217</td>
<td align="right">0</td>
<td align="left">Gaussian</td>
<td align="right">1.0000000</td>
<td align="right">0.5079365</td>
</tr>
<tr class="even">
<td align="right">0.1136364</td>
<td align="right">224</td>
<td align="right">0</td>
<td align="right">217</td>
<td align="right">0</td>
<td align="left">Gaussian</td>
<td align="right">1.0000000</td>
<td align="right">0.5079365</td>
</tr>
<tr class="odd">
<td align="right">0.1227273</td>
<td align="right">224</td>
<td align="right">0</td>
<td align="right">217</td>
<td align="right">0</td>
<td align="left">Gaussian</td>
<td align="right">1.0000000</td>
<td align="right">0.5079365</td>
</tr>
<tr class="even">
<td align="right">0.1318182</td>
<td align="right">224</td>
<td align="right">0</td>
<td align="right">217</td>
<td align="right">0</td>
<td align="left">Gaussian</td>
<td align="right">1.0000000</td>
<td align="right">0.5079365</td>
</tr>
<tr class="odd">
<td align="right">0.1409091</td>
<td align="right">224</td>
<td align="right">0</td>
<td align="right">217</td>
<td align="right">0</td>
<td align="left">Gaussian</td>
<td align="right">1.0000000</td>
<td align="right">0.5079365</td>
</tr>
<tr class="even">
<td align="right">0.1500000</td>
<td align="right">224</td>
<td align="right">0</td>
<td align="right">217</td>
<td align="right">0</td>
<td align="left">Gaussian</td>
<td align="right">1.0000000</td>
<td align="right">0.5079365</td>
</tr>
<tr class="odd">
<td align="right">0.1590909</td>
<td align="right">224</td>
<td align="right">1</td>
<td align="right">216</td>
<td align="right">0</td>
<td align="left">Gaussian</td>
<td align="right">1.0000000</td>
<td align="right">0.5090909</td>
</tr>
<tr class="even">
<td align="right">0.1681818</td>
<td align="right">224</td>
<td align="right">1</td>
<td align="right">216</td>
<td align="right">0</td>
<td align="left">Gaussian</td>
<td align="right">1.0000000</td>
<td align="right">0.5090909</td>
</tr>
<tr class="odd">
<td align="right">0.1772727</td>
<td align="right">224</td>
<td align="right">1</td>
<td align="right">216</td>
<td align="right">0</td>
<td align="left">Gaussian</td>
<td align="right">1.0000000</td>
<td align="right">0.5090909</td>
</tr>
<tr class="even">
<td align="right">0.1863636</td>
<td align="right">224</td>
<td align="right">1</td>
<td align="right">216</td>
<td align="right">0</td>
<td align="left">Gaussian</td>
<td align="right">1.0000000</td>
<td align="right">0.5090909</td>
</tr>
<tr class="odd">
<td align="right">0.1954545</td>
<td align="right">224</td>
<td align="right">2</td>
<td align="right">215</td>
<td align="right">0</td>
<td align="left">Gaussian</td>
<td align="right">1.0000000</td>
<td align="right">0.5102506</td>
</tr>
<tr class="even">
<td align="right">0.2045455</td>
<td align="right">224</td>
<td align="right">3</td>
<td align="right">214</td>
<td align="right">0</td>
<td align="left">Gaussian</td>
<td align="right">1.0000000</td>
<td align="right">0.5114155</td>
</tr>
<tr class="odd">
<td align="right">0.2136364</td>
<td align="right">224</td>
<td align="right">3</td>
<td align="right">214</td>
<td align="right">0</td>
<td align="left">Gaussian</td>
<td align="right">1.0000000</td>
<td align="right">0.5114155</td>
</tr>
<tr class="even">
<td align="right">0.2227273</td>
<td align="right">224</td>
<td align="right">5</td>
<td align="right">212</td>
<td align="right">0</td>
<td align="left">Gaussian</td>
<td align="right">1.0000000</td>
<td align="right">0.5137615</td>
</tr>
<tr class="odd">
<td align="right">0.2318182</td>
<td align="right">224</td>
<td align="right">8</td>
<td align="right">209</td>
<td align="right">0</td>
<td align="left">Gaussian</td>
<td align="right">1.0000000</td>
<td align="right">0.5173210</td>
</tr>
<tr class="even">
<td align="right">0.2409091</td>
<td align="right">224</td>
<td align="right">9</td>
<td align="right">208</td>
<td align="right">0</td>
<td align="left">Gaussian</td>
<td align="right">1.0000000</td>
<td align="right">0.5185185</td>
</tr>
<tr class="odd">
<td align="right">0.2500000</td>
<td align="right">224</td>
<td align="right">12</td>
<td align="right">205</td>
<td align="right">0</td>
<td align="left">Gaussian</td>
<td align="right">1.0000000</td>
<td align="right">0.5221445</td>
</tr>
<tr class="even">
<td align="right">0.2590909</td>
<td align="right">224</td>
<td align="right">14</td>
<td align="right">203</td>
<td align="right">0</td>
<td align="left">Gaussian</td>
<td align="right">1.0000000</td>
<td align="right">0.5245902</td>
</tr>
<tr class="odd">
<td align="right">0.2681818</td>
<td align="right">224</td>
<td align="right">18</td>
<td align="right">199</td>
<td align="right">0</td>
<td align="left">Gaussian</td>
<td align="right">1.0000000</td>
<td align="right">0.5295508</td>
</tr>
<tr class="even">
<td align="right">0.2772727</td>
<td align="right">224</td>
<td align="right">20</td>
<td align="right">197</td>
<td align="right">0</td>
<td align="left">Gaussian</td>
<td align="right">1.0000000</td>
<td align="right">0.5320665</td>
</tr>
<tr class="odd">
<td align="right">0.2863636</td>
<td align="right">224</td>
<td align="right">22</td>
<td align="right">195</td>
<td align="right">0</td>
<td align="left">Gaussian</td>
<td align="right">1.0000000</td>
<td align="right">0.5346062</td>
</tr>
<tr class="even">
<td align="right">0.2954545</td>
<td align="right">224</td>
<td align="right">26</td>
<td align="right">191</td>
<td align="right">0</td>
<td align="left">Gaussian</td>
<td align="right">1.0000000</td>
<td align="right">0.5397590</td>
</tr>
<tr class="odd">
<td align="right">0.3045455</td>
<td align="right">224</td>
<td align="right">30</td>
<td align="right">187</td>
<td align="right">0</td>
<td align="left">Gaussian</td>
<td align="right">1.0000000</td>
<td align="right">0.5450122</td>
</tr>
<tr class="even">
<td align="right">0.3136364</td>
<td align="right">224</td>
<td align="right">36</td>
<td align="right">181</td>
<td align="right">0</td>
<td align="left">Gaussian</td>
<td align="right">1.0000000</td>
<td align="right">0.5530864</td>
</tr>
<tr class="odd">
<td align="right">0.3227273</td>
<td align="right">224</td>
<td align="right">39</td>
<td align="right">178</td>
<td align="right">0</td>
<td align="left">Gaussian</td>
<td align="right">1.0000000</td>
<td align="right">0.5572139</td>
</tr>
<tr class="even">
<td align="right">0.3318182</td>
<td align="right">224</td>
<td align="right">43</td>
<td align="right">174</td>
<td align="right">0</td>
<td align="left">Gaussian</td>
<td align="right">1.0000000</td>
<td align="right">0.5628141</td>
</tr>
<tr class="odd">
<td align="right">0.3409091</td>
<td align="right">223</td>
<td align="right">47</td>
<td align="right">170</td>
<td align="right">1</td>
<td align="left">Gaussian</td>
<td align="right">0.9955357</td>
<td align="right">0.5674300</td>
</tr>
<tr class="even">
<td align="right">0.3500000</td>
<td align="right">223</td>
<td align="right">54</td>
<td align="right">163</td>
<td align="right">1</td>
<td align="left">Gaussian</td>
<td align="right">0.9955357</td>
<td align="right">0.5777202</td>
</tr>
<tr class="odd">
<td align="right">0.3590909</td>
<td align="right">223</td>
<td align="right">58</td>
<td align="right">159</td>
<td align="right">1</td>
<td align="left">Gaussian</td>
<td align="right">0.9955357</td>
<td align="right">0.5837696</td>
</tr>
<tr class="even">
<td align="right">0.3681818</td>
<td align="right">223</td>
<td align="right">61</td>
<td align="right">156</td>
<td align="right">1</td>
<td align="left">Gaussian</td>
<td align="right">0.9955357</td>
<td align="right">0.5883905</td>
</tr>
<tr class="odd">
<td align="right">0.3772727</td>
<td align="right">222</td>
<td align="right">66</td>
<td align="right">151</td>
<td align="right">2</td>
<td align="left">Gaussian</td>
<td align="right">0.9910714</td>
<td align="right">0.5951743</td>
</tr>
<tr class="even">
<td align="right">0.3863636</td>
<td align="right">221</td>
<td align="right">68</td>
<td align="right">149</td>
<td align="right">3</td>
<td align="left">Gaussian</td>
<td align="right">0.9866071</td>
<td align="right">0.5972973</td>
</tr>
<tr class="odd">
<td align="right">0.3954545</td>
<td align="right">221</td>
<td align="right">74</td>
<td align="right">143</td>
<td align="right">3</td>
<td align="left">Gaussian</td>
<td align="right">0.9866071</td>
<td align="right">0.6071429</td>
</tr>
<tr class="even">
<td align="right">0.4045455</td>
<td align="right">220</td>
<td align="right">77</td>
<td align="right">140</td>
<td align="right">4</td>
<td align="left">Gaussian</td>
<td align="right">0.9821429</td>
<td align="right">0.6111111</td>
</tr>
<tr class="odd">
<td align="right">0.4136364</td>
<td align="right">219</td>
<td align="right">82</td>
<td align="right">135</td>
<td align="right">5</td>
<td align="left">Gaussian</td>
<td align="right">0.9776786</td>
<td align="right">0.6186441</td>
</tr>
<tr class="even">
<td align="right">0.4227273</td>
<td align="right">219</td>
<td align="right">88</td>
<td align="right">129</td>
<td align="right">5</td>
<td align="left">Gaussian</td>
<td align="right">0.9776786</td>
<td align="right">0.6293103</td>
</tr>
<tr class="odd">
<td align="right">0.4318182</td>
<td align="right">218</td>
<td align="right">94</td>
<td align="right">123</td>
<td align="right">6</td>
<td align="left">Gaussian</td>
<td align="right">0.9732143</td>
<td align="right">0.6392962</td>
</tr>
<tr class="even">
<td align="right">0.4409091</td>
<td align="right">217</td>
<td align="right">99</td>
<td align="right">118</td>
<td align="right">7</td>
<td align="left">Gaussian</td>
<td align="right">0.9687500</td>
<td align="right">0.6477612</td>
</tr>
<tr class="odd">
<td align="right">0.4500000</td>
<td align="right">217</td>
<td align="right">100</td>
<td align="right">117</td>
<td align="right">7</td>
<td align="left">Gaussian</td>
<td align="right">0.9687500</td>
<td align="right">0.6497006</td>
</tr>
<tr class="even">
<td align="right">0.4590909</td>
<td align="right">216</td>
<td align="right">106</td>
<td align="right">111</td>
<td align="right">8</td>
<td align="left">Gaussian</td>
<td align="right">0.9642857</td>
<td align="right">0.6605505</td>
</tr>
<tr class="odd">
<td align="right">0.4681818</td>
<td align="right">214</td>
<td align="right">110</td>
<td align="right">107</td>
<td align="right">10</td>
<td align="left">Gaussian</td>
<td align="right">0.9553571</td>
<td align="right">0.6666667</td>
</tr>
<tr class="even">
<td align="right">0.4772727</td>
<td align="right">213</td>
<td align="right">115</td>
<td align="right">102</td>
<td align="right">11</td>
<td align="left">Gaussian</td>
<td align="right">0.9508929</td>
<td align="right">0.6761905</td>
</tr>
<tr class="odd">
<td align="right">0.4863636</td>
<td align="right">209</td>
<td align="right">125</td>
<td align="right">92</td>
<td align="right">15</td>
<td align="left">Gaussian</td>
<td align="right">0.9330357</td>
<td align="right">0.6943522</td>
</tr>
<tr class="even">
<td align="right">0.4954545</td>
<td align="right">208</td>
<td align="right">133</td>
<td align="right">84</td>
<td align="right">16</td>
<td align="left">Gaussian</td>
<td align="right">0.9285714</td>
<td align="right">0.7123288</td>
</tr>
<tr class="odd">
<td align="right">0.5045455</td>
<td align="right">207</td>
<td align="right">139</td>
<td align="right">78</td>
<td align="right">17</td>
<td align="left">Gaussian</td>
<td align="right">0.9241071</td>
<td align="right">0.7263158</td>
</tr>
<tr class="even">
<td align="right">0.5136364</td>
<td align="right">205</td>
<td align="right">142</td>
<td align="right">75</td>
<td align="right">19</td>
<td align="left">Gaussian</td>
<td align="right">0.9151786</td>
<td align="right">0.7321429</td>
</tr>
<tr class="odd">
<td align="right">0.5227273</td>
<td align="right">202</td>
<td align="right">149</td>
<td align="right">68</td>
<td align="right">22</td>
<td align="left">Gaussian</td>
<td align="right">0.9017857</td>
<td align="right">0.7481481</td>
</tr>
<tr class="even">
<td align="right">0.5318182</td>
<td align="right">194</td>
<td align="right">154</td>
<td align="right">63</td>
<td align="right">30</td>
<td align="left">Gaussian</td>
<td align="right">0.8660714</td>
<td align="right">0.7548638</td>
</tr>
<tr class="odd">
<td align="right">0.5409091</td>
<td align="right">189</td>
<td align="right">162</td>
<td align="right">55</td>
<td align="right">35</td>
<td align="left">Gaussian</td>
<td align="right">0.8437500</td>
<td align="right">0.7745902</td>
</tr>
<tr class="even">
<td align="right">0.5500000</td>
<td align="right">181</td>
<td align="right">167</td>
<td align="right">50</td>
<td align="right">43</td>
<td align="left">Gaussian</td>
<td align="right">0.8080357</td>
<td align="right">0.7835498</td>
</tr>
<tr class="odd">
<td align="right">0.5590909</td>
<td align="right">178</td>
<td align="right">171</td>
<td align="right">46</td>
<td align="right">46</td>
<td align="left">Gaussian</td>
<td align="right">0.7946429</td>
<td align="right">0.7946429</td>
</tr>
<tr class="even">
<td align="right">0.5681818</td>
<td align="right">170</td>
<td align="right">174</td>
<td align="right">43</td>
<td align="right">54</td>
<td align="left">Gaussian</td>
<td align="right">0.7589286</td>
<td align="right">0.7981221</td>
</tr>
<tr class="odd">
<td align="right">0.5772727</td>
<td align="right">164</td>
<td align="right">177</td>
<td align="right">40</td>
<td align="right">60</td>
<td align="left">Gaussian</td>
<td align="right">0.7321429</td>
<td align="right">0.8039216</td>
</tr>
<tr class="even">
<td align="right">0.5863636</td>
<td align="right">159</td>
<td align="right">180</td>
<td align="right">37</td>
<td align="right">65</td>
<td align="left">Gaussian</td>
<td align="right">0.7098214</td>
<td align="right">0.8112245</td>
</tr>
<tr class="odd">
<td align="right">0.5954545</td>
<td align="right">151</td>
<td align="right">185</td>
<td align="right">32</td>
<td align="right">73</td>
<td align="left">Gaussian</td>
<td align="right">0.6741071</td>
<td align="right">0.8251366</td>
</tr>
<tr class="even">
<td align="right">0.6045455</td>
<td align="right">148</td>
<td align="right">189</td>
<td align="right">28</td>
<td align="right">76</td>
<td align="left">Gaussian</td>
<td align="right">0.6607143</td>
<td align="right">0.8409091</td>
</tr>
<tr class="odd">
<td align="right">0.6136364</td>
<td align="right">144</td>
<td align="right">191</td>
<td align="right">26</td>
<td align="right">80</td>
<td align="left">Gaussian</td>
<td align="right">0.6428571</td>
<td align="right">0.8470588</td>
</tr>
<tr class="even">
<td align="right">0.6227273</td>
<td align="right">138</td>
<td align="right">196</td>
<td align="right">21</td>
<td align="right">86</td>
<td align="left">Gaussian</td>
<td align="right">0.6160714</td>
<td align="right">0.8679245</td>
</tr>
<tr class="odd">
<td align="right">0.6318182</td>
<td align="right">130</td>
<td align="right">198</td>
<td align="right">19</td>
<td align="right">94</td>
<td align="left">Gaussian</td>
<td align="right">0.5803571</td>
<td align="right">0.8724832</td>
</tr>
<tr class="even">
<td align="right">0.6409091</td>
<td align="right">127</td>
<td align="right">200</td>
<td align="right">17</td>
<td align="right">97</td>
<td align="left">Gaussian</td>
<td align="right">0.5669643</td>
<td align="right">0.8819444</td>
</tr>
<tr class="odd">
<td align="right">0.6500000</td>
<td align="right">121</td>
<td align="right">202</td>
<td align="right">15</td>
<td align="right">103</td>
<td align="left">Gaussian</td>
<td align="right">0.5401786</td>
<td align="right">0.8897059</td>
</tr>
<tr class="even">
<td align="right">0.6590909</td>
<td align="right">112</td>
<td align="right">203</td>
<td align="right">14</td>
<td align="right">112</td>
<td align="left">Gaussian</td>
<td align="right">0.5000000</td>
<td align="right">0.8888889</td>
</tr>
<tr class="odd">
<td align="right">0.6681818</td>
<td align="right">109</td>
<td align="right">204</td>
<td align="right">13</td>
<td align="right">115</td>
<td align="left">Gaussian</td>
<td align="right">0.4866071</td>
<td align="right">0.8934426</td>
</tr>
<tr class="even">
<td align="right">0.6772727</td>
<td align="right">102</td>
<td align="right">206</td>
<td align="right">11</td>
<td align="right">122</td>
<td align="left">Gaussian</td>
<td align="right">0.4553571</td>
<td align="right">0.9026549</td>
</tr>
<tr class="odd">
<td align="right">0.6863636</td>
<td align="right">100</td>
<td align="right">210</td>
<td align="right">7</td>
<td align="right">124</td>
<td align="left">Gaussian</td>
<td align="right">0.4464286</td>
<td align="right">0.9345794</td>
</tr>
<tr class="even">
<td align="right">0.6954545</td>
<td align="right">93</td>
<td align="right">211</td>
<td align="right">6</td>
<td align="right">131</td>
<td align="left">Gaussian</td>
<td align="right">0.4151786</td>
<td align="right">0.9393939</td>
</tr>
<tr class="odd">
<td align="right">0.7045455</td>
<td align="right">82</td>
<td align="right">212</td>
<td align="right">5</td>
<td align="right">142</td>
<td align="left">Gaussian</td>
<td align="right">0.3660714</td>
<td align="right">0.9425287</td>
</tr>
<tr class="even">
<td align="right">0.7136364</td>
<td align="right">77</td>
<td align="right">213</td>
<td align="right">4</td>
<td align="right">147</td>
<td align="left">Gaussian</td>
<td align="right">0.3437500</td>
<td align="right">0.9506173</td>
</tr>
<tr class="odd">
<td align="right">0.7227273</td>
<td align="right">72</td>
<td align="right">213</td>
<td align="right">4</td>
<td align="right">152</td>
<td align="left">Gaussian</td>
<td align="right">0.3214286</td>
<td align="right">0.9473684</td>
</tr>
<tr class="even">
<td align="right">0.7318182</td>
<td align="right">70</td>
<td align="right">213</td>
<td align="right">4</td>
<td align="right">154</td>
<td align="left">Gaussian</td>
<td align="right">0.3125000</td>
<td align="right">0.9459459</td>
</tr>
<tr class="odd">
<td align="right">0.7409091</td>
<td align="right">64</td>
<td align="right">213</td>
<td align="right">4</td>
<td align="right">160</td>
<td align="left">Gaussian</td>
<td align="right">0.2857143</td>
<td align="right">0.9411765</td>
</tr>
<tr class="even">
<td align="right">0.7500000</td>
<td align="right">58</td>
<td align="right">213</td>
<td align="right">4</td>
<td align="right">166</td>
<td align="left">Gaussian</td>
<td align="right">0.2589286</td>
<td align="right">0.9354839</td>
</tr>
<tr class="odd">
<td align="right">0.7590909</td>
<td align="right">55</td>
<td align="right">215</td>
<td align="right">2</td>
<td align="right">169</td>
<td align="left">Gaussian</td>
<td align="right">0.2455357</td>
<td align="right">0.9649123</td>
</tr>
<tr class="even">
<td align="right">0.7681818</td>
<td align="right">47</td>
<td align="right">215</td>
<td align="right">2</td>
<td align="right">177</td>
<td align="left">Gaussian</td>
<td align="right">0.2098214</td>
<td align="right">0.9591837</td>
</tr>
<tr class="odd">
<td align="right">0.7772727</td>
<td align="right">44</td>
<td align="right">215</td>
<td align="right">2</td>
<td align="right">180</td>
<td align="left">Gaussian</td>
<td align="right">0.1964286</td>
<td align="right">0.9565217</td>
</tr>
<tr class="even">
<td align="right">0.7863636</td>
<td align="right">38</td>
<td align="right">217</td>
<td align="right">0</td>
<td align="right">186</td>
<td align="left">Gaussian</td>
<td align="right">0.1696429</td>
<td align="right">1.0000000</td>
</tr>
<tr class="odd">
<td align="right">0.7954545</td>
<td align="right">33</td>
<td align="right">217</td>
<td align="right">0</td>
<td align="right">191</td>
<td align="left">Gaussian</td>
<td align="right">0.1473214</td>
<td align="right">1.0000000</td>
</tr>
<tr class="even">
<td align="right">0.8045455</td>
<td align="right">30</td>
<td align="right">217</td>
<td align="right">0</td>
<td align="right">194</td>
<td align="left">Gaussian</td>
<td align="right">0.1339286</td>
<td align="right">1.0000000</td>
</tr>
<tr class="odd">
<td align="right">0.8136364</td>
<td align="right">25</td>
<td align="right">217</td>
<td align="right">0</td>
<td align="right">199</td>
<td align="left">Gaussian</td>
<td align="right">0.1116071</td>
<td align="right">1.0000000</td>
</tr>
<tr class="even">
<td align="right">0.8227273</td>
<td align="right">22</td>
<td align="right">217</td>
<td align="right">0</td>
<td align="right">202</td>
<td align="left">Gaussian</td>
<td align="right">0.0982143</td>
<td align="right">1.0000000</td>
</tr>
<tr class="odd">
<td align="right">0.8318182</td>
<td align="right">18</td>
<td align="right">217</td>
<td align="right">0</td>
<td align="right">206</td>
<td align="left">Gaussian</td>
<td align="right">0.0803571</td>
<td align="right">1.0000000</td>
</tr>
<tr class="even">
<td align="right">0.8409091</td>
<td align="right">15</td>
<td align="right">217</td>
<td align="right">0</td>
<td align="right">209</td>
<td align="left">Gaussian</td>
<td align="right">0.0669643</td>
<td align="right">1.0000000</td>
</tr>
<tr class="odd">
<td align="right">0.8500000</td>
<td align="right">11</td>
<td align="right">217</td>
<td align="right">0</td>
<td align="right">213</td>
<td align="left">Gaussian</td>
<td align="right">0.0491071</td>
<td align="right">1.0000000</td>
</tr>
<tr class="even">
<td align="right">0.8590909</td>
<td align="right">10</td>
<td align="right">217</td>
<td align="right">0</td>
<td align="right">214</td>
<td align="left">Gaussian</td>
<td align="right">0.0446429</td>
<td align="right">1.0000000</td>
</tr>
<tr class="odd">
<td align="right">0.8681818</td>
<td align="right">7</td>
<td align="right">217</td>
<td align="right">0</td>
<td align="right">217</td>
<td align="left">Gaussian</td>
<td align="right">0.0312500</td>
<td align="right">1.0000000</td>
</tr>
<tr class="even">
<td align="right">0.8772727</td>
<td align="right">5</td>
<td align="right">217</td>
<td align="right">0</td>
<td align="right">219</td>
<td align="left">Gaussian</td>
<td align="right">0.0223214</td>
<td align="right">1.0000000</td>
</tr>
<tr class="odd">
<td align="right">0.8863636</td>
<td align="right">3</td>
<td align="right">217</td>
<td align="right">0</td>
<td align="right">221</td>
<td align="left">Gaussian</td>
<td align="right">0.0133929</td>
<td align="right">1.0000000</td>
</tr>
<tr class="even">
<td align="right">0.8954545</td>
<td align="right">1</td>
<td align="right">217</td>
<td align="right">0</td>
<td align="right">223</td>
<td align="left">Gaussian</td>
<td align="right">0.0044643</td>
<td align="right">1.0000000</td>
</tr>
<tr class="odd">
<td align="right">0.9045455</td>
<td align="right">1</td>
<td align="right">217</td>
<td align="right">0</td>
<td align="right">223</td>
<td align="left">Gaussian</td>
<td align="right">0.0044643</td>
<td align="right">1.0000000</td>
</tr>
<tr class="even">
<td align="right">0.9136364</td>
<td align="right">0</td>
<td align="right">217</td>
<td align="right">0</td>
<td align="right">224</td>
<td align="left">Gaussian</td>
<td align="right">0.0000000</td>
<td align="right">NaN</td>
</tr>
<tr class="odd">
<td align="right">0.9227273</td>
<td align="right">0</td>
<td align="right">217</td>
<td align="right">0</td>
<td align="right">224</td>
<td align="left">Gaussian</td>
<td align="right">0.0000000</td>
<td align="right">NaN</td>
</tr>
<tr class="even">
<td align="right">0.9318182</td>
<td align="right">0</td>
<td align="right">217</td>
<td align="right">0</td>
<td align="right">224</td>
<td align="left">Gaussian</td>
<td align="right">0.0000000</td>
<td align="right">NaN</td>
</tr>
<tr class="odd">
<td align="right">0.9409091</td>
<td align="right">0</td>
<td align="right">217</td>
<td align="right">0</td>
<td align="right">224</td>
<td align="left">Gaussian</td>
<td align="right">0.0000000</td>
<td align="right">NaN</td>
</tr>
<tr class="even">
<td align="right">0.9500000</td>
<td align="right">0</td>
<td align="right">217</td>
<td align="right">0</td>
<td align="right">224</td>
<td align="left">Gaussian</td>
<td align="right">0.0000000</td>
<td align="right">NaN</td>
</tr>
<tr class="odd">
<td align="right">0.0500000</td>
<td align="right">224</td>
<td align="right">0</td>
<td align="right">217</td>
<td align="right">0</td>
<td align="left">Median</td>
<td align="right">1.0000000</td>
<td align="right">0.5079365</td>
</tr>
<tr class="even">
<td align="right">0.0590909</td>
<td align="right">224</td>
<td align="right">0</td>
<td align="right">217</td>
<td align="right">0</td>
<td align="left">Median</td>
<td align="right">1.0000000</td>
<td align="right">0.5079365</td>
</tr>
<tr class="odd">
<td align="right">0.0681818</td>
<td align="right">224</td>
<td align="right">0</td>
<td align="right">217</td>
<td align="right">0</td>
<td align="left">Median</td>
<td align="right">1.0000000</td>
<td align="right">0.5079365</td>
</tr>
<tr class="even">
<td align="right">0.0772727</td>
<td align="right">224</td>
<td align="right">0</td>
<td align="right">217</td>
<td align="right">0</td>
<td align="left">Median</td>
<td align="right">1.0000000</td>
<td align="right">0.5079365</td>
</tr>
<tr class="odd">
<td align="right">0.0863636</td>
<td align="right">224</td>
<td align="right">0</td>
<td align="right">217</td>
<td align="right">0</td>
<td align="left">Median</td>
<td align="right">1.0000000</td>
<td align="right">0.5079365</td>
</tr>
<tr class="even">
<td align="right">0.0954545</td>
<td align="right">224</td>
<td align="right">0</td>
<td align="right">217</td>
<td align="right">0</td>
<td align="left">Median</td>
<td align="right">1.0000000</td>
<td align="right">0.5079365</td>
</tr>
<tr class="odd">
<td align="right">0.1045455</td>
<td align="right">224</td>
<td align="right">0</td>
<td align="right">217</td>
<td align="right">0</td>
<td align="left">Median</td>
<td align="right">1.0000000</td>
<td align="right">0.5079365</td>
</tr>
<tr class="even">
<td align="right">0.1136364</td>
<td align="right">224</td>
<td align="right">0</td>
<td align="right">217</td>
<td align="right">0</td>
<td align="left">Median</td>
<td align="right">1.0000000</td>
<td align="right">0.5079365</td>
</tr>
<tr class="odd">
<td align="right">0.1227273</td>
<td align="right">224</td>
<td align="right">0</td>
<td align="right">217</td>
<td align="right">0</td>
<td align="left">Median</td>
<td align="right">1.0000000</td>
<td align="right">0.5079365</td>
</tr>
<tr class="even">
<td align="right">0.1318182</td>
<td align="right">224</td>
<td align="right">0</td>
<td align="right">217</td>
<td align="right">0</td>
<td align="left">Median</td>
<td align="right">1.0000000</td>
<td align="right">0.5079365</td>
</tr>
<tr class="odd">
<td align="right">0.1409091</td>
<td align="right">224</td>
<td align="right">0</td>
<td align="right">217</td>
<td align="right">0</td>
<td align="left">Median</td>
<td align="right">1.0000000</td>
<td align="right">0.5079365</td>
</tr>
<tr class="even">
<td align="right">0.1500000</td>
<td align="right">224</td>
<td align="right">0</td>
<td align="right">217</td>
<td align="right">0</td>
<td align="left">Median</td>
<td align="right">1.0000000</td>
<td align="right">0.5079365</td>
</tr>
<tr class="odd">
<td align="right">0.1590909</td>
<td align="right">224</td>
<td align="right">0</td>
<td align="right">217</td>
<td align="right">0</td>
<td align="left">Median</td>
<td align="right">1.0000000</td>
<td align="right">0.5079365</td>
</tr>
<tr class="even">
<td align="right">0.1681818</td>
<td align="right">224</td>
<td align="right">0</td>
<td align="right">217</td>
<td align="right">0</td>
<td align="left">Median</td>
<td align="right">1.0000000</td>
<td align="right">0.5079365</td>
</tr>
<tr class="odd">
<td align="right">0.1772727</td>
<td align="right">224</td>
<td align="right">0</td>
<td align="right">217</td>
<td align="right">0</td>
<td align="left">Median</td>
<td align="right">1.0000000</td>
<td align="right">0.5079365</td>
</tr>
<tr class="even">
<td align="right">0.1863636</td>
<td align="right">224</td>
<td align="right">0</td>
<td align="right">217</td>
<td align="right">0</td>
<td align="left">Median</td>
<td align="right">1.0000000</td>
<td align="right">0.5079365</td>
</tr>
<tr class="odd">
<td align="right">0.1954545</td>
<td align="right">224</td>
<td align="right">0</td>
<td align="right">217</td>
<td align="right">0</td>
<td align="left">Median</td>
<td align="right">1.0000000</td>
<td align="right">0.5079365</td>
</tr>
<tr class="even">
<td align="right">0.2045455</td>
<td align="right">224</td>
<td align="right">0</td>
<td align="right">217</td>
<td align="right">0</td>
<td align="left">Median</td>
<td align="right">1.0000000</td>
<td align="right">0.5079365</td>
</tr>
<tr class="odd">
<td align="right">0.2136364</td>
<td align="right">224</td>
<td align="right">0</td>
<td align="right">217</td>
<td align="right">0</td>
<td align="left">Median</td>
<td align="right">1.0000000</td>
<td align="right">0.5079365</td>
</tr>
<tr class="even">
<td align="right">0.2227273</td>
<td align="right">224</td>
<td align="right">0</td>
<td align="right">217</td>
<td align="right">0</td>
<td align="left">Median</td>
<td align="right">1.0000000</td>
<td align="right">0.5079365</td>
</tr>
<tr class="odd">
<td align="right">0.2318182</td>
<td align="right">224</td>
<td align="right">0</td>
<td align="right">217</td>
<td align="right">0</td>
<td align="left">Median</td>
<td align="right">1.0000000</td>
<td align="right">0.5079365</td>
</tr>
<tr class="even">
<td align="right">0.2409091</td>
<td align="right">224</td>
<td align="right">0</td>
<td align="right">217</td>
<td align="right">0</td>
<td align="left">Median</td>
<td align="right">1.0000000</td>
<td align="right">0.5079365</td>
</tr>
<tr class="odd">
<td align="right">0.2500000</td>
<td align="right">224</td>
<td align="right">0</td>
<td align="right">217</td>
<td align="right">0</td>
<td align="left">Median</td>
<td align="right">1.0000000</td>
<td align="right">0.5079365</td>
</tr>
<tr class="even">
<td align="right">0.2590909</td>
<td align="right">224</td>
<td align="right">0</td>
<td align="right">217</td>
<td align="right">0</td>
<td align="left">Median</td>
<td align="right">1.0000000</td>
<td align="right">0.5079365</td>
</tr>
<tr class="odd">
<td align="right">0.2681818</td>
<td align="right">224</td>
<td align="right">0</td>
<td align="right">217</td>
<td align="right">0</td>
<td align="left">Median</td>
<td align="right">1.0000000</td>
<td align="right">0.5079365</td>
</tr>
<tr class="even">
<td align="right">0.2772727</td>
<td align="right">224</td>
<td align="right">0</td>
<td align="right">217</td>
<td align="right">0</td>
<td align="left">Median</td>
<td align="right">1.0000000</td>
<td align="right">0.5079365</td>
</tr>
<tr class="odd">
<td align="right">0.2863636</td>
<td align="right">224</td>
<td align="right">0</td>
<td align="right">217</td>
<td align="right">0</td>
<td align="left">Median</td>
<td align="right">1.0000000</td>
<td align="right">0.5079365</td>
</tr>
<tr class="even">
<td align="right">0.2954545</td>
<td align="right">224</td>
<td align="right">0</td>
<td align="right">217</td>
<td align="right">0</td>
<td align="left">Median</td>
<td align="right">1.0000000</td>
<td align="right">0.5079365</td>
</tr>
<tr class="odd">
<td align="right">0.3045455</td>
<td align="right">224</td>
<td align="right">0</td>
<td align="right">217</td>
<td align="right">0</td>
<td align="left">Median</td>
<td align="right">1.0000000</td>
<td align="right">0.5079365</td>
</tr>
<tr class="even">
<td align="right">0.3136364</td>
<td align="right">224</td>
<td align="right">0</td>
<td align="right">217</td>
<td align="right">0</td>
<td align="left">Median</td>
<td align="right">1.0000000</td>
<td align="right">0.5079365</td>
</tr>
<tr class="odd">
<td align="right">0.3227273</td>
<td align="right">224</td>
<td align="right">0</td>
<td align="right">217</td>
<td align="right">0</td>
<td align="left">Median</td>
<td align="right">1.0000000</td>
<td align="right">0.5079365</td>
</tr>
<tr class="even">
<td align="right">0.3318182</td>
<td align="right">224</td>
<td align="right">1</td>
<td align="right">216</td>
<td align="right">0</td>
<td align="left">Median</td>
<td align="right">1.0000000</td>
<td align="right">0.5090909</td>
</tr>
<tr class="odd">
<td align="right">0.3409091</td>
<td align="right">224</td>
<td align="right">1</td>
<td align="right">216</td>
<td align="right">0</td>
<td align="left">Median</td>
<td align="right">1.0000000</td>
<td align="right">0.5090909</td>
</tr>
<tr class="even">
<td align="right">0.3500000</td>
<td align="right">224</td>
<td align="right">1</td>
<td align="right">216</td>
<td align="right">0</td>
<td align="left">Median</td>
<td align="right">1.0000000</td>
<td align="right">0.5090909</td>
</tr>
<tr class="odd">
<td align="right">0.3590909</td>
<td align="right">224</td>
<td align="right">2</td>
<td align="right">215</td>
<td align="right">0</td>
<td align="left">Median</td>
<td align="right">1.0000000</td>
<td align="right">0.5102506</td>
</tr>
<tr class="even">
<td align="right">0.3681818</td>
<td align="right">224</td>
<td align="right">2</td>
<td align="right">215</td>
<td align="right">0</td>
<td align="left">Median</td>
<td align="right">1.0000000</td>
<td align="right">0.5102506</td>
</tr>
<tr class="odd">
<td align="right">0.3772727</td>
<td align="right">224</td>
<td align="right">2</td>
<td align="right">215</td>
<td align="right">0</td>
<td align="left">Median</td>
<td align="right">1.0000000</td>
<td align="right">0.5102506</td>
</tr>
<tr class="even">
<td align="right">0.3863636</td>
<td align="right">224</td>
<td align="right">2</td>
<td align="right">215</td>
<td align="right">0</td>
<td align="left">Median</td>
<td align="right">1.0000000</td>
<td align="right">0.5102506</td>
</tr>
<tr class="odd">
<td align="right">0.3954545</td>
<td align="right">224</td>
<td align="right">2</td>
<td align="right">215</td>
<td align="right">0</td>
<td align="left">Median</td>
<td align="right">1.0000000</td>
<td align="right">0.5102506</td>
</tr>
<tr class="even">
<td align="right">0.4045455</td>
<td align="right">224</td>
<td align="right">2</td>
<td align="right">215</td>
<td align="right">0</td>
<td align="left">Median</td>
<td align="right">1.0000000</td>
<td align="right">0.5102506</td>
</tr>
<tr class="odd">
<td align="right">0.4136364</td>
<td align="right">224</td>
<td align="right">2</td>
<td align="right">215</td>
<td align="right">0</td>
<td align="left">Median</td>
<td align="right">1.0000000</td>
<td align="right">0.5102506</td>
</tr>
<tr class="even">
<td align="right">0.4227273</td>
<td align="right">224</td>
<td align="right">3</td>
<td align="right">214</td>
<td align="right">0</td>
<td align="left">Median</td>
<td align="right">1.0000000</td>
<td align="right">0.5114155</td>
</tr>
<tr class="odd">
<td align="right">0.4318182</td>
<td align="right">224</td>
<td align="right">4</td>
<td align="right">213</td>
<td align="right">0</td>
<td align="left">Median</td>
<td align="right">1.0000000</td>
<td align="right">0.5125858</td>
</tr>
<tr class="even">
<td align="right">0.4409091</td>
<td align="right">224</td>
<td align="right">5</td>
<td align="right">212</td>
<td align="right">0</td>
<td align="left">Median</td>
<td align="right">1.0000000</td>
<td align="right">0.5137615</td>
</tr>
<tr class="odd">
<td align="right">0.4500000</td>
<td align="right">223</td>
<td align="right">7</td>
<td align="right">210</td>
<td align="right">1</td>
<td align="left">Median</td>
<td align="right">0.9955357</td>
<td align="right">0.5150115</td>
</tr>
<tr class="even">
<td align="right">0.4590909</td>
<td align="right">222</td>
<td align="right">11</td>
<td align="right">206</td>
<td align="right">2</td>
<td align="left">Median</td>
<td align="right">0.9910714</td>
<td align="right">0.5186916</td>
</tr>
<tr class="odd">
<td align="right">0.4681818</td>
<td align="right">222</td>
<td align="right">17</td>
<td align="right">200</td>
<td align="right">2</td>
<td align="left">Median</td>
<td align="right">0.9910714</td>
<td align="right">0.5260664</td>
</tr>
<tr class="even">
<td align="right">0.4772727</td>
<td align="right">222</td>
<td align="right">20</td>
<td align="right">197</td>
<td align="right">2</td>
<td align="left">Median</td>
<td align="right">0.9910714</td>
<td align="right">0.5298329</td>
</tr>
<tr class="odd">
<td align="right">0.4863636</td>
<td align="right">222</td>
<td align="right">21</td>
<td align="right">196</td>
<td align="right">2</td>
<td align="left">Median</td>
<td align="right">0.9910714</td>
<td align="right">0.5311005</td>
</tr>
<tr class="even">
<td align="right">0.4954545</td>
<td align="right">222</td>
<td align="right">39</td>
<td align="right">178</td>
<td align="right">2</td>
<td align="left">Median</td>
<td align="right">0.9910714</td>
<td align="right">0.5550000</td>
</tr>
<tr class="odd">
<td align="right">0.5045455</td>
<td align="right">222</td>
<td align="right">60</td>
<td align="right">157</td>
<td align="right">2</td>
<td align="left">Median</td>
<td align="right">0.9910714</td>
<td align="right">0.5857520</td>
</tr>
<tr class="even">
<td align="right">0.5136364</td>
<td align="right">220</td>
<td align="right">69</td>
<td align="right">148</td>
<td align="right">4</td>
<td align="left">Median</td>
<td align="right">0.9821429</td>
<td align="right">0.5978261</td>
</tr>
<tr class="odd">
<td align="right">0.5227273</td>
<td align="right">218</td>
<td align="right">85</td>
<td align="right">132</td>
<td align="right">6</td>
<td align="left">Median</td>
<td align="right">0.9732143</td>
<td align="right">0.6228571</td>
</tr>
<tr class="even">
<td align="right">0.5318182</td>
<td align="right">214</td>
<td align="right">119</td>
<td align="right">98</td>
<td align="right">10</td>
<td align="left">Median</td>
<td align="right">0.9553571</td>
<td align="right">0.6858974</td>
</tr>
<tr class="odd">
<td align="right">0.5409091</td>
<td align="right">200</td>
<td align="right">142</td>
<td align="right">75</td>
<td align="right">24</td>
<td align="left">Median</td>
<td align="right">0.8928571</td>
<td align="right">0.7272727</td>
</tr>
<tr class="even">
<td align="right">0.5500000</td>
<td align="right">188</td>
<td align="right">155</td>
<td align="right">62</td>
<td align="right">36</td>
<td align="left">Median</td>
<td align="right">0.8392857</td>
<td align="right">0.7520000</td>
</tr>
<tr class="odd">
<td align="right">0.5590909</td>
<td align="right">179</td>
<td align="right">157</td>
<td align="right">60</td>
<td align="right">45</td>
<td align="left">Median</td>
<td align="right">0.7991071</td>
<td align="right">0.7489540</td>
</tr>
<tr class="even">
<td align="right">0.5681818</td>
<td align="right">144</td>
<td align="right">175</td>
<td align="right">42</td>
<td align="right">80</td>
<td align="left">Median</td>
<td align="right">0.6428571</td>
<td align="right">0.7741935</td>
</tr>
<tr class="odd">
<td align="right">0.5772727</td>
<td align="right">121</td>
<td align="right">182</td>
<td align="right">35</td>
<td align="right">103</td>
<td align="left">Median</td>
<td align="right">0.5401786</td>
<td align="right">0.7756410</td>
</tr>
<tr class="even">
<td align="right">0.5863636</td>
<td align="right">82</td>
<td align="right">191</td>
<td align="right">26</td>
<td align="right">142</td>
<td align="left">Median</td>
<td align="right">0.3660714</td>
<td align="right">0.7592593</td>
</tr>
<tr class="odd">
<td align="right">0.5954545</td>
<td align="right">65</td>
<td align="right">204</td>
<td align="right">13</td>
<td align="right">159</td>
<td align="left">Median</td>
<td align="right">0.2901786</td>
<td align="right">0.8333333</td>
</tr>
<tr class="even">
<td align="right">0.6045455</td>
<td align="right">52</td>
<td align="right">206</td>
<td align="right">11</td>
<td align="right">172</td>
<td align="left">Median</td>
<td align="right">0.2321429</td>
<td align="right">0.8253968</td>
</tr>
<tr class="odd">
<td align="right">0.6136364</td>
<td align="right">39</td>
<td align="right">209</td>
<td align="right">8</td>
<td align="right">185</td>
<td align="left">Median</td>
<td align="right">0.1741071</td>
<td align="right">0.8297872</td>
</tr>
<tr class="even">
<td align="right">0.6227273</td>
<td align="right">37</td>
<td align="right">209</td>
<td align="right">8</td>
<td align="right">187</td>
<td align="left">Median</td>
<td align="right">0.1651786</td>
<td align="right">0.8222222</td>
</tr>
<tr class="odd">
<td align="right">0.6318182</td>
<td align="right">34</td>
<td align="right">210</td>
<td align="right">7</td>
<td align="right">190</td>
<td align="left">Median</td>
<td align="right">0.1517857</td>
<td align="right">0.8292683</td>
</tr>
<tr class="even">
<td align="right">0.6409091</td>
<td align="right">24</td>
<td align="right">210</td>
<td align="right">7</td>
<td align="right">200</td>
<td align="left">Median</td>
<td align="right">0.1071429</td>
<td align="right">0.7741935</td>
</tr>
<tr class="odd">
<td align="right">0.6500000</td>
<td align="right">14</td>
<td align="right">213</td>
<td align="right">4</td>
<td align="right">210</td>
<td align="left">Median</td>
<td align="right">0.0625000</td>
<td align="right">0.7777778</td>
</tr>
<tr class="even">
<td align="right">0.6590909</td>
<td align="right">9</td>
<td align="right">214</td>
<td align="right">3</td>
<td align="right">215</td>
<td align="left">Median</td>
<td align="right">0.0401786</td>
<td align="right">0.7500000</td>
</tr>
<tr class="odd">
<td align="right">0.6681818</td>
<td align="right">5</td>
<td align="right">216</td>
<td align="right">1</td>
<td align="right">219</td>
<td align="left">Median</td>
<td align="right">0.0223214</td>
<td align="right">0.8333333</td>
</tr>
<tr class="even">
<td align="right">0.6772727</td>
<td align="right">0</td>
<td align="right">217</td>
<td align="right">0</td>
<td align="right">224</td>
<td align="left">Median</td>
<td align="right">0.0000000</td>
<td align="right">NaN</td>
</tr>
<tr class="odd">
<td align="right">0.6863636</td>
<td align="right">0</td>
<td align="right">217</td>
<td align="right">0</td>
<td align="right">224</td>
<td align="left">Median</td>
<td align="right">0.0000000</td>
<td align="right">NaN</td>
</tr>
<tr class="even">
<td align="right">0.6954545</td>
<td align="right">0</td>
<td align="right">217</td>
<td align="right">0</td>
<td align="right">224</td>
<td align="left">Median</td>
<td align="right">0.0000000</td>
<td align="right">NaN</td>
</tr>
<tr class="odd">
<td align="right">0.7045455</td>
<td align="right">0</td>
<td align="right">217</td>
<td align="right">0</td>
<td align="right">224</td>
<td align="left">Median</td>
<td align="right">0.0000000</td>
<td align="right">NaN</td>
</tr>
<tr class="even">
<td align="right">0.7136364</td>
<td align="right">0</td>
<td align="right">217</td>
<td align="right">0</td>
<td align="right">224</td>
<td align="left">Median</td>
<td align="right">0.0000000</td>
<td align="right">NaN</td>
</tr>
<tr class="odd">
<td align="right">0.7227273</td>
<td align="right">0</td>
<td align="right">217</td>
<td align="right">0</td>
<td align="right">224</td>
<td align="left">Median</td>
<td align="right">0.0000000</td>
<td align="right">NaN</td>
</tr>
<tr class="even">
<td align="right">0.7318182</td>
<td align="right">0</td>
<td align="right">217</td>
<td align="right">0</td>
<td align="right">224</td>
<td align="left">Median</td>
<td align="right">0.0000000</td>
<td align="right">NaN</td>
</tr>
<tr class="odd">
<td align="right">0.7409091</td>
<td align="right">0</td>
<td align="right">217</td>
<td align="right">0</td>
<td align="right">224</td>
<td align="left">Median</td>
<td align="right">0.0000000</td>
<td align="right">NaN</td>
</tr>
<tr class="even">
<td align="right">0.7500000</td>
<td align="right">0</td>
<td align="right">217</td>
<td align="right">0</td>
<td align="right">224</td>
<td align="left">Median</td>
<td align="right">0.0000000</td>
<td align="right">NaN</td>
</tr>
<tr class="odd">
<td align="right">0.7590909</td>
<td align="right">0</td>
<td align="right">217</td>
<td align="right">0</td>
<td align="right">224</td>
<td align="left">Median</td>
<td align="right">0.0000000</td>
<td align="right">NaN</td>
</tr>
<tr class="even">
<td align="right">0.7681818</td>
<td align="right">0</td>
<td align="right">217</td>
<td align="right">0</td>
<td align="right">224</td>
<td align="left">Median</td>
<td align="right">0.0000000</td>
<td align="right">NaN</td>
</tr>
<tr class="odd">
<td align="right">0.7772727</td>
<td align="right">0</td>
<td align="right">217</td>
<td align="right">0</td>
<td align="right">224</td>
<td align="left">Median</td>
<td align="right">0.0000000</td>
<td align="right">NaN</td>
</tr>
<tr class="even">
<td align="right">0.7863636</td>
<td align="right">0</td>
<td align="right">217</td>
<td align="right">0</td>
<td align="right">224</td>
<td align="left">Median</td>
<td align="right">0.0000000</td>
<td align="right">NaN</td>
</tr>
<tr class="odd">
<td align="right">0.7954545</td>
<td align="right">0</td>
<td align="right">217</td>
<td align="right">0</td>
<td align="right">224</td>
<td align="left">Median</td>
<td align="right">0.0000000</td>
<td align="right">NaN</td>
</tr>
<tr class="even">
<td align="right">0.8045455</td>
<td align="right">0</td>
<td align="right">217</td>
<td align="right">0</td>
<td align="right">224</td>
<td align="left">Median</td>
<td align="right">0.0000000</td>
<td align="right">NaN</td>
</tr>
<tr class="odd">
<td align="right">0.8136364</td>
<td align="right">0</td>
<td align="right">217</td>
<td align="right">0</td>
<td align="right">224</td>
<td align="left">Median</td>
<td align="right">0.0000000</td>
<td align="right">NaN</td>
</tr>
<tr class="even">
<td align="right">0.8227273</td>
<td align="right">0</td>
<td align="right">217</td>
<td align="right">0</td>
<td align="right">224</td>
<td align="left">Median</td>
<td align="right">0.0000000</td>
<td align="right">NaN</td>
</tr>
<tr class="odd">
<td align="right">0.8318182</td>
<td align="right">0</td>
<td align="right">217</td>
<td align="right">0</td>
<td align="right">224</td>
<td align="left">Median</td>
<td align="right">0.0000000</td>
<td align="right">NaN</td>
</tr>
<tr class="even">
<td align="right">0.8409091</td>
<td align="right">0</td>
<td align="right">217</td>
<td align="right">0</td>
<td align="right">224</td>
<td align="left">Median</td>
<td align="right">0.0000000</td>
<td align="right">NaN</td>
</tr>
<tr class="odd">
<td align="right">0.8500000</td>
<td align="right">0</td>
<td align="right">217</td>
<td align="right">0</td>
<td align="right">224</td>
<td align="left">Median</td>
<td align="right">0.0000000</td>
<td align="right">NaN</td>
</tr>
<tr class="even">
<td align="right">0.8590909</td>
<td align="right">0</td>
<td align="right">217</td>
<td align="right">0</td>
<td align="right">224</td>
<td align="left">Median</td>
<td align="right">0.0000000</td>
<td align="right">NaN</td>
</tr>
<tr class="odd">
<td align="right">0.8681818</td>
<td align="right">0</td>
<td align="right">217</td>
<td align="right">0</td>
<td align="right">224</td>
<td align="left">Median</td>
<td align="right">0.0000000</td>
<td align="right">NaN</td>
</tr>
<tr class="even">
<td align="right">0.8772727</td>
<td align="right">0</td>
<td align="right">217</td>
<td align="right">0</td>
<td align="right">224</td>
<td align="left">Median</td>
<td align="right">0.0000000</td>
<td align="right">NaN</td>
</tr>
<tr class="odd">
<td align="right">0.8863636</td>
<td align="right">0</td>
<td align="right">217</td>
<td align="right">0</td>
<td align="right">224</td>
<td align="left">Median</td>
<td align="right">0.0000000</td>
<td align="right">NaN</td>
</tr>
<tr class="even">
<td align="right">0.8954545</td>
<td align="right">0</td>
<td align="right">217</td>
<td align="right">0</td>
<td align="right">224</td>
<td align="left">Median</td>
<td align="right">0.0000000</td>
<td align="right">NaN</td>
</tr>
<tr class="odd">
<td align="right">0.9045455</td>
<td align="right">0</td>
<td align="right">217</td>
<td align="right">0</td>
<td align="right">224</td>
<td align="left">Median</td>
<td align="right">0.0000000</td>
<td align="right">NaN</td>
</tr>
<tr class="even">
<td align="right">0.9136364</td>
<td align="right">0</td>
<td align="right">217</td>
<td align="right">0</td>
<td align="right">224</td>
<td align="left">Median</td>
<td align="right">0.0000000</td>
<td align="right">NaN</td>
</tr>
<tr class="odd">
<td align="right">0.9227273</td>
<td align="right">0</td>
<td align="right">217</td>
<td align="right">0</td>
<td align="right">224</td>
<td align="left">Median</td>
<td align="right">0.0000000</td>
<td align="right">NaN</td>
</tr>
<tr class="even">
<td align="right">0.9318182</td>
<td align="right">0</td>
<td align="right">217</td>
<td align="right">0</td>
<td align="right">224</td>
<td align="left">Median</td>
<td align="right">0.0000000</td>
<td align="right">NaN</td>
</tr>
<tr class="odd">
<td align="right">0.9409091</td>
<td align="right">0</td>
<td align="right">217</td>
<td align="right">0</td>
<td align="right">224</td>
<td align="left">Median</td>
<td align="right">0.0000000</td>
<td align="right">NaN</td>
</tr>
<tr class="even">
<td align="right">0.9500000</td>
<td align="right">0</td>
<td align="right">217</td>
<td align="right">0</td>
<td align="right">224</td>
<td align="left">Median</td>
<td align="right">0.0000000</td>
<td align="right">NaN</td>
</tr>
</tbody>
</table>
</div>
<div class="row">
<button class="source R toggle btn btn-xs btn-primary">
<span class="glyphicon glyphicon-chevron-down"></span> R source
</button>
<pre style=""><code class="source r">ggplot(melt(tp.table,id.vars=c("Thresh")),
       aes(x=Thresh*100,y=value,color=variable))+
  geom_point()+
  geom_path()+
  labs(color="",y="Pixel Count",x="Threshold Value (%)")+
  scale_y_sqrt()+
  theme_bw(20)</code></pre>
<button class="error R toggle btn btn-xs btn-danger">
<span class="glyphicon glyphicon-chevron-down"></span> R error
</button>
<pre style=""><code class="error r">## Error in melt(tp.table, id.vars = c("Thresh")): cannot open file '/Users/mader/Dropbox/TeachingRelated/QuantBig/Lectures/03 - Segmentation/print_cache/unnamed-chunk-36_7b938447ad2cd5ae6096426d9158a1f0.rdb': No such file or directory
</code></pre>
</div>
<hr />
<div class="row">
<button class="source R toggle btn btn-xs btn-primary">
<span class="glyphicon glyphicon-chevron-down"></span> R source
</button>
<pre style=""><code class="source r">abs.steps<-step.fcn(road.image$val,12)</code></pre>
<button class="error R toggle btn btn-xs btn-danger">
<span class="glyphicon glyphicon-chevron-down"></span> R error
</button>
<pre style=""><code class="error r">## Error in quantile(vals, seq(0, 1, length.out = n + 2)[-c(1, n + 2)]): object 'road.image' not found
</code></pre>
<button class="source R toggle btn btn-xs btn-primary">
<span class="glyphicon glyphicon-chevron-down"></span> R source
</button>
<pre style=""><code class="source r">tp.table<-mk.stat.table(road.image,abs.steps)</code></pre>
<button class="error R toggle btn btn-xs btn-danger">
<span class="glyphicon glyphicon-chevron-down"></span> R error
</button>
<pre style=""><code class="error r">## Error in inherits(.data, "split"): object 'abs.steps' not found
</code></pre>
<button class="source R toggle btn btn-xs btn-primary">
<span class="glyphicon glyphicon-chevron-down"></span> R source
</button>
<pre style=""><code class="source r">prec.table<-mutate(tp.table,
                   Recall=TP/(TP+FN),
                  Precision=TP/(TP+FP)
                   )</code></pre>
<button class="error R toggle btn btn-xs btn-danger">
<span class="glyphicon glyphicon-chevron-down"></span> R error
</button>
<pre style=""><code class="error r">## Error in mutate_(.data, .dots = lazyeval::lazy_dots(...)): cannot open file '/Users/mader/Dropbox/TeachingRelated/QuantBig/Lectures/03 - Segmentation/print_cache/unnamed-chunk-36_7b938447ad2cd5ae6096426d9158a1f0.rdb': No such file or directory
</code></pre>
<button class="source R toggle btn btn-xs btn-primary">
<span class="glyphicon glyphicon-chevron-down"></span> R source
</button>
<pre style=""><code class="source r">ggplot(prec.table,aes(x=Recall,y=Precision))+
  geom_point(aes(color=Thresh,shape="Image"),size=5)+
  geom_point(data=data.frame(Recall=1,Precision=1),
             aes(shape="Ideal"),size=5,color="red")+
  geom_path()+
  #coord_equal()+
  scale_color_gradientn(colours=rainbow(6))+
  scale_x_sqrt()+
  labs(shape="")+
  theme_bw(20)</code></pre>
<div class="row">
<div class="col-md-offset-3 col-md-6">
<a href="#" class="thumbnail"><img src="print_figures/unnamed-chunk-44-1.png" title="plot of chunk unnamed-chunk-44" alt="plot of chunk unnamed-chunk-44" style="display: block; margin: auto;" /></a>
</div>
</div>
</div>
<h1 id="comparing-absorption-and-scattering-channels">Comparing Absorption and Scattering Channels</h1>
<p>Since our image has two channels we can examine both of them (Recall is not on a linear scale so the differences can more easily be seen). It is clear that scattering provides more useful information than absorption except for very high recall and meaninglessly low precision.</p>
<div class="row">
<button class="source R toggle btn btn-xs btn-primary">
<span class="glyphicon glyphicon-chevron-down"></span> R source
</button>
<pre style=""><code class="source r"># subtract blur
road.blur <- (road.arr - gblur(road.arr,2)) %>% im.to.df</code></pre>
<button class="error R toggle btn btn-xs btn-danger">
<span class="glyphicon glyphicon-chevron-down"></span> R error
</button>
<pre style=""><code class="error r">## Error in eval(expr, envir, enclos): object 'road.arr' not found
</code></pre>
<button class="source R toggle btn btn-xs btn-primary">
<span class="glyphicon glyphicon-chevron-down"></span> R source
</button>
<pre style=""><code class="source r">dci.steps<-step.fcn(road.blur$val,12)</code></pre>
<button class="error R toggle btn btn-xs btn-danger">
<span class="glyphicon glyphicon-chevron-down"></span> R error
</button>
<pre style=""><code class="error r">## Error in quantile(vals, seq(0, 1, length.out = n + 2)[-c(1, n + 2)]): object 'road.blur' not found
</code></pre>
<button class="source R toggle btn btn-xs btn-primary">
<span class="glyphicon glyphicon-chevron-down"></span> R source
</button>
<pre style=""><code class="source r">dci.table<-mk.stat.table(road.blur,dci.steps)</code></pre>
<button class="error R toggle btn btn-xs btn-danger">
<span class="glyphicon glyphicon-chevron-down"></span> R error
</button>
<pre style=""><code class="error r">## Error in inherits(.data, "split"): object 'dci.steps' not found
</code></pre>
<button class="source R toggle btn btn-xs btn-primary">
<span class="glyphicon glyphicon-chevron-down"></span> R source
</button>
<pre style=""><code class="source r">prec.dci.table<-mutate(dci.table,
                   Recall=TP/(TP+FN),
                  Precision=TP/(TP+FP)
                   )</code></pre>
<button class="error R toggle btn btn-xs btn-danger">
<span class="glyphicon glyphicon-chevron-down"></span> R error
</button>
<pre style=""><code class="error r">## Error in mutate_(.data, .dots = lazyeval::lazy_dots(...)): object 'dci.table' not found
</code></pre>
</div>
<div class="row">
<button class="source R toggle btn btn-xs btn-primary">
<span class="glyphicon glyphicon-chevron-down"></span> R source
</button>
<pre style=""><code class="source r">ggplot(rbind(cbind(prec.table,Channel="Standard"),
             cbind(prec.dci.table,Channel="Edge Enhanced")),
             aes(x=Recall,y=Precision))+
  geom_point(aes(shape="Image"),size=5)+
  geom_point(data=data.frame(Recall=1,Precision=1),
             aes(shape="Ideal"),size=5,color="red")+
  geom_path(aes(group=Channel,color=Channel))+
  scale_y_sqrt()+
  labs(shape="")+
  
  theme_bw(20)</code></pre>
<button class="error R toggle btn btn-xs btn-danger">
<span class="glyphicon glyphicon-chevron-down"></span> R error
</button>
<pre style=""><code class="error r">## Error in cbind(prec.dci.table, Channel = "Edge Enhanced"): object 'prec.dci.table' not found
</code></pre>
</div>
<h1 id="other-image-types-1">Other Image Types</h1>
Going beyond vector the possibilities for images are limitless. The following shows a tensor plot with the tensor represented as an ellipse. <br /><span class="math display">$$ I(x,y) = \hat{f}(x,y) $$</span><br />
<div class="row">
<button class="source R toggle btn btn-xs btn-primary">
<span class="glyphicon glyphicon-chevron-down"></span> R source
</button>
<pre style=""><code class="source r">nx<-4
ny<-4
n.pi<-4
grad.im<-expand.grid(x=c(-nx:nx)/nx*n.pi*pi,
                     y=c(-ny:ny)/ny*n.pi*pi)

grad.im<-cbind(grad.im,
               col=1.5*with(grad.im,abs(cos(x*y))/(abs(x*y)+(3*pi/nx)))+
                 0.5*runif(nrow(grad.im)),
              a=with(grad.im,sqrt(2/(abs(x)+0.5))),
               b=with(grad.im,0.5*sqrt(abs(x)+1)),
              th=0.5*runif(nrow(grad.im)),
              aiso=1,count=1)

create.ellipse.points<-function(x.off=0,y.off=0,a=1,b=NULL,th.off=0,th.max=2*pi,pts=36,...) {
  if (is.null(b)) b<-a
  th<-seq(0,th.max,length.out=pts)
  data.frame(x=a*cos(th.off)*cos(th)+b*sin(th.off)*sin(th)+x.off,
             y=-1*a*sin(th.off)*cos(th)+b*cos(th.off)*sin(th)+y.off,
             id=as.factor(paste(x.off,y.off,a,b,th.off,pts,sep=":")),...)
}
deform.ellipse.draw<-function(c.box) {
  create.ellipse.points(x.off=c.box$x[1],
                        y.off=c.box$y[1],
                        a=c.box$a[1],
                        b=c.box$b[1],
                        th.off=c.box$th[1],
                        col=c.box$col[1])                    
}

# normalize vector
tens.im<-ddply(grad.im,.(x,y),deform.ellipse.draw)

ggplot(tens.im,aes(x=x,y=y,group=as.factor(id),fill=col))+
  geom_polygon(color="black")+coord_fixed(ratio=1)+scale_fill_gradient(low="black",high="white")+guides(fill=F)+
  theme_bw(20)</code></pre>
<div class="row">
<div class="col-md-offset-3 col-md-6">
<a href="#" class="thumbnail"><img src="print_figures/unnamed-chunk-47-1.png" title="" alt="" style="display: block; margin: auto;" /></a>
</div>
</div>
</div>
<p>Once the variable count is above 2, individual density functions and a series of cross plots are easier to interpret than some multidimensional density hypervolume.</p>
<hr />
<div class="row">
<button class="source R toggle btn btn-xs btn-primary">
<span class="glyphicon glyphicon-chevron-down"></span> R source
</button>
<pre style=""><code class="source r">ggplot(grad.im)+
  geom_histogram(aes(x=a,fill="Width"),alpha=0.7)+
  geom_histogram(aes(x=b,fill="Height"),alpha=0.7)+
  geom_histogram(aes(x=th,fill="Orientation"),alpha=0.7)+
  geom_histogram(aes(x=col,fill="Color"),alpha=0.7)+
  guides(color=F)+labs(fill="Variable")+
  theme_bw(15)</code></pre>
<div class="row">
<div class="col-md-offset-3 col-md-6">
<a href="#" class="thumbnail"><img src="print_figures/unnamed-chunk-48-1.png" title="Variable distributions" alt="Variable distributions" style="display: block; margin: auto;" /></a>
</div>
</div>
</div>
<div class="row">
<button class="source R toggle btn btn-xs btn-primary">
<span class="glyphicon glyphicon-chevron-down"></span> R source
</button>
<pre style=""><code class="source r">plot(grad.im[,c("a","b","th","col")])</code></pre>
<div class="row">
<div class="col-md-offset-3 col-md-6">
<a href="#" class="thumbnail"><img src="print_figures/unnamed-chunk-49-1.png" title="With Threshold Overlay" alt="With Threshold Overlay" style="display: block; margin: auto;" /></a>
</div>
</div>
</div>
<h1 id="multiple-phases-segmenting-shale">Multiple Phases: Segmenting Shale</h1>
<p>% Shale provided from Kanitpanyacharoen, W. (2012). Synchrotron X-ray Applications Toward an Understanding of Elastic Anisotropy.</p>
<ul>
<li>Here we have a shale sample measured with X-ray tomography with three different phases inside (clay, rock, and air).</li>
<li>The model is that because the chemical composition and density of each phase is different they will absorb different amounts of x-rays and appear as different brightnesses in the image
<div class="row">
<button class="source R toggle btn btn-xs btn-primary">
<span class="glyphicon glyphicon-chevron-down"></span> R source
</button>
<pre style=""><code class="source r">shaleImage<-im.to.df(jpeg::readJPEG("ext-figures/ShaleSample.jpg"))
ggplot(shaleImage,aes(x=x,y=y,fill=val))+
  geom_tile()+
  labs(fill="Absorption (au)")+theme_bw(20)</code></pre>
<div class="row">
<div class="col-md-offset-3 col-md-6">
<a href="#" class="thumbnail"><img src="print_figures/unnamed-chunk-50-1.png" title="Shale Sample" alt="Shale Sample" style="display: block; margin: auto;" /></a>
</div>
</div>
</div></li>
</ul>
<hr />
<p>Ideally we would derive 3 values for the thresholds based on a model for the composition of each phase and how much it absorbs, but that is not always possible or practical.</p>
<ul>
<li>While there are 3 phases clearly visible in the image, the histogram is less telling (even after being re-scaled).
<div class="row">
<div class="row">
<div class="col-md-offset-3 col-md-6">
<a href="#" class="thumbnail"><img src="print_figures/unnamed-chunk-51-1.png" title="plot of chunk unnamed-chunk-51" alt="plot of chunk unnamed-chunk-51" style="display: block; margin: auto;" /></a>
</div>
</div>
</div></li>
</ul>
<h1 id="multiple-segmentations">Multiple Segmentations</h1>
For this exercise we choose arbitrarily 3 ranges for the different phases and perform visual inspection
<div class="row">
<div class="row">
<div class="col-md-offset-3 col-md-6">
<a href="#" class="thumbnail"><img src="print_figures/unnamed-chunk-52-1.png" title="plot of chunk unnamed-chunk-52" alt="plot of chunk unnamed-chunk-52" style="display: block; margin: auto;" /></a>
</div>
</div>
</div>
<hr />
The relation can explicitly be written out as <br /><span class="math display">$$ I(x) = 
\begin{cases}
\text{Void}, &amp; 0 \leq x \leq 0.2  \\
\text{Clay}, &amp; 0.2 &lt; x \leq 0.5 \\
\text{Rock}, &amp; 0.5 &lt; x
\end{cases}$$</span><br />
<div class="row">
<button class="source R toggle btn btn-xs btn-primary">
<span class="glyphicon glyphicon-chevron-down"></span> R source
</button>
<pre style=""><code class="source r">ggplot(shale.vals,aes(x=x,y=y,fill=th.label,alpha=1-val))+coord_fixed(ratio=1)+
  geom_raster()+guides(fill=F,alpha=F)+theme_bw(20)+facet_wrap(~th.label)</code></pre>
<div class="row">
<div class="col-md-offset-3 col-md-6">
<a href="#" class="thumbnail"><img src="print_figures/unnamed-chunk-53-1.png" title="Segmented Images" alt="Segmented Images" style="display: block; margin: auto;" /></a>
</div>
</div>
</div>
<h1 id="implementation">Implementation</h1>
<p>The implementations of basic thresholds and segmentations is very easy since it is a unary operation of a single image <br /><span class="math display">$$ f(I(\vec{x})) $$</span><br /> In mathematical terms this is called a map and since it does not require information from neighboring voxels or images it can be calculated for each point independently (<em>parallel</em>). Filters on the other hand almost always depend on neighboring voxels and thus the calculations are not as easy to seperate.</p>
<h1 id="implementation-code">Implementation Code</h1>
<h3 id="matlab">Matlab</h3>
<p>The simplist is a single threshold in Matlab:</p>
<pre><code>thresh_img = gray_img &gt; thresh</code></pre>
<p>A more complicated threshold:</p>
<pre><code>thresh_img = (gray_img &gt; thresh_a) &amp; (gray_img &gt; thresh_b)</code></pre>
<h3 id="python-numpy">Python (numpy)</h3>
<pre><code>thresh_img = gray_img &gt; thresh</code></pre>
<h3 id="python">Python</h3>
<pre><code>thresh_img = map(lambda gray_val: gray_val&gt;thresh,
                gray_img)</code></pre>
<hr />
<h3 id="java">Java</h3>
<pre><code>boolean[] thresh_img = new boolean[x_size*y_size*z_size];
for(int x=x_min;x&lt;x_max;x++)
  for(int y=y_min;y&lt;y_max;y++)
    for(int z=z_min;z&lt;z_max;z++) {
      int offset=(z*y_size+y)*x_size+x;
      thresh_img[offset]=gray_img[offset]&gt;thresh;
    }</code></pre>
<h3 id="in-cc">In C/C++</h3>
<pre><code>bool* thresh_img = malloc(x_size*y_size*z_size * sizeof (bool));

for(int x=x_min;x&lt;x_max;x++)
  for(int y=y_min;y&lt;y_max;y++)
    for(int z=z_min;z&lt;z_max;z++) {
      int offset=(z*y_size+y)*x_size+x;
      thresh_img[offset]=gray_img[offset]&gt;thresh;
    }</code></pre>
<h1 id="pitfalls-with-segmentation">Pitfalls with Segmentation</h1>
<h3 id="partial-volume-effect">Partial Volume Effect</h3>
<ul>
<li>The <a href="http://bit.ly/1mW7kdP">partial volume effect</a> is the name for the effect of discretization on the image into pixels or voxels.</li>
<li>Surfaces are complicated, voxels are simple boxes which make poor representations</li>
<li>Many voxels are only partially filled, but only the voxels on the surface</li>
<li>Removing the first layer alleviates issue</li>
</ul>
<div class="row">
<button class="source R toggle btn btn-xs btn-primary">
<span class="glyphicon glyphicon-chevron-down"></span> R source
</button>
<pre style=""><code class="source r">make.circle<-function(nx,r,nscale=1,
                      circ.fun=function(x,y,r) ((x^2+y^2)<r^2)) {
  ny<-nx
  grad.im<-expand.grid(x=c(-nx:nx)/nscale,y=c(-ny:ny)/nscale)
  grad.im$val<-with(grad.im,circ.fun(x,y,r))
  grad.im$nx<-nx
  grad.im$r<-r
  grad.im
}
#' Simulates partial volume effect by binning a data-frame
#'
#' 
#'
#' @param count is the number of bins to create for the final image
#' ...
part.vol.circ<-function(in.im,bin.count=2) {
  ddply.cutcols(in.im,.(cut_interval(x,bin.count),cut_interval(y,bin.count)),
                function(c.df) data.frame(val=mean(c.df$val),
                                          r=c.df$r[1],
                                          nx=c.df$nx[1]),
                cols=2)
}
r.list<-seq(2,9.5,length.out=6)
sph.list<-ldply(r.list,function(r) part.vol.circ(make.circle(100,r,10),20))
ggplot(sph.list,aes(x=x,y=y,fill=val))+
  geom_raster()+facet_wrap(~r)+
  theme_bw(20)+guides(fill=F)</code></pre>
<div class="row">
<div class="col-md-offset-3 col-md-6">
<a href="#" class="thumbnail"><img src="print_figures/unnamed-chunk-54-1.png" title="Partial Volume Effect" alt="Partial Volume Effect" style="display: block; margin: auto;" /></a>
</div>
</div>
</div>
<hr />
<div class="row">
<button class="source R toggle btn btn-xs btn-primary">
<span class="glyphicon glyphicon-chevron-down"></span> R source
</button>
<pre style=""><code class="source r">binned.data<-
  ddply.cutcols(subset(sph.list,val<0.25),.(cut_interval(val,20),r),function(x) data.frame(count=nrow(x)))
# mutate(binned.data,ncount=ifelse(count>10,10,count)),
       aes(x=val)</code></pre>
<ul>
<li>x -&gt; val
<button class="source R toggle btn btn-xs btn-primary">
<span class="glyphicon glyphicon-chevron-down"></span> R source
</button>
<pre style=""><code class="source r">ggplot(subset(sph.list,val<0.25),aes(y=as.factor(r),x=val))+
  stat_bin2d(drop=T,bins=5)+
  scale_fill_gradientn(colours=rainbow(5),trans="sqrt",lim=c(0,25),na.value="purple")+
  theme_bw(20)+labs(x="Intensity",fill="Frequency",y="Radius")</code></pre>
<div class="row">
<div class="col-md-offset-3 col-md-6">
<a href="#" class="thumbnail"><img src="print_figures/unnamed-chunk-55-1.png" title="Partial Volume Effect" alt="Partial Volume Effect" style="display: block; margin: auto;" /></a>
</div>
</div>
</div></li>
<li>Shown as a function of radius</li>
</ul>
<div class="row">
<button class="source R toggle btn btn-xs btn-primary">
<span class="glyphicon glyphicon-chevron-down"></span> R source
</button>
<pre style=""><code class="source r">pve.table<-ddply(sph.list,.(r),function(c.rad.df) data.frame(m.int=mean(c.rad.df$val),
                                                             m.sd=sd(c.rad.df$val)
                                                             )
                 )
names(pve.table)<-c("Radius","Mean Intensity","Sd Intensity")
kable(pve.table)</code></pre>
<table>
<thead>
<tr class="header">
<th align="right">Radius</th>
<th align="right">Mean Intensity</th>
<th align="right">Sd Intensity</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">2.0</td>
<td align="right">0.0311250</td>
<td align="right">0.1623387</td>
</tr>
<tr class="even">
<td align="right">3.5</td>
<td align="right">0.0960250</td>
<td align="right">0.2770132</td>
</tr>
<tr class="odd">
<td align="right">5.0</td>
<td align="right">0.1956250</td>
<td align="right">0.3825768</td>
</tr>
<tr class="even">
<td align="right">6.5</td>
<td align="right">0.3311250</td>
<td align="right">0.4510394</td>
</tr>
<tr class="odd">
<td align="right">8.0</td>
<td align="right">0.5017250</td>
<td align="right">0.4819382</td>
</tr>
<tr class="even">
<td align="right">9.5</td>
<td align="right">0.7072841</td>
<td align="right">0.4258651</td>
</tr>
</tbody>
</table>
</div>
<h1 id="morphology">Morphology</h1>
Returning to the original image of a cross
<div class="row">
<button class="source R toggle btn btn-xs btn-primary">
<span class="glyphicon glyphicon-chevron-down"></span> R source
</button>
<pre style=""><code class="source r">nx<-8
ny<-8
cross.im<-expand.grid(x=c(-nx:nx)/nx*2*pi,y=c(-ny:ny)/ny*2*pi)
cross.im<-cbind(cross.im,
               col=with(cross.im,1.5*((abs(x)<2) | (abs(y)<2))+
                 0.5*runif(nrow(cross.im))))
thresh.val<-0.75
cross.im$val<-(cross.im$col>=thresh.val)
ggplot(cross.im,aes(x=x,y=y))+
  geom_tile(aes(fill=col))+
  geom_tile(data=subset(cross.im,val),fill="red",color="black",alpha=0.3)+
  geom_tile(data=subset(cross.im,!val),fill="blue",color="black",alpha=0.3)+
  scale_fill_gradient(low="black",high="white")+
  labs(fill="Intensity")+
  theme_bw(20)</code></pre>
<div class="row">
<div class="col-md-offset-3 col-md-6">
<a href="#" class="thumbnail"><img src="print_figures/unnamed-chunk-57-1.png" title="Cross With Threshold Overlay" alt="Cross With Threshold Overlay" style="display: block; margin: auto;" /></a>
</div>
</div>
</div>
<p>We can now utilize information from neighborhood voxels to improve the results. These steps are called morphological operations. *** Like filtering the assumption behind morphological operations are</p>
<ul>
<li>nearby voxels in <strong>real</strong> images are related / strongly correlated with one another</li>
<li>noise and imaging artifacts are less spatially correlated.</li>
</ul>
<p>Therefore these imaging problems can be alleviated by adjusting the balance between local and neighborhood values.</p>
<h1 id="fundamentals-neighborhood">Fundamentals: Neighborhood</h1>
<p>A neighborhood consists of the pixels or voxels which are of sufficient proximity to a given point. There are a number of possible definitions which largely affect the result when it is invoked.</p>
<ul>
<li>A large neighborhood performs operations over larger areas / volumes</li>
<li>Computationally intensive</li>
<li>Can <em>smooth</em> out features</li>
<li>A small neighborhood performs operations over small areas / volumes</li>
<li>Computationally cheaper</li>
<li>Struggles with large noise / filling large holes</li>
</ul>
<hr />
<p>The neighborhood is important for a large number of image and other (communication, mapping, networking) processing operations:</p>
<ul>
<li>filtering</li>
<li>morphological operations</li>
<li>component labeling</li>
<li>distance maps</li>
<li>image correlation based tracking methods</li>
</ul>
<h1 id="fundamentals-neighbors-in-2d">Fundamentals: Neighbors in 2D</h1>
For standard image operations there are two definitions of neighborhood. The 4 and 8 adjacent neighbors shown below. Given the blue pixel in the center the red are the 4-adjacent and the red and green make up the 8 adjacent.
<div class="row">
<button class="source R toggle btn btn-xs btn-primary">
<span class="glyphicon glyphicon-chevron-down"></span> R source
</button>
<pre style=""><code class="source r">morph.2d<-expand.grid(x=c(-1,0,1),y=c(-1,0,1))
morph.2d$r<-with(morph.2d,sqrt(x^2+y^2))

ggplot(morph.2d,aes(x=x,y=y))+
  geom_tile(color="black",
            aes(fill=ifelse(r==0,"Pixel of Interest",
                                   ifelse(r==1,"4-Adjacent","8-Adjacent")))
            )+
  geom_text(aes(label=3*(y+1)+x+1))+
  labs(fill="Pixel Type")+
  theme_bw(20)</code></pre>
<div class="row">
<div class="col-md-offset-3 col-md-6">
<a href="#" class="thumbnail"><img src="print_figures/unnamed-chunk-58-1.png" title="" alt="" style="display: block; margin: auto;" /></a>
</div>
</div>
</div>
<h1 id="formal-neighborhood-definitions">Formal Neighborhood Definitions</h1>
<p>Formally these have two effectively equivalent, but different definitions.</p>
<ul>
<li>Pixels which share a face (red line) with the pixel</li>
<li>Pixels which share a vertex (yellow dot) with the pixel</li>
</ul>
<div class="row">
<button class="source R toggle btn btn-xs btn-primary">
<span class="glyphicon glyphicon-chevron-down"></span> R source
</button>
<pre style=""><code class="source r">cent.pix<-data.frame(x=c(-1, 1,1,-1,-1)/2,
                     y=c(-1,-1,1, 1,-1)/2)
ggplot(morph.2d,aes(x=x,y=y))+
  geom_tile(color="black",size=1,alpha=0.7,
            aes(fill=ifelse(r==0,"Pixel of Interest",
                                   ifelse(r==1,"4-Adjacent","8-Adjacent")))
            )+
  geom_path(data=cent.pix,color="red",size=3)+
  geom_point(data=cent.pix,color="yellow",size=5)+
  geom_text(aes(label=3*(y+1)+x+1))+
  labs(fill="Pixel Type")+
  theme_bw(20)</code></pre>
<div class="row">
<div class="col-md-offset-3 col-md-6">
<a href="#" class="thumbnail"><img src="print_figures/unnamed-chunk-59-1.png" title="" alt="" style="display: block; margin: auto;" /></a>
</div>
</div>
</div>
<hr />
<ul>
<li>Pixels which are distance 1 from the pixel</li>
<li>Pixels which are distance <span class="math inline">$\sqrt{2}$</span> from the pixel
<div class="row">
<button class="source R toggle btn btn-xs btn-primary">
<span class="glyphicon glyphicon-chevron-down"></span> R source
</button>
<pre style=""><code class="source r">morph.2d<-expand.grid(x=c(-1,0,1),y=c(-1,0,1))
morph.2d$r<-with(morph.2d,sqrt(x^2+y^2))
ggplot(morph.2d,aes(x=x,y=y))+
  geom_tile(color="black",
        aes(fill=ifelse(r==0,"Pixel of Interest",
                               ifelse(r==1,"4-Adjacent","8-Adjacent")))
        )+
  geom_text(aes(label=round(r*100)/100))+
  labs(fill="Pixel Type")+
  theme_bw(20)</code></pre>
<div class="row">
<div class="col-md-offset-3 col-md-6">
<a href="#" class="thumbnail"><img src="print_figures/unnamed-chunk-60-1.png" title="" alt="" style="display: block; margin: auto;" /></a>
</div>
</div>
</div></li>
</ul>
<h1 id="formal-neighborhood-definitions-in-3d">Formal Neighborhood Definitions in 3D</h1>
<p>In 3D there is now an additional group to consider because of the extra-dimension</p>
<ul>
<li>Voxels which share a face (red line) with the voxel (6-adjacent)</li>
<li>Voxels which share an edge (yellow dot) with the voxel (18-adjacent)</li>
<li>Voxels which share a vertex (purple dot) with the voxel (26-adjacent)</li>
</ul>
<div class="row">
<button class="source R toggle btn btn-xs btn-primary">
<span class="glyphicon glyphicon-chevron-down"></span> R source
</button>
<pre style=""><code class="source r">morph.3d<-expand.grid(x=c(-1,0,1),y=c(-1,0,1),z=c(-1,0,1))
morph.3d$r<-with(morph.3d,sqrt(x^2+y^2+z^2))

cent.pix.3d<-data.frame(x=c(-1, 1,1,-1,-1,-1, 1,1,-1,-1)/2,
                     y=c(-1,-1,1, 1,-1,-1,-1,1, 1,-1)/2,
                     z=c(-1,-1,-1,-1,-1,1, 1,1, 1, 1))
face.pix.3d<-data.frame(x=c(-1, 1, 1,-1,-1)/2,
                        y=c(-1,-1, 1, 1,-1)/2,
                        z=c( 0, 0, 0, 0, 0))
pixel.label<-function(r) ifelse(r==0,"Pixel of Interest",
                                   ifelse(r==1," 6-Adjacent",
                                          ifelse(r==sqrt(2),"18-Adjacent","26-Adjacent")))
ggplot(morph.3d,aes(x=x,y=y))+
  geom_tile(color="black",size=1,alpha=0.7,
            aes(fill=pixel.label(r))
            )+
  geom_path(data=cent.pix.3d,color="yellow",size=3)+
  geom_point(data=cent.pix.3d,color="purple",size=5)+
  geom_path(data=face.pix.3d,color="red",size=3)+
  geom_point(data=face.pix.3d,color="yellow",size=5)+
  geom_text(aes(label=9*(z+1)+3*(y+1)+x+1))+
  facet_grid(~z)+
  labs(fill="Pixel Type")+
  theme_bw(20)</code></pre>
<div class="row">
<div class="col-md-offset-3 col-md-6">
<a href="#" class="thumbnail"><img src="print_figures/unnamed-chunk-61-1.png" title="" alt="" style="display: block; margin: auto;" /></a>
</div>
</div>
</div>
<hr />
<ul>
<li>Voxels which are distance 1 from the voxel</li>
<li>Voxels which are distance <span class="math inline">$\sqrt{2}$</span> from the voxel</li>
<li>Voxels which are distance <span class="math inline">$\sqrt{3}$</span> from the voxel
<div class="row">
<button class="source R toggle btn btn-xs btn-primary">
<span class="glyphicon glyphicon-chevron-down"></span> R source
</button>
<pre style=""><code class="source r">ggplot(morph.3d,aes(x=x,y=y))+
  geom_tile(color="black",size=1,
        aes(fill=pixel.label(r))
        )+
  geom_text(aes(label=round(r*100)/100))+
  facet_grid(~z)+
  labs(fill="Pixel Type")+
  theme_bw(14)</code></pre>
<div class="row">
<div class="col-md-offset-3 col-md-6">
<a href="#" class="thumbnail"><img src="print_figures/unnamed-chunk-62-1.png" title="" alt="" style="display: block; margin: auto;" /></a>
</div>
</div>
</div></li>
</ul>
<h1 id="erosion-and-dilation">Erosion and Dilation</h1>
<h3 id="erosion">Erosion</h3>
<p>If any of the voxels in the neighborhood are 0/false than the voxel will be set to 0</p>
<ul>
<li>Has the effect of peeling the surface layer off of an object</li>
</ul>
<hr />
<h3 id="dilation">Dilation</h3>
<p>If any of the voxels in the neigbhorhood are 1/true then the voxel will be set to 1</p>
<ul>
<li>Has the effect of adding a layer onto an object (dunking an strawberry in chocolate, adding a coat of paint to a car)</li>
</ul>
<h1 id="applied-erosion-and-dilation">Applied Erosion and Dilation</h1>
<h3 id="dilation-1">Dilation</h3>
Taking an image of the cross at a too-high threshold, we show how dilation can be used to recover some of the missing pixels
<div class="row">
<button class="source R toggle btn btn-xs btn-primary">
<span class="glyphicon glyphicon-chevron-down"></span> R source
</button>
<pre style=""><code class="source r">cross.im$thresh<-cross.im$col>1.75

cross.mat<-df.to.im(cross.im,"thresh",inv=T)
cross.df<-im.to.df(cross.mat)
ggplot(cross.df,aes(x=x,y=y))+
  geom_tile(data=subset(cross.df,val==0),aes(fill="original"),color="black",alpha=0.7)+
  labs(fill="Type")+
  theme_bw(20)</code></pre>
<div class="row">
<div class="col-md-offset-3 col-md-6">
<a href="#" class="thumbnail"><img src="print_figures/unnamed-chunk-63-1.png" title="Dilation Example" alt="Dilation Example" style="display: block; margin: auto;" /></a>
</div>
</div>
</div>
<div class="row">
<button class="source R toggle btn btn-xs btn-primary">
<span class="glyphicon glyphicon-chevron-down"></span> R source
</button>
<pre style=""><code class="source r">cross.dil.mat<-imgStdBinaryDilation(cross.mat)</code></pre>
<button class="error R toggle btn btn-xs btn-danger">
<span class="glyphicon glyphicon-chevron-down"></span> R error
</button>
<pre style=""><code class="error r">## Error in eval(expr, envir, enclos): could not find function "imgStdBinaryDilation"
</code></pre>
<button class="source R toggle btn btn-xs btn-primary">
<span class="glyphicon glyphicon-chevron-down"></span> R source
</button>
<pre style=""><code class="source r">cross.dil.df<-im.to.df(cross.dil.mat)</code></pre>
<button class="error R toggle btn btn-xs btn-danger">
<span class="glyphicon glyphicon-chevron-down"></span> R error
</button>
<pre style=""><code class="error r">## Error in nrow(in.img): object 'cross.dil.mat' not found
</code></pre>
<button class="source R toggle btn btn-xs btn-primary">
<span class="glyphicon glyphicon-chevron-down"></span> R source
</button>
<pre style=""><code class="source r">ggplot(cross.df,aes(x=x,y=y))+
  geom_tile(data=subset(cross.df,val==0),aes(fill="original"),color="black",alpha=0.7)+
  geom_tile(data=subset(cross.dil.df,val==0),aes(fill="post dilation"),color="black",alpha=0.3)+
  labs(fill="Type")+
  theme_bw(20)</code></pre>
<button class="error R toggle btn btn-xs btn-danger">
<span class="glyphicon glyphicon-chevron-down"></span> R error
</button>
<pre style=""><code class="error r">## Error in subset(cross.dil.df, val == 0): object 'cross.dil.df' not found
</code></pre>
</div>
<hr />
<h3 id="erosion-1">Erosion</h3>
Taking an image of the cross at a too-low threshold, we show how erosion can be used to remove some of the extra pixels
<div class="row">
<button class="source R toggle btn btn-xs btn-primary">
<span class="glyphicon glyphicon-chevron-down"></span> R source
</button>
<pre style=""><code class="source r">cross.im$thresh<-cross.im$col>0.4
cross.mat<-df.to.im(cross.im,"thresh",inv=T)
cross.df<-im.to.df(cross.mat)
ggplot(cross.df,aes(x=x,y=y))+
  geom_tile(data=subset(cross.df,val==0),aes(fill="original"),color="black",alpha=0.7)+
  labs(fill="Type")+
  theme_bw(20)</code></pre>
<div class="row">
<div class="col-md-offset-3 col-md-6">
<a href="#" class="thumbnail"><img src="print_figures/unnamed-chunk-65-1.png" title="Erosion Example" alt="Erosion Example" style="display: block; margin: auto;" /></a>
</div>
</div>
</div>
<div class="row">
<button class="source R toggle btn btn-xs btn-primary">
<span class="glyphicon glyphicon-chevron-down"></span> R source
</button>
<pre style=""><code class="source r">cross.ero.mat<-imgStdBinaryErosion(cross.mat)</code></pre>
<button class="error R toggle btn btn-xs btn-danger">
<span class="glyphicon glyphicon-chevron-down"></span> R error
</button>
<pre style=""><code class="error r">## Error in eval(expr, envir, enclos): could not find function "imgStdBinaryErosion"
</code></pre>
<button class="source R toggle btn btn-xs btn-primary">
<span class="glyphicon glyphicon-chevron-down"></span> R source
</button>
<pre style=""><code class="source r">cross.ero.df<-im.to.df(cross.ero.mat)</code></pre>
<button class="error R toggle btn btn-xs btn-danger">
<span class="glyphicon glyphicon-chevron-down"></span> R error
</button>
<pre style=""><code class="error r">## Error in nrow(in.img): object 'cross.ero.mat' not found
</code></pre>
<button class="source R toggle btn btn-xs btn-primary">
<span class="glyphicon glyphicon-chevron-down"></span> R source
</button>
<pre style=""><code class="source r">ggplot(cross.df,aes(x=x,y=y))+
  geom_tile(data=subset(cross.df,val==0),aes(fill="original"),color="black",alpha=0.7)+
  geom_tile(data=subset(cross.ero.df,val==0),aes(fill="post erosion"),color="black",alpha=0.3)+
  labs(fill="Type")+
  theme_bw(20)</code></pre>
<button class="error R toggle btn btn-xs btn-danger">
<span class="glyphicon glyphicon-chevron-down"></span> R error
</button>
<pre style=""><code class="error r">## Error in subset(cross.ero.df, val == 0): object 'cross.ero.df' not found
</code></pre>
</div>
<h1 id="opening-and-closing">Opening and Closing</h1>
<h3 id="opening">Opening</h3>
<p>An erosion followed by a dilation operation</p>
<ul>
<li>Peels a layer off and adds a layer on</li>
<li>Very small objects and connections are deleted in the erosion and do not return the image is thus __open__ed</li>
<li>A cube larger than several voxels will have the exact same volume after (conservative)</li>
</ul>
<hr />
<h3 id="closing">Closing</h3>
<p>A dilation followed by an erosion operation</p>
<ul>
<li>Adds a layer and then peels a layer off</li>
<li>Objects that are very close are connected when the layer is added and they stay connected when the layer is removed thus the image is __close__d</li>
<li>A cube larger than one voxel will have the exact same volume after (conservative)</li>
</ul>
<h1 id="applied-opening-and-closing">Applied Opening and Closing</h1>
<h3 id="opening-1">Opening</h3>
Taking an image of the cross at a too-low threshold, we show how opening can be used to remove some of the extra pixels
<div class="row">
<button class="source R toggle btn btn-xs btn-primary">
<span class="glyphicon glyphicon-chevron-down"></span> R source
</button>
<pre style=""><code class="source r">cross.im$thresh<-cross.im$col>0.4
cross.mat<-df.to.im(cross.im,"thresh",inv=T)
cross.df<-im.to.df(cross.mat)
ggplot(cross.df,aes(x=x,y=y))+
  geom_tile(data=subset(cross.df,val==0),aes(fill="original"),color="black",alpha=0.7)+
  labs(fill="Type")+
  theme_bw(20)</code></pre>
<div class="row">
<div class="col-md-offset-3 col-md-6">
<a href="#" class="thumbnail"><img src="print_figures/unnamed-chunk-67-1.png" title="Erosion Example" alt="Erosion Example" style="display: block; margin: auto;" /></a>
</div>
</div>
</div>
<div class="row">
<button class="source R toggle btn btn-xs btn-primary">
<span class="glyphicon glyphicon-chevron-down"></span> R source
</button>
<pre style=""><code class="source r">cross.ero.mat<-imgStdBinaryOpening(cross.mat)</code></pre>
<button class="error R toggle btn btn-xs btn-danger">
<span class="glyphicon glyphicon-chevron-down"></span> R error
</button>
<pre style=""><code class="error r">## Error in eval(expr, envir, enclos): could not find function "imgStdBinaryOpening"
</code></pre>
<button class="source R toggle btn btn-xs btn-primary">
<span class="glyphicon glyphicon-chevron-down"></span> R source
</button>
<pre style=""><code class="source r">cross.ero.df<-im.to.df(cross.ero.mat)</code></pre>
<button class="error R toggle btn btn-xs btn-danger">
<span class="glyphicon glyphicon-chevron-down"></span> R error
</button>
<pre style=""><code class="error r">## Error in nrow(in.img): object 'cross.ero.mat' not found
</code></pre>
<button class="source R toggle btn btn-xs btn-primary">
<span class="glyphicon glyphicon-chevron-down"></span> R source
</button>
<pre style=""><code class="source r">ggplot(cross.df,aes(x=x,y=y))+
  geom_tile(data=subset(cross.df,val==0),aes(fill="original"),color="black",alpha=0.7)+
  geom_tile(data=subset(cross.ero.df,val==0),aes(fill="post opening"),color="black",alpha=0.3)+
  labs(fill="Type")+
  theme_bw(20)</code></pre>
<button class="error R toggle btn btn-xs btn-danger">
<span class="glyphicon glyphicon-chevron-down"></span> R error
</button>
<pre style=""><code class="error r">## Error in subset(cross.ero.df, val == 0): object 'cross.ero.df' not found
</code></pre>
</div>
<hr />
<h3 id="closing-1">Closing</h3>
Taking an image of the cross at a too-high threshold, we show how closing can be used to recover some of the missing pixels
<div class="row">
<button class="source R toggle btn btn-xs btn-primary">
<span class="glyphicon glyphicon-chevron-down"></span> R source
</button>
<pre style=""><code class="source r">cross.im$thresh<-cross.im$col>1.75

cross.mat<-df.to.im(cross.im,"thresh",inv=T)
cross.df<-im.to.df(cross.mat)
ggplot(cross.df,aes(x=x,y=y))+
  geom_tile(data=subset(cross.df,val==0),aes(fill="original"),color="black",alpha=0.7)+
  labs(fill="Type")+
  theme_bw(20)</code></pre>
<div class="row">
<div class="col-md-offset-3 col-md-6">
<a href="#" class="thumbnail"><img src="print_figures/unnamed-chunk-69-1.png" title="Dilation Example" alt="Dilation Example" style="display: block; margin: auto;" /></a>
</div>
</div>
</div>
<div class="row">
<button class="source R toggle btn btn-xs btn-primary">
<span class="glyphicon glyphicon-chevron-down"></span> R source
</button>
<pre style=""><code class="source r">cross.dil.mat<-imgStdBinaryClosing(cross.mat)</code></pre>
<button class="error R toggle btn btn-xs btn-danger">
<span class="glyphicon glyphicon-chevron-down"></span> R error
</button>
<pre style=""><code class="error r">## Error in eval(expr, envir, enclos): could not find function "imgStdBinaryClosing"
</code></pre>
<button class="source R toggle btn btn-xs btn-primary">
<span class="glyphicon glyphicon-chevron-down"></span> R source
</button>
<pre style=""><code class="source r">cross.dil.df<-im.to.df(cross.dil.mat)</code></pre>
<button class="error R toggle btn btn-xs btn-danger">
<span class="glyphicon glyphicon-chevron-down"></span> R error
</button>
<pre style=""><code class="error r">## Error in nrow(in.img): object 'cross.dil.mat' not found
</code></pre>
<button class="source R toggle btn btn-xs btn-primary">
<span class="glyphicon glyphicon-chevron-down"></span> R source
</button>
<pre style=""><code class="source r">ggplot(cross.df,aes(x=x,y=y))+
  geom_tile(data=subset(cross.df,val==0),aes(fill="original"),color="black",alpha=0.7)+
  geom_tile(data=subset(cross.dil.df,val==0),aes(fill="post closing"),color="black",alpha=0.3)+
  labs(fill="Type")+
  theme_bw(20)</code></pre>
<button class="error R toggle btn btn-xs btn-danger">
<span class="glyphicon glyphicon-chevron-down"></span> R error
</button>
<pre style=""><code class="error r">## Error in subset(cross.dil.df, val == 0): object 'cross.dil.df' not found
</code></pre>
</div>
<h1 id="applying-morphological-tools">Applying Morphological Tools</h1>
<ul>
<li>For many applications morphology appears to be the same as filter</li>
<li>The key difference is the avalanche or non-linear nature of the results</li>
<li>A single off voxel can turn its entire neighborhood off (erosion)</li>
<li>A single on voxel can turn its entire neighborhood on (dilation)</li>
<li>The effects of this are most pronounced when performed iteratively</li>
<li>This is very useful for filling holes, connecting objects, creating masks</li>
</ul>
<hr />
<p>A segmented slice taken from a cortical bone sample. The dark is the calcified bone tissue and the white are holes in the image</p>
<p><img src="ext-figures/bone.png" alt="Bone Slice" /></p>
<h1 id="filling-holes-creating-masks">Filling Holes / Creating Masks</h1>
<div class="row">
<button class="source R toggle btn btn-xs btn-primary">
<span class="glyphicon glyphicon-chevron-down"></span> R source
</button>
<pre style=""><code class="source r">cortbone.im<-imagedata(t(png::readPNG("ext-figures/bone.png")),"grey")</code></pre>
<button class="error R toggle btn btn-xs btn-danger">
<span class="glyphicon glyphicon-chevron-down"></span> R error
</button>
<pre style=""><code class="error r">## Error in eval(expr, envir, enclos): could not find function "imagedata"
</code></pre>
<button class="source R toggle btn btn-xs btn-primary">
<span class="glyphicon glyphicon-chevron-down"></span> R source
</button>
<pre style=""><code class="source r">cortbone.df<-im.to.df(cortbone.im)</code></pre>
<button class="error R toggle btn btn-xs btn-danger">
<span class="glyphicon glyphicon-chevron-down"></span> R error
</button>
<pre style=""><code class="error r">## Error in nrow(in.img): object 'cortbone.im' not found
</code></pre>
<button class="source R toggle btn btn-xs btn-primary">
<span class="glyphicon glyphicon-chevron-down"></span> R source
</button>
<pre style=""><code class="source r">#cortbone.df$val<-255*(cortbone.df$val>0.5)
cortbone.close.im<-imgStdBinaryClosing(cortbone.im)</code></pre>
<button class="error R toggle btn btn-xs btn-danger">
<span class="glyphicon glyphicon-chevron-down"></span> R error
</button>
<pre style=""><code class="error r">## Error in eval(expr, envir, enclos): could not find function "imgStdBinaryClosing"
</code></pre>
<button class="source R toggle btn btn-xs btn-primary">
<span class="glyphicon glyphicon-chevron-down"></span> R source
</button>
<pre style=""><code class="source r">ggplot(subset(cortbone.df,val<1),aes(x=x,y=518-y))+
  geom_raster(data=subset(im.to.df(cortbone.close.im),val<1),
              aes(fill="closing 3x3"),alpha=0.8)+
  geom_raster(aes(fill="before closing"),alpha=0.6)+
  labs(fill="Image",y="y",x="x",title="3x3 Closing")+
  coord_equal()+
  theme_bw(20)</code></pre>
<button class="error R toggle btn btn-xs btn-danger">
<span class="glyphicon glyphicon-chevron-down"></span> R error
</button>
<pre style=""><code class="error r">## Error in subset(cortbone.df, val < 1): object 'cortbone.df' not found
</code></pre>
</div>
<hr />
<div class="row">
<button class="source R toggle btn btn-xs btn-primary">
<span class="glyphicon glyphicon-chevron-down"></span> R source
</button>
<pre style=""><code class="source r">cortbone.close.im<-imgStdBinaryClosing(cortbone.im,dim=7)</code></pre>
<button class="error R toggle btn btn-xs btn-danger">
<span class="glyphicon glyphicon-chevron-down"></span> R error
</button>
<pre style=""><code class="error r">## Error in eval(expr, envir, enclos): could not find function "imgStdBinaryClosing"
</code></pre>
<button class="source R toggle btn btn-xs btn-primary">
<span class="glyphicon glyphicon-chevron-down"></span> R source
</button>
<pre style=""><code class="source r">ggplot(subset(cortbone.df,val<1),aes(x=x,y=600-y))+
  geom_raster(data=subset(im.to.df(cortbone.close.im),val<1),
              aes(fill="closing 7x7"),alpha=0.8)+
  geom_raster(aes(fill="before closing"),alpha=0.6)+
  labs(fill="Image",y="y",x="x",title="7x7 Closing")+
  coord_equal()+
  theme_bw(20)</code></pre>
<button class="error R toggle btn btn-xs btn-danger">
<span class="glyphicon glyphicon-chevron-down"></span> R error
</button>
<pre style=""><code class="error r">## Error in subset(cortbone.df, val < 1): object 'cortbone.df' not found
</code></pre>
</div>
<h1 id="filling-holes-creating-masks-1">Filling Holes / Creating Masks</h1>
<p>Applying the closing with even larger windows will close everything but being to destroy the underlying structure of the mask</p>
<div class="row">
<button class="source R toggle btn btn-xs btn-primary">
<span class="glyphicon glyphicon-chevron-down"></span> R source
</button>
<pre style=""><code class="source r">full.kernel<-makeBrush(45,"box")
cortbone.close.im<-closing(cortbone.im<1,full.kernel)</code></pre>
<button class="error R toggle btn btn-xs btn-danger">
<span class="glyphicon glyphicon-chevron-down"></span> R error
</button>
<pre style=""><code class="error r">## Error in is(y, "Image"): object 'cortbone.im' not found
</code></pre>
<button class="source R toggle btn btn-xs btn-primary">
<span class="glyphicon glyphicon-chevron-down"></span> R source
</button>
<pre style=""><code class="source r">ggplot(subset(cortbone.df,val<1),aes(x=x,y=600-y))+
  geom_raster(data=subset(im.to.df(cortbone.close.im),val>0),
              aes(fill="closing 45x45"),alpha=0.8)+
  geom_raster(aes(fill="before closing"),alpha=0.6)+
  labs(fill="Image",y="x",x="y",title="45x45 Closing")+
  coord_equal()+
  theme_bw(20)</code></pre>
<button class="error R toggle btn btn-xs btn-danger">
<span class="glyphicon glyphicon-chevron-down"></span> R error
</button>
<pre style=""><code class="error r">## Error in subset(cortbone.df, val < 1): object 'cortbone.df' not found
</code></pre>
</div>
<hr />
<p>We can characterize this by examining the dependency of the closing size and the volume fraction (note scale)</p>
<div class="row">
<button class="source R toggle btn btn-xs btn-primary">
<span class="glyphicon glyphicon-chevron-down"></span> R source
</button>
<pre style=""><code class="source r">get.vf<-function(img) (100*sum(img>0)/
               (nrow(cortbone.im)*ncol(cortbone.im)))
vf.of.closing<-function(dim.size) {
  data.frame(dim.size=dim.size,
             vf.full=get.vf(closing(cortbone.im<1,makeBrush(dim.size,"box" )))
             )
  }
pt.list<-c(seq(1,10),seq(11,40,2))
vf.df<-ldply(pt.list,vf.of.closing,.parallel=T)</code></pre>
<button class="error R toggle btn btn-xs btn-danger">
<span class="glyphicon glyphicon-chevron-down"></span> R error
</button>
<pre style=""><code class="error r">## Error in do.ply(i): task 1 failed - "object 'cortbone.im' not found"
</code></pre>
<button class="source R toggle btn btn-xs btn-primary">
<span class="glyphicon glyphicon-chevron-down"></span> R source
</button>
<pre style=""><code class="source r">ggplot(vf.df,aes(x=dim.size))+
  geom_line(aes(y=vf.full))+
  labs(fill="Image",y="Bone Volume Frac(%)",x="Closing Size",title="Closing Size vs Volume Fraction")+
  theme_bw(15)</code></pre>
<button class="error R toggle btn btn-xs btn-danger">
<span class="glyphicon glyphicon-chevron-down"></span> R error
</button>
<pre style=""><code class="error r">## Error in ggplot(vf.df, aes(x = dim.size)): object 'vf.df' not found
</code></pre>
</div>
<ul>
<li>Be careful when using large area opening / closing operations (always check the images)</li>
<li>Noise and defects in images can be amplified with these larger operations</li>
</ul>
<h1 id="different-kernels">Different Kernels</h1>
<p>Using a better kernel shape (circular, diamond shaped, etc) the artifacts from morphological operations can be reduced</p>
<div class="row">
<button class="source R toggle btn btn-xs btn-primary">
<span class="glyphicon glyphicon-chevron-down"></span> R source
</button>
<pre style=""><code class="source r">disc.kernel<-makeBrush(45,"disc")
cortbone.close.im<-closing(cortbone.im<1,disc.kernel)</code></pre>
<button class="error R toggle btn btn-xs btn-danger">
<span class="glyphicon glyphicon-chevron-down"></span> R error
</button>
<pre style=""><code class="error r">## Error in is(y, "Image"): object 'cortbone.im' not found
</code></pre>
<button class="source R toggle btn btn-xs btn-primary">
<span class="glyphicon glyphicon-chevron-down"></span> R source
</button>
<pre style=""><code class="source r">ggplot(subset(cortbone.df,val<1),aes(x=x,y=600-y))+
  geom_raster(data=subset(im.to.df(cortbone.close.im),val>0),
              aes(fill="closing 45x45"),alpha=0.8)+
  geom_raster(aes(fill="before closing"),alpha=0.6)+
  labs(fill="Image",y="x",x="y",title="45x45 Closing")+
  coord_equal()+
  theme_bw(20)</code></pre>
<button class="error R toggle btn btn-xs btn-danger">
<span class="glyphicon glyphicon-chevron-down"></span> R error
</button>
<pre style=""><code class="error r">## Error in subset(cortbone.df, val < 1): object 'cortbone.df' not found
</code></pre>
</div>
<hr />
<p>We can characterize this by examining the dependency of the closing size and the volume fraction (note scale)</p>
<div class="row">
<button class="source R toggle btn btn-xs btn-primary">
<span class="glyphicon glyphicon-chevron-down"></span> R source
</button>
<pre style=""><code class="source r">get.vf<-function(img) (100*sum(img>0)/
               (nrow(cortbone.im)*ncol(cortbone.im)))
vf.of.closing<-function(dim.size) {
  data.frame(dim.size=dim.size,
             vf.full=get.vf(closing(cortbone.im<1,makeBrush(dim.size,"box" ))),
             vf.disc=get.vf(closing(cortbone.im<1,makeBrush(dim.size,"disc"))),
             vf.diam=get.vf(closing(cortbone.im<1,makeBrush(dim.size,"diamond"))),
             vf.vline=get.vf(closing(cortbone.im<1,makeBrush(dim.size,"line",angle=0))),
             vf.hline=get.vf(closing(cortbone.im<1,makeBrush(dim.size,"line",angle=90)))
             )
  }
pt.list<-c(seq(1,9,2),seq(11,60,4))
vf.df<-ldply(pt.list,vf.of.closing,.parallel=T)</code></pre>
<button class="error R toggle btn btn-xs btn-danger">
<span class="glyphicon glyphicon-chevron-down"></span> R error
</button>
<pre style=""><code class="error r">## Error in do.ply(i): task 1 failed - "object 'cortbone.im' not found"
</code></pre>
<button class="source R toggle btn btn-xs btn-primary">
<span class="glyphicon glyphicon-chevron-down"></span> R source
</button>
<pre style=""><code class="source r">ggplot(vf.df,aes(x=dim.size))+
  geom_line(aes(y=vf.full,color="Full"))+
  geom_line(aes(y=vf.disc,color="Circular"))+
  geom_line(aes(y=vf.diam,color="Diamond-Shape"))+
  geom_line(aes(y=vf.vline,color="Vertical Line"))+
  geom_line(aes(y=vf.hline,color="Horizontal Line"))+
  labs(color="Kernel Used",y="Bone Volume Fraction (%)",x="Closing Size",title="Closing Size vs Volume Fraction")+
  theme_bw(20)</code></pre>
<button class="error R toggle btn btn-xs btn-danger">
<span class="glyphicon glyphicon-chevron-down"></span> R error
</button>
<pre style=""><code class="error r">## Error in ggplot(vf.df, aes(x = dim.size)): object 'vf.df' not found
</code></pre>
</div>
<ul>
<li>Alternative techniques</li>
<li><a href="http://en.wikipedia.org/wiki/Convex_hull">Convex Hull</a> - assuming convex shapes</li>
<li><a href="http://en.wikipedia.org/wiki/Flood_fill">Flood Filling</a> - fill connected pixels like in Microsoft Paint</li>
</ul>
<h1 id="segmenting-fossils">Segmenting Fossils</h1>
<h2 id="taken-from-the-bbc-documentary-first-life-by-david-attenborough">Taken from the BBC Documentary <a href="http://www.bbc.co.uk/programmes/b00vw49d">First Life</a> by David Attenborough</h2>
<video controls>
<source src="ext-figures/PaleontologyMovie.m4v" type="video/mp4"> Your browser does not support the video tag.
</video>
<ul>
<li>Gut Data</li>
<li>Slice 182 you can make out the intenstine track</li>
<li>Teeth Data</li>
<li>Explore the sample and apply a threshold to locate the teeth using the 3D viewer</li>
</ul>
<h1 id="quantifying-alzheimers-segment-the-cortex">Quantifying Alzheimers: Segment the Cortex</h1>
<h4 id="courtesy-of-alberto-alfonso">Courtesy of Alberto Alfonso</h4>
<ul>
<li>Understand the progress of Alzheimer’s disease as it relates to plaque formation in different regions of the brain <img src="ext-figures/cortex.png" alt="Cortex Image" /></li>
</ul>
<hr />
<ul>
<li>First identify different regions</li>
<li>Manually contoured <img src="ext-figures/cortex_mask.png" alt="Cortex Mask" /></li>
</ul>
<h1 id="quantifying-alzheimers-segment-the-cortex-1">Quantifying Alzheimers: Segment the Cortex</h1>
<ul>
<li>The cortex is barely visible to the human eye</li>
<li>Tiny structures hint at where cortex is located
<div class="row">
<button class="source R toggle btn btn-xs btn-primary">
<span class="glyphicon glyphicon-chevron-down"></span> R source
</button>
<pre style=""><code class="source r">alz.df<-im.to.df(t(png::readPNG("ext-figures/cortex.png")))
ggplot(alz.df,aes(x=x,y=518-y))+
  geom_raster(aes(fill=val))+
  labs(fill="Electron Density",y="y",x="x")+
  coord_equal()+
  theme_bw(20)</code></pre>
<div class="row">
<div class="col-md-offset-3 col-md-6">
<a href="#" class="thumbnail"><img src="print_figures/unnamed-chunk-77-1.png" title="Brain with Threshold" alt="Brain with Threshold" style="display: block; margin: auto;" /></a>
</div>
</div>
</div></li>
</ul>
<hr />
<ul>
<li>A simple threshold is insufficient to finding the cortical structures</li>
<li>Other filtering techniques are unlikely to magicially fix this problem
<div class="row">
<button class="source R toggle btn btn-xs btn-primary">
<span class="glyphicon glyphicon-chevron-down"></span> R source
</button>
<pre style=""><code class="source r">ggplot(alz.df,aes(x=x,y=518-y))+
  geom_raster(aes(fill=cut_interval(val,4)))+
  labs(fill="Segmented Phases",y="y",x="x")+
  coord_equal()+
  theme_bw(20)</code></pre>
<div class="row">
<div class="col-md-offset-3 col-md-6">
<a href="#" class="thumbnail"><img src="print_figures/unnamed-chunk-78-1.png" title="Brain with Threshold" alt="Brain with Threshold" style="display: block; margin: auto;" /></a>
</div>
</div>
</div></li>
</ul>
<h1 id="surface-area-perimeter">Surface Area / Perimeter</h1>
<p>We see that the dilation and erosion affects are strongly related to the surface area of an object: the more surface area the larger the affect of a single dilation or erosion step.</p>
<div class="row">
<button class="source R toggle btn btn-xs btn-primary">
<span class="glyphicon glyphicon-chevron-down"></span> R source
</button>
<pre style=""><code class="source r">make.circle<-function(nx,r,nscale=1) {
  ny<-nx
  grad.im<-expand.grid(x=c(-nx:nx)/nscale,y=c(-ny:ny)/nscale)
  grad.im$val<-with(grad.im,(x^2+y^2)<r^2)
  grad.im$nx<-nx
  grad.im$r<-r
  grad.im
}
r.list<-seq(0.5,5,length.out=9)
ggplot(ldply(r.list,function(r) make.circle(10,r)),aes(x=x,y=y,fill=val))+
  geom_raster()+scale_fill_grey()+facet_wrap(~r)+
  theme_bw(20)+guides(fill=F)</code></pre>
<div class="row">
<div class="col-md-offset-3 col-md-6">
<a href="#" class="thumbnail"><img src="print_figures/unnamed-chunk-79-1.png" title="Surface Area Estimation" alt="Surface Area Estimation" style="display: block; margin: auto;" /></a>
</div>
</div>
</div>
<hr />
<div class="row">
<button class="source R toggle btn btn-xs btn-primary">
<span class="glyphicon glyphicon-chevron-down"></span> R source
</button>
<pre style=""><code class="source r">calc.eros.cnt<-function(nx,r,nscale=1,im.fun=make.circle) {
  in.cir<-im.fun(nx,r,nscale=nscale)
  cir.im<-df.to.im(in.cir)
  data.frame(nx=nx,r=r,nscale=nscale,
             dvolume=sum(dilate(cir.im>0,makeBrush(3,"diamond"))>0),
             evolume=sum(erode(cir.im>0,makeBrush(3,"diamond"))>0),
             volume=sum(cir.im>0)
             )
}
max.rad<-20
r.list<-seq(0.2,max.rad,length.out=20)
r.table<-ldply(r.list,function(r) calc.eros.cnt(max.rad+1,r,1))
r.table$model.perimeter<-with(r.table,2*pi*r)
r.table$estimated.perimeter<-with(r.table,
                                  ((dvolume-volume)+(volume-evolume))/2)
ggplot(r.table,aes(x=r))+
  geom_line(aes(y=estimated.perimeter,color="Morphological Estimation"))+
  geom_line(aes(y=model.perimeter,color="Model Circumference"))+
  labs(x="Radius",y="Perimeter",color="Source")+
  theme_bw(20)</code></pre>
<div class="row">
<div class="col-md-offset-3 col-md-6">
<a href="#" class="thumbnail"><img src="print_figures/unnamed-chunk-80-1.png" title="Attenuation to Intensity" alt="Attenuation to Intensity" style="display: block; margin: auto;" /></a>
</div>
</div>
</div>
</div>
</div>
<div class="navbar navbar-fixed-bottom navbar-inverse">
<div class="container">
<div class="navbar-header">
<button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-responsive-collapse">
<span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span>
</button>
</div>
<div id="bottom-navbar" class="navbar-collapse collapse navbar-responsive-collapse">
<ul class="nav navbar-nav navbar-right">
<li class="nav">
<p class="navbar-text">
Toggle
</p>
</li>
<li class="dropup">
<a href="#" class="dropdown-toggle" data-toggle="dropdown">Code <b class="caret"></b></a>
<ul class="dropdown-menu">
<li class="dropdown-header">
Languages
</li>
<li class="active">
<a href="#" class="toggle-global source R" type="source.R">R</a>
</li>
<li>
<a href="#" type="all-source" class="toggle-global">All</a>
</li>
</ul>
</li>
<li class="dropup">
<a href="#" class="dropdown-toggle" data-toggle="dropdown">Output <b class="caret"></b></a>
<ul class="dropdown-menu">
<li class="dropdown-header">
Type
</li>
<li class="active">
<a href="#" class="toggle-global message" type="message">message</a>
</li>
<li class="active">
<a href="#" class="toggle-global error" type="error">error</a>
</li>
<li>
<a href="#" type="all-output" class="toggle-global">All</a>
</li>
</ul>
</li>
<li class="active">
<a href="#" type="figure" class="toggle-global">Figures</a>
</li>
</ul>
</div>
</div>
</div>
</div>
<div id="push">
</div>
<div id="footer">
<div class="container">
<p class="text-muted" id="credit">
Styled with <a href="https://github.com/jimhester/knitrBootstrap">knitrBootstrap</a>
</p>
</div>
</div>
<link rel="stylesheet" id="theme" href="https://netdna.bootstrapcdn.com/bootstrap/3.0.0/css/bootstrap.min.css" media="screen"></link><link rel="stylesheet" id="highlight" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/7.3/styles/default.min.css" media="screen"></link>
</div>
</body>
</html>
